var formula=function(){var exports,exports,d1900,exports,exports,exports,MEMOIZED_FACT,exports,exports,exports,SQRT2PI,exports,error=((exports={}).nil=Error("#NULL!"),exports.div0=Error("#DIV/0!"),exports.value=Error("#VALUE!"),exports.ref=Error("#REF!"),exports.name=Error("#NAME?"),exports.num=Error("#NUM!"),exports.na=Error("#N/A"),exports.error=Error("#ERROR!"),exports.data=Error("#GETTING_DATA"),exports),utils=((exports={}).flattenShallow=function(e){return e&&e.reduce?e.reduce(function(e,t){var r=Array.isArray(e),n=Array.isArray(t);return r&&n?e.concat(t):r?(e.push(t),e):n?[e].concat(t):[e,t]}):e},exports.isFlat=function(e){if(!e)return!1;for(var t=0;t<e.length;++t)if(Array.isArray(e[t]))return!1;return!0},exports.flatten=function(){for(var e=exports.argsToArray.apply(null,arguments);!exports.isFlat(e);)e=exports.flattenShallow(e);return e},exports.argsToArray=function(e){var t=[];return exports.arrayEach(e,function(e){t.push(e)}),t},exports.numbers=function(){var e=this.flatten.apply(null,arguments);return e.filter(function(e){return"number"==typeof e})},exports.cleanFloat=function(e){var t=1e14;return Math.round(e*t)/t},exports.parseBool=function(e){if("boolean"==typeof e||e instanceof Error)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){var t=e.toUpperCase();if("TRUE"===t)return!0;if("FALSE"===t)return!1}return e instanceof Date&&!isNaN(e)||error.value},exports.parseNumber=function(e){return void 0===e||""===e?error.value:isNaN(e)?error.value:parseFloat(e)},exports.parseNumberArray=function(e){var t,r;if(!e||0===(t=e.length))return error.value;for(;t--;){if((r=exports.parseNumber(e[t]))===error.value)return r;e[t]=r}return e},exports.parseMatrix=function(e){if(!e||0===(t=e.length))return error.value;for(var t,r,n=0;n<e.length;n++)if(r=exports.parseNumberArray(e[n]),e[n]=r,r instanceof Error)return r;return e},d1900=new Date(Date.UTC(1900,0,1)),exports.parseDate=function(e){if(!isNaN(e)){if(e instanceof Date)return new Date(e);var t=parseInt(e,10);return t<0?error.num:new Date(t<=60?d1900.getTime()+(t-1)*864e5:d1900.getTime()+(t-2)*864e5)}return"string"!=typeof e||(e=new Date(e),isNaN(e))?error.value:e},exports.parseDateArray=function(e){for(var t,r=e.length;r--;){if((t=this.parseDate(e[r]))===error.value)return t;e[r]=t}return e},exports.anyIsError=function(){for(var e=arguments.length;e--;)if(arguments[e]instanceof Error)return!0;return!1},exports.arrayValuesToNumbers=function(e){for(var t,r=e.length;r--;)if("number"!=typeof(t=e[r])){if(!0===t){e[r]=1;continue}if(!1===t){e[r]=0;continue}if("string"==typeof t){var n=this.parseNumber(t);n instanceof Error?e[r]=0:e[r]=n}}return e},exports.rest=function(e,t){return(t=t||1,e&&"function"==typeof e.slice)?e.slice(t):e},exports.initial=function(e,t){return(t=t||1,e&&"function"==typeof e.slice)?e.slice(0,e.length-t):e},exports.arrayEach=function(e,t){for(var r=-1,n=e.length;++r<n&&!1!==t(e[r],r,e););return e},exports.transpose=function(e){return e?e[0].map(function(t,r){return e.map(function(e){return e[r]})}):error.value},exports),met={};met.datetime=function(){var e={},t=new Date(1900,0,1),r=[[],[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],[],[],[],[],[],[],[],[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]];function n(e){return 1===new Date(e,1,29).getMonth()}function o(e){var r=e>-22038912e5?2:1;return(e-t)/864e5+r}return e.DATE=function(e,t,r){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:e<0||t<0||r<0?error.num:new Date(e,t-1,r)},e.DATEVALUE=function(e){if("string"!=typeof e)return error.value;var r=Date.parse(e);return isNaN(r)?error.value:r<=-22038912e5?(r-t)/864e5+1:(r-t)/864e5+2},e.DAY=function(e){var t=utils.parseDate(e);return t instanceof Error?t:t.getDate()},e.DAYS=function(e,t){return(e=utils.parseDate(e),t=utils.parseDate(t),e instanceof Error)?e:t instanceof Error?t:o(e)-o(t)},e.DAYS360=function(e,t,r){},e.EDATE=function(e,t){return(e=utils.parseDate(e))instanceof Error?e:isNaN(t)?error.value:(t=parseInt(t,10),e.setMonth(e.getMonth()+t),o(e))},e.EOMONTH=function(e,t){return(e=utils.parseDate(e))instanceof Error?e:isNaN(t)?error.value:(t=parseInt(t,10),o(new Date(e.getFullYear(),e.getMonth()+t+1,0)))},e.HOUR=function(e){return(e=utils.parseDate(e))instanceof Error?e:e.getHours()},e.INTERVAL=function(e){if("number"!=typeof e&&"string"!=typeof e)return error.value;var t=Math.floor((e=parseInt(e,10))/94608e4),r=Math.floor((e%=94608e4)/2592e3),n=Math.floor((e%=2592e3)/86400),o=Math.floor((e%=86400)/3600),l=Math.floor((e%=3600)/60),s=e%=60;return"P"+(t=t>0?t+"Y":"")+(r=r>0?r+"M":"")+(n=n>0?n+"D":"")+"T"+(o=o>0?o+"H":"")+(l=l>0?l+"M":"")+(s=s>0?s+"S":"")},e.ISOWEEKNUM=function(e){if((e=utils.parseDate(e))instanceof Error)return e;e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/864e5+1)/7)},e.MINUTE=function(e){return(e=utils.parseDate(e))instanceof Error?e:e.getMinutes()},e.MONTH=function(e){return(e=utils.parseDate(e))instanceof Error?e:e.getMonth()+1},e.NETWORKDAYS=function(e,t,r){},e.NETWORKDAYS.INTL=function(e,t,r,n){},e.NOW=function(){return new Date},e.SECOND=function(e){return(e=utils.parseDate(e))instanceof Error?e:e.getSeconds()},e.TIME=function(e,t,r){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:e<0||t<0||r<0?error.num:(3600*e+60*t+r)/86400},e.TIMEVALUE=function(e){return(e=utils.parseDate(e))instanceof Error?e:(3600*e.getHours()+60*e.getMinutes()+e.getSeconds())/86400},e.TODAY=function(){return new Date},e.WEEKDAY=function(e,t){if((e=utils.parseDate(e))instanceof Error)return e;void 0===t&&(t=1);var n=e.getDay();return r[t][n]},e.WEEKNUM=function(e,t){},e.WORKDAY=function(e,t,r){},e.WORKDAY.INTL=function(e,t,r,n){},e.YEAR=function(e){return(e=utils.parseDate(e))instanceof Error?e:e.getFullYear()},e.YEARFRAC=function(e,t,r){},e}(),met.database=function(){var exports={};function compact(e){if(!e)return e;for(var t=[],r=0;r<e.length;++r)e[r]&&t.push(e[r]);return t}function findResultIndex(database,criterias){for(var matches={},i=1;i<database[0].length;++i)matches[i]=!0;var maxCriteriaLength=criterias[0].length;for(i=1;i<criterias.length;++i)criterias[i].length>maxCriteriaLength&&(maxCriteriaLength=criterias[i].length);for(var k=1;k<database.length;++k)for(var l=1;l<database[k].length;++l){for(var currentCriteriaResult=!1,hasMatchingCriteria=!1,j=0;j<criterias.length;++j){var criteria=criterias[j];if(!(criteria.length<maxCriteriaLength)){var criteriaField=criteria[0];if(database[k][0]===criteriaField){hasMatchingCriteria=!0;for(var p=1;p<criteria.length;++p)currentCriteriaResult=currentCriteriaResult||eval(database[k][l]+criteria[p])}}}hasMatchingCriteria&&(matches[l]=matches[l]&&currentCriteriaResult)}for(var result=[],n=0;n<database[0].length;++n)matches[n]&&result.push(n-1);return result}return exports.FINDFIELD=function(e,t){for(var r=null,n=0;n<e.length;n++)if(e[n][0]===t){r=n;break}return null==r?error.value:r},exports.DAVERAGE=function(e,t,r){if(isNaN(t)&&"string"!=typeof t)return error.value;var n=findResultIndex(e,r),o=[];if("string"==typeof t){var l=exports.FINDFIELD(e,t);o=utils.rest(e[l])}else o=utils.rest(e[t]);for(var s=0,i=0;i<n.length;i++)s+=o[n[i]];return 0===n.length?error.div0:s/n.length},exports.DCOUNT=function(e,t,r){},exports.DCOUNTA=function(e,t,r){},exports.DGET=function(e,t,r){if(isNaN(t)&&"string"!=typeof t)return error.value;var n=findResultIndex(e,r),o=[];if("string"==typeof t){var l=exports.FINDFIELD(e,t);o=utils.rest(e[l])}else o=utils.rest(e[t]);return 0===n.length?error.value:n.length>1?error.num:o[n[0]]},exports.DMAX=function(e,t,r){if(isNaN(t)&&"string"!=typeof t)return error.value;var n=findResultIndex(e,r),o=[];if("string"==typeof t){var l=exports.FINDFIELD(e,t);o=utils.rest(e[l])}else o=utils.rest(e[t]);for(var s=o[n[0]],i=1;i<n.length;i++)s<o[n[i]]&&(s=o[n[i]]);return s},exports.DMIN=function(e,t,r){if(isNaN(t)&&"string"!=typeof t)return error.value;var n=findResultIndex(e,r),o=[];if("string"==typeof t){var l=exports.FINDFIELD(e,t);o=utils.rest(e[l])}else o=utils.rest(e[t]);for(var s=o[n[0]],i=1;i<n.length;i++)s>o[n[i]]&&(s=o[n[i]]);return s},exports.DPRODUCT=function(e,t,r){if(isNaN(t)&&"string"!=typeof t)return error.value;var n=findResultIndex(e,r),o=[];if("string"==typeof t){var l=exports.FINDFIELD(e,t);o=utils.rest(e[l])}else o=utils.rest(e[t]);for(var s=[],i=0;i<n.length;i++)s[i]=o[n[i]];s=compact(s);var a=1;for(i=0;i<s.length;i++)a*=s[i];return a},exports.DSTDEV=function(e,t,r){},exports.DSTDEVP=function(e,t,r){},exports.DSUM=function(e,t,r){},exports.DVAR=function(e,t,r){},exports.DVARP=function(e,t,r){},exports.MATCH=function(e,t,r){if(!e&&!t||(2===arguments.length&&(r=1),!(t instanceof Array)||-1!==r&&0!==r&&1!==r))return error.na;for(var n,o,l=0;l<t.length;l++)if(1===r){if(t[l]===e)return l+1;t[l]<e&&(o?t[l]>o&&(n=l+1,o=t[l]):(n=l+1,o=t[l]))}else if(0===r){if("string"==typeof e){if(e=e.replace(/\?/g,"."),t[l].toLowerCase().match(e.toLowerCase()))return l+1}else if(t[l]===e)return l+1}else if(-1===r){if(t[l]===e)return l+1;t[l]>e&&(o?t[l]<o&&(n=l+1,o=t[l]):(n=l+1,o=t[l]))}return n||error.na},exports}(),met.engineering=function(){var e={};function t(e){return/^[01]{1,10}$/.test(e)}return e.BESSELI=function(e,t){},e.BESSELJ=function(e,t){},e.BESSELK=function(e,t){},e.BESSELY=function(e,t){},e.BIN2DEC=function(e){if(!t(e))return error.num;var r=parseInt(e,2),n=e.toString();return 10===n.length&&"1"===n.substring(0,1)?parseInt(n.substring(1),2)-512:r},e.BIN2HEX=function(e,r){if(!t(e))return error.num;var n=e.toString();if(10===n.length&&"1"===n.substring(0,1))return(0xfffffffe00+parseInt(n.substring(1),2)).toString(16);var o=parseInt(e,2).toString(16);return void 0===r?o:isNaN(r)?error.value:r<0?error.num:(r=Math.floor(r))>=o.length?REPT("0",r-o.length)+o:error.num},e.BIN2OCT=function(e,r){if(!t(e))return error.num;var n=e.toString();if(10===n.length&&"1"===n.substring(0,1))return(1073741312+parseInt(n.substring(1),2)).toString(8);var o=parseInt(e,2).toString(8);return void 0===r?o:isNaN(r)?error.value:r<0?error.num:(r=Math.floor(r))>=o.length?REPT("0",r-o.length)+o:error.num},e.BITAND=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e<0||t<0||Math.floor(e)!==e||Math.floor(t)!==t||e>0xffffffffffff||t>0xffffffffffff?error.num:e&t},e.BITLSHIFT=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e<0||Math.floor(e)!==e||e>0xffffffffffff||Math.abs(t)>53?error.num:t>=0?e<<t:e>>-t},e.BITOR=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e<0||t<0||Math.floor(e)!==e||Math.floor(t)!==t||e>0xffffffffffff||t>0xffffffffffff?error.num:e|t},e.BITRSHIFT=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e<0||Math.floor(e)!==e||e>0xffffffffffff||Math.abs(t)>53?error.num:t>=0?e>>t:e<<-t},e.BITXOR=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e<0||t<0||Math.floor(e)!==e||Math.floor(t)!==t||e>0xffffffffffff||t>0xffffffffffff?error.num:e^t},e.COMPLEX=function(e,t,r){if(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))return e;if("i"!==(r=void 0===r?"i":r)&&"j"!==r)return error.value;if(0===e&&0===t)return 0;if(0===e)return 1===t?r:t.toString()+r;if(0===t)return e.toString();var n=t>0?"+":"";return e.toString()+n+(1===t?r:t.toString()+r)},e.CONVERT=function(e,t,r){if((e=utils.parseNumber(e))instanceof Error)return e;for(var n,o=[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["\xe5ngstr\xf6m","\xc5",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["coulomb","C",null,"electric_charge",!0,!1,1],["cubic \xe5ngstr\xf6m","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m?",null,"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,2365882365e-13],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","\xb0",null,"angle",!1,!1,.0174532925199433],["degrees Rankine","Rank",null,"temperature",!1,!0,.555555555555556],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["farad","F",null,"electric_capacitance",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519.538],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,9460730472580800],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,27777777777778e-17],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,290888208665722e-18],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,299792458],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["œrsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","Ω",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdest\xe4rke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,35277777777778e-17],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,946352946e-12],["radian","rad",null,"angle",!0,!1,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square \xe5ngstr\xf6m","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,56826125e-11],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,473176473e-12],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,31557600]],l={Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]},s={Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]},i=null,a=null,u=t,c=r,d=1,p=1,f=0;f<o.length;f++)n=null===o[f][2]?[]:o[f][2],(o[f][1]===u||n.indexOf(u)>=0)&&(i=o[f]),(o[f][1]===c||n.indexOf(c)>=0)&&(a=o[f]);if(null===i){var g=l[t.substring(0,2)],h=s[t.substring(0,1)];"da"===t.substring(0,2)&&(h=["dekao",10,"da"]),g?(d=g[2],u=t.substring(2)):h&&(d=h[1],u=t.substring(h[2].length));for(var m=0;m<o.length;m++)n=null===o[m][2]?[]:o[m][2],(o[m][1]===u||n.indexOf(u)>=0)&&(i=o[m])}if(null===a){var _=l[r.substring(0,2)],v=s[r.substring(0,1)];"da"===r.substring(0,2)&&(v=["dekao",10,"da"]),_?(p=_[2],c=r.substring(2)):v&&(p=v[1],c=r.substring(v[2].length));for(var C=0;C<o.length;C++)n=null===o[C][2]?[]:o[C][2],(o[C][1]===c||n.indexOf(c)>=0)&&(a=o[C])}return null===i||null===a||i[3]!==a[3]?error.na:e*i[6]*d/(a[6]*p)},e.DEC2BIN=function(e,t){if((e=utils.parseNumber(e))instanceof Error)return e;if(!/^-?[0-9]{1,3}$/.test(e)||e<-512||e>511)return error.num;if(e<0)return"1"+REPT("0",9-(512+e).toString(2).length)+(512+e).toString(2);var r=parseInt(e,10).toString(2);return void 0===t?r:isNaN(t)?error.value:t<0?error.num:(t=Math.floor(t))>=r.length?REPT("0",t-r.length)+r:error.num},e.DEC2HEX=function(e,t){if((e=utils.parseNumber(e))instanceof Error)return e;if(!/^-?[0-9]{1,12}$/.test(e)||e<-549755813888||e>549755813887)return error.num;if(e<0)return(1099511627776+e).toString(16);var r=parseInt(e,10).toString(16);return void 0===t?r:isNaN(t)?error.value:t<0?error.num:(t=Math.floor(t))>=r.length?REPT("0",t-r.length)+r:error.num},e.DEC2OCT=function(e,t){if((e=utils.parseNumber(e))instanceof Error)return e;if(!/^-?[0-9]{1,9}$/.test(e)||e<-536870912||e>536870911)return error.num;if(e<0)return(1073741824+e).toString(8);var r=parseInt(e,10).toString(8);return void 0===t?r:isNaN(t)?error.value:t<0?error.num:(t=Math.floor(t))>=r.length?REPT("0",t-r.length)+r:error.num},e.DELTA=function(e,t){return(t=void 0===t?0:t,e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e===t?1:0},e.ERF=function(e,t){},e.ERF.PRECISE=function(){},e.ERFC=function(e){},e.ERFC.PRECISE=function(){},e.GESTEP=function(e,t){return(t=t||0,e=utils.parseNumber(e),utils.anyIsError(t,e))?e:e>=t?1:0},e.HEX2BIN=function(e,t){if(!/^[0-9A-Fa-f]{1,10}$/.test(e))return error.num;var r=10===e.length&&"f"===e.substring(0,1).toLowerCase(),n=r?parseInt(e,16)-1099511627776:parseInt(e,16);if(n<-512||n>511)return error.num;if(r)return"1"+REPT("0",9-(512+n).toString(2).length)+(512+n).toString(2);var o=n.toString(2);return void 0===t?o:isNaN(t)?error.value:t<0?error.num:(t=Math.floor(t))>=o.length?REPT("0",t-o.length)+o:error.num},e.HEX2DEC=function(e){if(!/^[0-9A-Fa-f]{1,10}$/.test(e))return error.num;var t=parseInt(e,16);return t>=549755813888?t-1099511627776:t},e.HEX2OCT=function(e,t){if(!/^[0-9A-Fa-f]{1,10}$/.test(e))return error.num;var r=parseInt(e,16);if(r>536870911&&r<0xffe0000000)return error.num;if(r>=0xffe0000000)return(r-0xffc0000000).toString(8);var n=r.toString(8);return void 0===t?n:isNaN(t)?error.value:t<0?error.num:(t=Math.floor(t))>=n.length?REPT("0",t-n.length)+n:error.num},e.IMABS=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.value:Math.sqrt(Math.pow(r,2)+Math.pow(n,2))},e.IMAGINARY=function(e){if(void 0===e||!0===e||!1===e)return error.value;if(0===e||"0"===e)return 0;if(["i","j"].indexOf(e)>=0)return 1;var t=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));var n=e.substring(e.length-1,e.length),o="i"===n||"j"===n;return t>=0||r>=0?o?t>=0?isNaN(e.substring(0,t))||isNaN(e.substring(t+1,e.length-1))?error.num:Number(e.substring(t+1,e.length-1)):isNaN(e.substring(0,r))||isNaN(e.substring(r+1,e.length-1))?error.num:-Number(e.substring(r+1,e.length-1)):error.num:o?isNaN(e.substring(0,e.length-1))?error.num:e.substring(0,e.length-1):isNaN(e)?error.num:0},e.IMARGUMENT=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.value:0===r&&0===n?error.div0:0===r&&n>0?Math.PI/2:0===r&&n<0?-Math.PI/2:0===n&&r>0?0:0===n&&r<0?-Math.PI:r>0?Math.atan(n/r):r<0&&n>=0?Math.atan(n/r)+Math.PI:Math.atan(n/r)-Math.PI},e.IMCONJUGATE=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",0!==n?e.COMPLEX(r,-n,o):t},e.IMCOS=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",e.COMPLEX(Math.cos(r)*(Math.exp(n)+Math.exp(-n))/2,-Math.sin(r)*(Math.exp(n)-Math.exp(-n))/2,o)},e.IMCOSH=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",e.COMPLEX(Math.cos(n)*(Math.exp(r)+Math.exp(-r))/2,Math.sin(n)*(Math.exp(r)-Math.exp(-r))/2,o)},e.IMCOT=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.value:e.IMDIV(e.IMCOS(t),e.IMSIN(t))},e.IMDIV=function(t,r){var n=e.IMREAL(t),o=e.IMAGINARY(t),l=e.IMREAL(r),s=e.IMAGINARY(r);if(utils.anyIsError(n,o,l,s))return error.value;var i=t.substring(t.length-1),a=r.substring(r.length-1),u="i";if("j"===i?u="j":"j"===a&&(u="j"),0===l&&0===s)return error.num;var c=l*l+s*s;return e.COMPLEX((n*l+o*s)/c,(o*l-n*s)/c,u)},e.IMEXP=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);o="i"===o||"j"===o?o:"i";var l=Math.exp(r);return e.COMPLEX(l*Math.cos(n),l*Math.sin(n),o)},e.IMLN=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",e.COMPLEX(Math.log(Math.sqrt(r*r+n*n)),Math.atan(n/r),o)},e.IMLOG10=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",e.COMPLEX(Math.log(Math.sqrt(r*r+n*n))/Math.log(10),Math.atan(n/r)/Math.log(10),o)},e.IMLOG2=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",e.COMPLEX(Math.log(Math.sqrt(r*r+n*n))/Math.log(2),Math.atan(n/r)/Math.log(2),o)},e.IMPOWER=function(t,r){r=utils.parseNumber(r);var n=e.IMREAL(t),o=e.IMAGINARY(t);if(utils.anyIsError(r,n,o))return error.value;var l=t.substring(t.length-1);l="i"===l||"j"===l?l:"i";var s=Math.pow(e.IMABS(t),r),i=e.IMARGUMENT(t);return e.COMPLEX(s*Math.cos(r*i),s*Math.sin(r*i),l)},e.IMPRODUCT=function(){for(var t=arguments[0],r=1;r<arguments.length;r++){var n=e.IMREAL(t),o=e.IMAGINARY(t),l=e.IMREAL(arguments[r]),s=e.IMAGINARY(arguments[r]);if(utils.anyIsError(n,o,l,s))return error.value;t=e.COMPLEX(n*l-o*s,n*s+o*l)}return t},e.IMREAL=function(e){if(void 0===e||!0===e||!1===e)return error.value;if(0===e||"0"===e||["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0)return 0;var t=e.indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));var n=e.substring(e.length-1,e.length),o="i"===n||"j"===n;return t>=0||r>=0?o?t>=0?isNaN(e.substring(0,t))||isNaN(e.substring(t+1,e.length-1))?error.num:Number(e.substring(0,t)):isNaN(e.substring(0,r))||isNaN(e.substring(r+1,e.length-1))?error.num:Number(e.substring(0,r)):error.num:o?isNaN(e.substring(0,e.length-1))?error.num:0:isNaN(e)?error.num:e},e.IMSEC=function(t){if(!0===t||!1===t)return error.value;var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.value:e.IMDIV("1",e.IMCOS(t))},e.IMSECH=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.value:e.IMDIV("1",e.IMCOSH(t))},e.IMSIN=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",e.COMPLEX(Math.sin(r)*(Math.exp(n)+Math.exp(-n))/2,Math.cos(r)*(Math.exp(n)-Math.exp(-n))/2,o)},e.IMSINH=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);return o="i"===o||"j"===o?o:"i",e.COMPLEX(Math.cos(n)*(Math.exp(r)-Math.exp(-r))/2,Math.sin(n)*(Math.exp(r)+Math.exp(-r))/2,o)},e.IMSQRT=function(t){var r=e.IMREAL(t),n=e.IMAGINARY(t);if(utils.anyIsError(r,n))return error.value;var o=t.substring(t.length-1);o="i"===o||"j"===o?o:"i";var l=Math.sqrt(e.IMABS(t)),s=e.IMARGUMENT(t);return e.COMPLEX(l*Math.cos(s/2),l*Math.sin(s/2),o)},e.IMCSC=function(t){if(!0===t||!1===t)return error.value;var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.num:e.IMDIV("1",e.IMSIN(t))},e.IMCSCH=function(t){if(!0===t||!1===t)return error.value;var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.num:e.IMDIV("1",e.IMSINH(t))},e.IMSUB=function(e,t){var r=this.IMREAL(e),n=this.IMAGINARY(e),o=this.IMREAL(t),l=this.IMAGINARY(t);if(utils.anyIsError(r,n,o,l))return error.value;var s=e.substring(e.length-1),i=t.substring(t.length-1),a="i";return"j"===s?a="j":"j"===i&&(a="j"),this.COMPLEX(r-o,n-l,a)},e.IMSUM=function(){for(var e=utils.flatten(arguments),t=e[0],r=1;r<e.length;r++){var n=this.IMREAL(t),o=this.IMAGINARY(t),l=this.IMREAL(e[r]),s=this.IMAGINARY(e[r]);if(utils.anyIsError(n,o,l,s))return error.value;t=this.COMPLEX(n+l,o+s)}return t},e.IMTAN=function(t){if(!0===t||!1===t)return error.value;var r=e.IMREAL(t),n=e.IMAGINARY(t);return utils.anyIsError(r,n)?error.value:this.IMDIV(this.IMSIN(t),this.IMCOS(t))},e.OCT2BIN=function(e,t){if(!/^[0-7]{1,10}$/.test(e))return error.num;var r=10===e.length&&"7"===e.substring(0,1),n=r?parseInt(e,8)-1073741824:parseInt(e,8);if(n<-512||n>511)return error.num;if(r)return"1"+REPT("0",9-(512+n).toString(2).length)+(512+n).toString(2);var o=n.toString(2);return void 0===t?o:isNaN(t)?error.value:t<0?error.num:(t=Math.floor(t))>=o.length?REPT("0",t-o.length)+o:error.num},e.OCT2DEC=function(e){if(!/^[0-7]{1,10}$/.test(e))return error.num;var t=parseInt(e,8);return t>=536870912?t-1073741824:t},e.OCT2HEX=function(e,t){if(!/^[0-7]{1,10}$/.test(e))return error.num;var r=parseInt(e,8);if(r>=536870912)return"ff"+(r+3221225472).toString(16);var n=r.toString(16);return void 0===t?n:isNaN(t)?error.value:t<0?error.num:(t=Math.floor(t))>=n.length?REPT("0",t-n.length)+n:error.num},e}(),met.financial=function(){var e={};function t(e){return e&&e.getTime&&!isNaN(e.getTime())}function r(e){return e instanceof Date?e:new Date(e)}return e.ACCRINT=function(e,n,o,l,s,i,a){return(e=r(e),n=r(n),o=r(o),t(e)&&t(n)&&t(o))?l<=0||s<=0||-1===[1,2,4].indexOf(i)||-1===[0,1,2,3,4].indexOf(a)||o<=e?"#NUM!":(s=s||0)*l*YEARFRAC(e,o,a=a||0):"#VALUE!"},e.ACCRINTM=null,e.AMORDEGRC=null,e.AMORLINC=null,e.COUPDAYBS=null,e.COUPDAYS=null,e.COUPDAYSNC=null,e.COUPNCD=null,e.COUPNUM=null,e.COUPPCD=null,e.CUMIPMT=function(t,r,n,o,l,s){if(t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),utils.anyIsError(t,r,n))return error.value;if(t<=0||r<=0||n<=0||o<1||l<1||o>l||0!==s&&1!==s)return error.num;var i=e.PMT(t,r,n,0,s),a=0;1===o&&0===s&&(a=-n,o++);for(var u=o;u<=l;u++)1===s?a+=e.FV(t,u-2,i,n,1)-i:a+=e.FV(t,u-1,i,n,0);return a*t},e.CUMPRINC=function(t,r,n,o,l,s){if(t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),utils.anyIsError(t,r,n))return error.value;if(t<=0||r<=0||n<=0||o<1||l<1||o>l||0!==s&&1!==s)return error.num;var i=e.PMT(t,r,n,0,s),a=0;1===o&&(a=0===s?i+n*t:i,o++);for(var u=o;u<=l;u++)s>0?a+=i-(e.FV(t,u-2,i,n,1)-i)*t:a+=i-e.FV(t,u-1,i,n,0)*t;return a},e.DB=function(e,t,r,n,o){if(o=void 0===o?12:o,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),utils.anyIsError(e,t,r,n,o))return error.value;if(e<0||t<0||r<0||n<0||-1===[1,2,3,4,5,6,7,8,9,10,11,12].indexOf(o)||n>r)return error.num;if(t>=e)return 0;for(var l=(1-Math.pow(t/e,1/r)).toFixed(3),s=e*l*o/12,i=s,a=0,u=n===r?r-1:n,c=2;c<=u;c++)a=(e-i)*l,i+=a;return 1===n?s:n===r?(e-i)*l:a},e.DDB=function(e,t,r,n,o){if(o=void 0===o?2:o,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),utils.anyIsError(e,t,r,n,o))return error.value;if(e<0||t<0||r<0||n<0||o<=0||n>r)return error.num;if(t>=e)return 0;for(var l=0,s=0,i=1;i<=n;i++)s=Math.min((e-l)*(o/r),e-t-l),l+=s;return s},e.DISC=null,e.DOLLARDE=function(e,t){if(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;if(t<0)return error.num;if(t>=0&&t<1)return error.div0;t=parseInt(t,10);var r=parseInt(e,10),n=Math.pow(10,Math.ceil(Math.log(t)/Math.LN2)+1);return Math.round((r+=e%1*Math.pow(10,Math.ceil(Math.log(t)/Math.LN10))/t)*n)/n},e.DOLLARFR=function(e,t){if(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;if(t<0)return error.num;if(t>=0&&t<1)return error.div0;t=parseInt(t,10);var r=parseInt(e,10);return r+e%1*Math.pow(10,-Math.ceil(Math.log(t)/Math.LN10))*t},e.DURATION=null,e.EFFECT=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e<=0||t<1?error.num:(t=parseInt(t,10),Math.pow(1+e/t,t)-1)},e.FV=function(e,t,r,n,o){if(n=n||0,o=o||0,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),utils.anyIsError(e,t,r,n,o))return error.value;if(0===e)l=n+r*t;else{var l,s=Math.pow(1+e,t);l=1===o?n*s+r*(1+e)*(s-1)/e:n*s+r*(s-1)/e}return-l},e.FVSCHEDULE=function(e,t){if(e=utils.parseNumber(e),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))return error.value;for(var r=t.length,n=e,o=0;o<r;o++)n*=1+t[o];return n},e.INTRATE=null,e.IPMT=function(t,r,n,o,l,s){if(l=l||0,s=s||0,t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),l=utils.parseNumber(l),s=utils.parseNumber(s),utils.anyIsError(t,r,n,o,l,s))return error.value;var i,a=e.PMT(t,n,o,l,s);return(i=1===r?1===s?0:-o:1===s?e.FV(t,r-2,a,o,1)-a:e.FV(t,r-1,a,o,0))*t},e.IRR=function(e,t){if(t=t||0,e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;for(var r,n,o,l=function(e,t,r){for(var n=r+1,o=e[0],l=1;l<e.length;l++)o+=e[l]/Math.pow(n,(t[l]-t[0])/365);return o},s=function(e,t,r){for(var n=r+1,o=0,l=1;l<e.length;l++){var s=(t[l]-t[0])/365;o-=s*e[l]/Math.pow(n,s+1)}return o},i=[],a=!1,u=!1,c=0;c<e.length;c++)i[c]=0===c?0:i[c-1]+365,e[c]>0&&(a=!0),e[c]<0&&(u=!0);if(!a||!u)return error.num;var d=t=void 0===t?.1:t,p=1e-10,f=!0;do o=l(e,i,d),n=Math.abs((r=d-o/s(e,i,d))-d),d=r,f=n>p&&Math.abs(o)>p;while(f);return d},e.ISPMT=function(e,t,r,n){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),utils.anyIsError(e,t,r,n))?error.value:n*e*(t/r-1)},e.MDURATION=null,e.MIRR=function(t,r,n){if(t=utils.parseNumberArray(utils.flatten(t)),r=utils.parseNumber(r),n=utils.parseNumber(n),utils.anyIsError(t,r,n))return error.value;for(var o,l=t.length,s=[],i=[],a=0;a<l;a++)t[a]<0?s.push(t[a]):i.push(t[a]);return Math.pow(-e.NPV(n,i)*Math.pow(1+n,l-1)/(e.NPV(r,s)*(1+r)),1/(l-1))-1},e.NOMINAL=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e<=0||t<1?error.num:(Math.pow(e+1,1/t)-1)*(t=parseInt(t,10))},e.NPER=function(e,t,r,n,o){var l;if(o=void 0===o?0:o,n=void 0===n?0:n,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),utils.anyIsError(e,t,r,n,o))return error.value;return Math.log((t*(1+e*o)-n*e)/(r*e+t*(1+e*o)))/Math.log(1+e)},e.NPV=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var t=e[0],r=0,n=1;n<e.length;n++)r+=e[n]/Math.pow(1+t,n);return r},e.ODDFPRICE=null,e.ODDFYIELD=null,e.ODDLPRICE=null,e.ODDLYIELD=null,e.PDURATION=function(e,t,r){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:e<=0?error.num:(Math.log(r)-Math.log(t))/Math.log(1+e)},e.PMT=function(e,t,r,n,o){if(n=n||0,o=o||0,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),utils.anyIsError(e,t,r,n,o))return error.value;if(0===e)l=(r+n)/t;else{var l,s=Math.pow(1+e,t);l=1===o?(n*e/(s-1)+r*e/(1-1/s))/(1+e):n*e/(s-1)+r*e/(1-1/s)}return-l},e.PPMT=function(t,r,n,o,l,s){return(l=l||0,s=s||0,t=utils.parseNumber(t),n=utils.parseNumber(n),o=utils.parseNumber(o),l=utils.parseNumber(l),s=utils.parseNumber(s),utils.anyIsError(t,n,o,l,s))?error.value:e.PMT(t,n,o,l,s)-e.IPMT(t,r,n,o,l,s)},e.PRICE=null,e.PRICEDISC=null,e.PRICEMAT=null,e.PV=function(e,t,r,n,o){return(n=n||0,o=o||0,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),utils.anyIsError(e,t,r,n,o))?error.value:0===e?-r*t-n:((1-Math.pow(1+e,t))/e*r*(1+e*o)-n)/Math.pow(1+e,t)},e.RATE=function(e,t,r,n,o,l){if(l=void 0===l?.01:l,n=void 0===n?0:n,o=void 0===o?0:o,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),o=utils.parseNumber(o),l=utils.parseNumber(l),utils.anyIsError(e,t,r,n,o,l))return error.value;for(var s=1e-6,i=100,a=0,u=!1,c=l;a<i&&!u;){var d=Math.pow(c+1,e),p=Math.pow(c+1,e-1),f=n+d*r+t*(d-1)*(c*o+1)/c,g=e*p*r-t*(d-1)*(c*o+1)/Math.pow(c,2),h=e*t*p*(c*o+1)/c+t*(d-1)*o/c,m=c-f/(g+h);Math.abs(m-c)<s&&(u=!0),a++,c=m}return u?c:Number.NaN+c},e.RECEIVED=null,e.RRI=function(e,t,r){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:0===e||0===t?error.num:Math.pow(r/t,1/e)-1},e.SLN=function(e,t,r){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:0===r?error.num:(e-t)/r},e.SYD=function(e,t,r,n){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumber(n),utils.anyIsError(e,t,r,n))?error.value:0===r||n<1||n>r?error.num:(n=parseInt(n,10),(e-t)*(r-n+1)*2/(r*(r+1)))},e.TBILLEQ=function(e,t,r){return(e=utils.parseDate(e),t=utils.parseDate(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:r<=0||e>t||t-e>31536e6?error.num:365*r/(360-r*DAYS360(e,t,!1))},e.TBILLPRICE=function(e,t,r){return(e=utils.parseDate(e),t=utils.parseDate(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:r<=0||e>t||t-e>31536e6?error.num:100*(1-r*DAYS360(e,t,!1)/360)},e.TBILLYIELD=function(e,t,r){return(e=utils.parseDate(e),t=utils.parseDate(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:r<=0||e>t||t-e>31536e6?error.num:(100-r)*360/(r*DAYS360(e,t,!1))},e.VDB=null,e.XIRR=function(e,t,r){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseDateArray(utils.flatten(t)),r=utils.parseNumber(r),utils.anyIsError(e,t,r))return error.value;for(var n,o,l,s=function(e,t,r){for(var n=r+1,o=e[0],l=1;l<e.length;l++)o+=e[l]/Math.pow(n,DAYS(t[l],t[0])/365);return o},i=function(e,t,r){for(var n=r+1,o=0,l=1;l<e.length;l++){var s=DAYS(t[l],t[0])/365;o-=s*e[l]/Math.pow(n,s+1)}return o},a=!1,u=!1,c=0;c<e.length;c++)e[c]>0&&(a=!0),e[c]<0&&(u=!0);if(!a||!u)return error.num;var d=r=r||.1,p=1e-10,f=!0;do l=s(e,t,d),o=Math.abs((n=d-l/i(e,t,d))-d),d=n,f=o>p&&Math.abs(l)>p;while(f);return d},e.XNPV=function(e,t,r){if(e=utils.parseNumber(e),t=utils.parseNumberArray(utils.flatten(t)),r=utils.parseDateArray(utils.flatten(r)),utils.anyIsError(e,t,r))return error.value;for(var n=0,o=0;o<t.length;o++)n+=t[o]/Math.pow(1+e,DAYS(r[o],r[0])/365);return n},e.YIELD=null,e.YIELDDISC=null,e.YIELDMAT=null,e}(),met.information=((exports={}).CELL=null,exports.ERROR={},exports.ERROR.TYPE=function(e){switch(e){case error.nil:return 1;case error.div0:return 2;case error.value:return 3;case error.ref:return 4;case error.name:return 5;case error.num:return 6;case error.na:return 7;case error.data:return 8}return error.na},exports.INFO=null,exports.ISBLANK=function(e){return null===e},exports.ISBINARY=function(e){return/^[01]{1,10}$/.test(e)},exports.ISERR=function(e){return[error.value,error.ref,error.div0,error.num,error.name,error.nil].indexOf(e)>=0||"number"==typeof e&&(isNaN(e)||!isFinite(e))},exports.ISERROR=function(e){return exports.ISERR(e)||e===error.na},exports.ISEVEN=function(e){return!(1&Math.floor(Math.abs(e)))},exports.ISFORMULA=null,exports.ISLOGICAL=function(e){return!0===e||!1===e},exports.ISNA=function(e){return e===error.na},exports.ISNONTEXT=function(e){return"string"!=typeof e},exports.ISNUMBER=function(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)},exports.ISODD=function(e){return!!(1&Math.floor(Math.abs(e)))},exports.ISREF=null,exports.ISTEXT=function(e){return"string"==typeof e},exports.N=function(e){return this.ISNUMBER(e)?e:e instanceof Date?e.getTime():!0===e?1:!1===e?0:this.ISERROR(e)?e:0},exports.NA=function(){return error.na},exports.SHEET=null,exports.SHEETS=null,exports.TYPE=function(e){return this.ISNUMBER(e)?1:this.ISTEXT(e)?2:this.ISLOGICAL(e)?4:this.ISERROR(e)?16:Array.isArray(e)?64:void 0},exports),met.logical=((exports={}).AND=function(){for(var e=utils.flatten(arguments),t=!0,r=0;r<e.length;r++)e[r]||(t=!1);return t},exports.CHOOSE=function(){if(arguments.length<2)return error.na;var e=arguments[0];return e<1||e>254||arguments.length<e+1?error.value:arguments[e]},exports.FALSE=function(){return!1},exports.IF=function(e,t,r){return e?t:r},exports.IFERROR=function(e,t){return ISERROR(e)?t:e},exports.IFNA=function(e,t){return e===error.na?t:e},exports.NOT=function(e){return!e},exports.OR=function(){for(var e=utils.flatten(arguments),t=!1,r=0;r<e.length;r++)e[r]&&(t=!0);return t},exports.TRUE=function(){return!0},exports.XOR=function(){for(var e=utils.flatten(arguments),t=0,r=0;r<e.length;r++)e[r]&&t++;return!!(1&Math.floor(Math.abs(t)))},exports.SWITCH=function(){var e;if(arguments.length>0){var t=arguments[0],r=arguments.length-1,n=Math.floor(r/2),o=!1,l=r%2==0?null:arguments[arguments.length-1];if(n){for(var s=0;s<n;s++)if(t===arguments[2*s+1]){e=arguments[2*s+2],o=!0;break}}!o&&l&&(e=l)}return e},exports),met.math=((exports={}).ABS=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.abs(utils.parseNumber(e))},exports.ACOS=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.acos(e)},exports.ACOSH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e+Math.sqrt(e*e-1))},exports.ACOT=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.atan(1/e)},exports.ACOTH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:.5*Math.log((e+1)/(e-1))},exports.AGGREGATE=null,exports.ARABIC=function(e){if(!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(e))return error.value;var t=0;return e.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,function(e){t+=({M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1})[e]}),t},exports.ASIN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.asin(e)},exports.ASINH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e+Math.sqrt(e*e+1))},exports.ATAN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.atan(e)},exports.ATAN2=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:Math.atan2(e,t)},exports.ATANH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log((1+e)/(1-e))/2},exports.BASE=function(e,t,r){if(r=r||0,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))return error.value;r=void 0===r?0:r;var n=e.toString(t);return Array(Math.max(r+1-n.length,0)).join("0")+n},exports.CEILING=function(e,t,r){return(t=void 0===t?1:t,r=void 0===r?0:r,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:0===t?0:(t=Math.abs(t),e>=0)?Math.ceil(e/t)*t:0===r?-1*Math.floor(Math.abs(e)/t)*t:-1*Math.ceil(Math.abs(e)/t)*t},exports.CEILING.MATH=exports.CEILING,exports.CEILING.PRECISE=exports.CEILING,exports.COMBIN=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:exports.FACT(e)/(exports.FACT(t)*exports.FACT(e-t))},exports.COMBINA=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:0===e&&0===t?1:exports.COMBIN(e+t-1,e-1)},exports.COS=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.cos(e)},exports.COSH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:(Math.exp(e)+Math.exp(-e))/2},exports.COT=function(e){return(e=utils.parseNumber(e))instanceof Error?e:1/Math.tan(e)},exports.COTH=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var t=Math.exp(2*e);return(t+1)/(t-1)},exports.CSC=function(e){return(e=utils.parseNumber(e))instanceof Error?e:1/Math.sin(e)},exports.CSCH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:2/(Math.exp(e)-Math.exp(-e))},exports.DECIMAL=function(e,t){return arguments.length<1?error.value:parseInt(e,t)},exports.DEGREES=function(e){return(e=utils.parseNumber(e))instanceof Error?e:180*e/Math.PI},exports.EVEN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:exports.CEILING(e,-2,-1)},exports.EXP=Math.exp,MEMOIZED_FACT=[],exports.FACT=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var t=Math.floor(e);return 0===t||1===t?1:(MEMOIZED_FACT[t]>0||(MEMOIZED_FACT[t]=exports.FACT(t-1)*t),MEMOIZED_FACT[t])},exports.FACTDOUBLE=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var t=Math.floor(e);return t<=0?1:t*exports.FACTDOUBLE(t-2)},exports.FLOOR=function(e,t,r){return(t=void 0===t?1:t,r=void 0===r?0:r,e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:0===t?0:(t=Math.abs(t),e>=0)?Math.floor(e/t)*t:0===r?-1*Math.ceil(Math.abs(e)/t)*t:-1*Math.floor(Math.abs(e)/t)*t},exports.FLOOR.MATH=exports.FLOOR,exports.GCD=null,exports.INT=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.floor(e)},exports.LCM=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var t,r,n,o,l=1;void 0!==(n=e.pop());)for(;n>1;){if(n%2){for(t=3,r=Math.floor(Math.sqrt(n));t<=r&&n%t;t+=2);o=t<=r?t:n}else o=2;for(n/=o,l*=o,t=e.length;t;e[--t]%o==0&&1==(e[t]/=o)&&e.splice(t,1));}return l},exports.LN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e)},exports.LOG=function(e,t){return(e=utils.parseNumber(e),t=void 0===t?10:utils.parseNumber(t),utils.anyIsError(e,t))?error.value:Math.log(e)/Math.log(t)},exports.LOG10=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log(e)/Math.log(10)},exports.MDETERM=null,exports.MINVERSE=null,exports.MMULT=null,exports.MOD=function(e,t){if(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;if(0===t)return error.div0;var r=Math.abs(e%t);return t>0?r:-r},exports.MROUND=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e*t<0?error.num:Math.round(e/t)*t},exports.MULTINOMIAL=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var t=0,r=1,n=0;n<e.length;n++)t+=e[n],r*=exports.FACT(e[n]);return exports.FACT(t)/r},exports.MUNIT=null,exports.ODD=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var t=Math.ceil(Math.abs(e));return t=1&t?t:t+1,e>0?t:-t},exports.PI=function(){return Math.PI},exports.POWER=function(e,t){if(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;var r=Math.pow(e,t);return isNaN(r)?error.num:r},exports.PRODUCT=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var t=1,r=0;r<e.length;r++)t*=e[r];return t},exports.QUOTIENT=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:parseInt(e/t,10)},exports.RADIANS=function(e){return(e=utils.parseNumber(e))instanceof Error?e:e*Math.PI/180},exports.RAND=function(){return Math.random()},exports.RANDBETWEEN=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e+Math.ceil((t-e+1)*Math.random())-1},exports.ROMAN=null,exports.ROUND=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:Math.round(e*Math.pow(10,t))/Math.pow(10,t)},exports.ROUNDDOWN=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:(e>0?1:-1)*Math.floor(Math.abs(e)*Math.pow(10,t))/Math.pow(10,t)},exports.ROUNDUP=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:(e>0?1:-1)*Math.ceil(Math.abs(e)*Math.pow(10,t))/Math.pow(10,t)},exports.SEC=function(e){return(e=utils.parseNumber(e))instanceof Error?e:1/Math.cos(e)},exports.SECH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:2/(Math.exp(e)+Math.exp(-e))},exports.SERIESSUM=function(e,t,r,n){if(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),n=utils.parseNumberArray(n),utils.anyIsError(e,t,r,n))return error.value;for(var o=n[0]*Math.pow(e,t),l=1;l<n.length;l++)o+=n[l]*Math.pow(e,t+l*r);return o},exports.SIGN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:e<0?-1:0===e?0:1},exports.SIN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.sin(e)},exports.SINH=function(e){return(e=utils.parseNumber(e))instanceof Error?e:(Math.exp(e)-Math.exp(-e))/2},exports.SQRT=function(e){return(e=utils.parseNumber(e))instanceof Error?e:e<0?error.num:Math.sqrt(e)},exports.SQRTPI=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.sqrt(e*Math.PI)},exports.SUBTOTAL=null,exports.ADD=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e+t},exports.MINUS=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e-t},exports.DIVIDE=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:0===t?error.div0:e/t},exports.MULTIPLY=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:e*t},exports.GTE=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.error:e>=t},exports.LT=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.error:e<t},exports.LTE=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.error:e<=t},exports.EQ=function(e,t){return 2!==arguments.length?error.na:e===t},exports.NE=function(e,t){return 2!==arguments.length?error.na:e!==t},exports.POW=function(e,t){return 2!==arguments.length?error.na:(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.error:exports.POWER(e,t)},exports.SUM=function(){for(var e=0,t=Object.keys(arguments),r=0;r<t.length;++r){var n=arguments[t[r]];if("number"==typeof n)e+=n;else if("string"==typeof n){var o=parseFloat(n);isNaN(o)||(e+=o)}else Array.isArray(n)&&(e+=exports.SUM.apply(null,n))}return e},exports.SUMIF=function(){var args=utils.argsToArray(arguments),criteria=args.pop(),range=utils.parseNumberArray(utils.flatten(args));if(range instanceof Error)return range;for(var result=0,i=0;i<range.length;i++)result+=eval(range[i]+criteria)?range[i]:0;return result},exports.SUMIFS=function(){var args=utils.argsToArray(arguments),range=utils.parseNumberArray(utils.flatten(args.shift()));if(range instanceof Error)return range;for(var criteria=args,n_range_elements=range.length,n_criterias=criteria.length,result=0,i=0;i<n_range_elements;i++){for(var el=range[i],condition="",c=0;c<n_criterias;c+=2)isNaN(criteria[c][i])?condition+='"'+criteria[c][i]+'"'+criteria[c+1]:condition+=criteria[c][i]+criteria[c+1],c!==n_criterias-1&&(condition+=" && ");eval(condition=condition.slice(0,-4))&&(result+=el)}return result},exports.SUMPRODUCT=null,exports.SUMSQ=function(){var e=utils.parseNumberArray(utils.flatten(arguments));if(e instanceof Error)return e;for(var t=0,r=e.length,n=0;n<r;n++)t+=ISNUMBER(e[n])?e[n]*e[n]:0;return t},exports.SUMX2MY2=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))return error.value;for(var r=0,n=0;n<e.length;n++)r+=e[n]*e[n]-t[n]*t[n];return r},exports.SUMX2PY2=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))return error.value;var r=0;e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumberArray(utils.flatten(t));for(var n=0;n<e.length;n++)r+=e[n]*e[n]+t[n]*t[n];return r},exports.SUMXMY2=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))return error.value;var r=0;e=utils.flatten(e),t=utils.flatten(t);for(var n=0;n<e.length;n++)r+=Math.pow(e[n]-t[n],2);return r},exports.TAN=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.tan(e)},exports.TANH=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var t=Math.exp(2*e);return(t-1)/(t+1)},exports.TRUNC=function(e,t){return(t=void 0===t?0:t,e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:(e>0?1:-1)*Math.floor(Math.abs(e)*Math.pow(10,t))/Math.pow(10,t)},exports),met.misc=((exports={}).UNIQUE=function(){for(var e=[],t=0;t<arguments.length;++t){for(var r=!1,n=arguments[t],o=0;o<e.length&&!(r=e[o]===n);++o);r||e.push(n)}return e},exports.FLATTEN=utils.flatten,exports.ARGS2ARRAY=function(){return Array.prototype.slice.call(arguments,0)},exports.REFERENCE=function(e,t){try{for(var r=t.split("."),n=e,o=0;o<r.length;++o){var l=r[o];if("]"===l[l.length-1]){var s=l.indexOf("["),i=l.substring(s+1,l.length-1);n=n[l.substring(0,s)][i]}else n=n[l]}return n}catch(a){}},exports.JOIN=function(e,t){return e.join(t)},exports.NUMBERS=function(){var e=utils.flatten(arguments);return e.filter(function(e){return"number"==typeof e})},exports.NUMERAL=null,exports),met.text=((exports={}).ASC=null,exports.BAHTTEXT=null,exports.CHAR=function(e){return(e=utils.parseNumber(e))instanceof Error?e:String.fromCharCode(e)},exports.CLEAN=function(e){var t=/[\0-\x1F]/g;return(e=e||"").replace(t,"")},exports.CODE=function(e){return(e=e||"").charCodeAt(0)},exports.CONCATENATE=function(){for(var e=utils.flatten(arguments),t=0;(t=e.indexOf(!0))>-1;)e[t]="TRUE";for(var r=0;(r=e.indexOf(!1))>-1;)e[r]="FALSE";return e.join("")},exports.DBCS=null,exports.DOLLAR=null,exports.EXACT=function(e,t){return e===t},exports.FIND=function(e,t,r){return r=void 0===r?0:r,t?t.indexOf(e,r-1)+1:null},exports.FIXED=null,exports.HTML2TEXT=function(e){var t="";return e&&(e instanceof Array?e.forEach(function(e){""!==t&&(t+="\n"),t+=e.replace(/<(?:.|\n)*?>/gm,"")}):t=e.replace(/<(?:.|\n)*?>/gm,"")),t},exports.LEFT=function(e,t){return(t=void 0===t?1:t,(t=utils.parseNumber(t))instanceof Error||"string"!=typeof e)?error.value:e?e.substring(0,t):null},exports.LEN=function(e){return 0===arguments.length?error.error:"string"==typeof e?e?e.length:0:e.length?e.length:error.value},exports.LOWER=function(e){return"string"!=typeof e?error.value:e?e.toLowerCase():e},exports.MID=function(e,t,r){if(t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(t,r)||"string"!=typeof e)return r;var n=t-1,o=n+r;return e.substring(n,o)},exports.NUMBERVALUE=null,exports.PRONETIC=null,exports.PROPER=function(e){return void 0===e||0===e.length?error.value:(!0===e&&(e="TRUE"),!1===e&&(e="FALSE"),isNaN(e)&&"number"==typeof e)?error.value:("number"==typeof e&&(e=""+e),e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))},exports.REGEXEXTRACT=function(e,t){var r=e.match(RegExp(t));return r?r[r.length>1?r.length-1:0]:null},exports.REGEXMATCH=function(e,t,r){var n=e.match(RegExp(t));return r?n:!!n},exports.REGEXREPLACE=function(e,t,r){return e.replace(RegExp(t),r)},exports.REPLACE=function(e,t,r,n){return(t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(t,r)||"string"!=typeof e||"string"!=typeof n)?error.value:e.substr(0,t-1)+n+e.substr(t-1+r)},exports.REPT=function(e,t){return(t=utils.parseNumber(t))instanceof Error?t:Array(t+1).join(e)},exports.RIGHT=function(e,t){return(t=void 0===t?1:t,(t=utils.parseNumber(t))instanceof Error)?t:e?e.substring(e.length-t):null},exports.SEARCH=function(e,t,r){var n;return"string"!=typeof e||"string"!=typeof t?error.value:(r=void 0===r?0:r,0===(n=t.toLowerCase().indexOf(e.toLowerCase(),r-1)+1)?error.value:n)},exports.SPLIT=function(e,t){return e.split(t)},exports.SUBSTITUTE=function(e,t,r,n){if(!e||!t||!r)return e;if(void 0===n)return e.replace(RegExp(t,"g"),r);for(var o=0,l=0;e.indexOf(t,o)>0;)if(o=e.indexOf(t,o+1),++l===n)return e.substring(0,o)+r+e.substring(o+t.length)},exports.T=function(e){return"string"==typeof e?e:""},exports.TEXT=null,exports.TRIM=function(e){return"string"!=typeof e?error.value:e.replace(/ +/g," ").trim()},exports.UNICHAR=exports.CHAR,exports.UNICODE=exports.CODE,exports.UPPER=function(e){return"string"!=typeof e?error.value:e.toUpperCase()},exports.VALUE=null,exports),met.stats=(SQRT2PI=2.5066282746310002,(exports={}).AVEDEV=null,exports.AVERAGE=function(){for(var e=utils.numbers(utils.flatten(arguments)),t=e.length,r=0,n=0,o=0;o<t;o++)r+=e[o],n+=1;return r/n},exports.AVERAGEA=function(){for(var e=utils.flatten(arguments),t=e.length,r=0,n=0,o=0;o<t;o++){var l=e[o];"number"==typeof l&&(r+=l),!0===l&&r++,null!==l&&n++}return r/n},exports.AVERAGEIF=function(range,criteria,average_range){if(average_range=average_range||range,range=utils.flatten(range),(average_range=utils.parseNumberArray(utils.flatten(average_range)))instanceof Error)return average_range;for(var average_count=0,result=0,i=0;i<range.length;i++)eval(range[i]+criteria)&&(result+=average_range[i],average_count++);return result/average_count},exports.AVERAGEIFS=null,exports.COUNT=function(){return utils.numbers(utils.flatten(arguments)).length},exports.COUNTA=function(){var e=utils.flatten(arguments);return e.length-exports.COUNTBLANK(e)},exports.COUNTIN=function(e,t){for(var r=0,n=0;n<e.length;n++)e[n]===t&&r++;return r},exports.COUNTBLANK=function(){for(var e,t=utils.flatten(arguments),r=0,n=0;n<t.length;n++)(null===(e=t[n])||""===e)&&r++;return r},exports.COUNTIF=function(){var args=utils.argsToArray(arguments),criteria=args.pop(),range=utils.flatten(args);/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var matches=0,i=0;i<range.length;i++)"string"!=typeof range[i]?eval(range[i]+criteria)&&matches++:eval('"'+range[i]+'"'+criteria)&&matches++;return matches},exports.COUNTIFS=function(){for(var args=utils.argsToArray(arguments),results=Array(utils.flatten(args[0]).length),i=0;i<results.length;i++)results[i]=!0;for(i=0;i<args.length;i+=2){var range=utils.flatten(args[i]),criteria=args[i+1];/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var j=0;j<range.length;j++)"string"!=typeof range[j]?results[j]=results[j]&&eval(range[j]+criteria):results[j]=results[j]&&eval('"'+range[j]+'"'+criteria)}var result=0;for(i=0;i<results.length;i++)results[i]&&result++;return result},exports.COUNTUNIQUE=function(){return UNIQUE.apply(null,utils.flatten(arguments)).length},exports.FISHER=function(e){return(e=utils.parseNumber(e))instanceof Error?e:Math.log((1+e)/(1-e))/2},exports.FISHERINV=function(e){if((e=utils.parseNumber(e))instanceof Error)return e;var t=Math.exp(2*e);return(t-1)/(t+1)},exports.FREQUENCY=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))return error.value;for(var r=e.length,n=t.length,o=[],l=0;l<=n;l++){o[l]=0;for(var s=0;s<r;s++)0===l?e[s]<=t[0]&&(o[0]+=1):l<n?e[s]>t[l-1]&&e[s]<=t[l]&&(o[l]+=1):l===n&&e[s]>t[n-1]&&(o[n]+=1)}return o},exports.LARGE=function(e,t){return(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))?e:e.sort(function(e,t){return t-e})[t-1]},exports.MAX=function(){var e=utils.numbers(utils.flatten(arguments));return 0===e.length?0:Math.max.apply(Math,e)},exports.MAXA=function(){var e=utils.arrayValuesToNumbers(utils.flatten(arguments));return 0===e.length?0:Math.max.apply(Math,e)},exports.MIN=function(){var e=utils.numbers(utils.flatten(arguments));return 0===e.length?0:Math.min.apply(Math,e)},exports.MINA=function(){var e=utils.arrayValuesToNumbers(utils.flatten(arguments));return 0===e.length?0:Math.min.apply(Math,e)},exports.MODE={},exports.MODE.MULT=function(){var e,t=utils.parseNumberArray(utils.flatten(arguments));if(t instanceof Error)return t;for(var r=t.length,n={},o=[],l=0,s=0;s<r;s++)n[e=t[s]]=n[e]?n[e]+1:1,n[e]>l&&(l=n[e],o=[]),n[e]===l&&(o[o.length]=e);return o},exports.MODE.SNGL=function(){var e=utils.parseNumberArray(utils.flatten(arguments));return e instanceof Error?e:exports.MODE.MULT(e).sort(function(e,t){return e-t})[0]},exports.PERCENTILE={},exports.PERCENTILE.EXC=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;var r=(e=e.sort(function(e,t){return e-t})).length;if(t<1/(r+1)||t>1-1/(r+1))return error.num;var n=t*(r+1)-1,o=Math.floor(n);return utils.cleanFloat(n===o?e[n]:e[o]+(n-o)*(e[o+1]-e[o]))},exports.PERCENTILE.INC=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;var r=t*((e=e.sort(function(e,t){return e-t})).length-1),n=Math.floor(r);return utils.cleanFloat(r===n?e[r]:e[n]+(r-n)*(e[n+1]-e[n]))},exports.PERCENTRANK={},exports.PERCENTRANK.EXC=function(e,t,r){if(r=void 0===r?3:r,e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))return error.value;e=e.sort(function(e,t){return e-t});for(var n=UNIQUE.apply(null,e),o=e.length,l=n.length,s=Math.pow(10,r),i=0,a=!1,u=0;!a&&u<l;)t===n[u]?(i=(e.indexOf(n[u])+1)/(o+1),a=!0):t>=n[u]&&(t<n[u+1]||u===l-1)&&(i=(e.indexOf(n[u])+1+(t-n[u])/(n[u+1]-n[u]))/(o+1),a=!0),u++;return Math.floor(i*s)/s},exports.PERCENTRANK.INC=function(e,t,r){if(r=void 0===r?3:r,e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))return error.value;e=e.sort(function(e,t){return e-t});for(var n=UNIQUE.apply(null,e),o=e.length,l=n.length,s=Math.pow(10,r),i=0,a=!1,u=0;!a&&u<l;)t===n[u]?(i=e.indexOf(n[u])/(o-1),a=!0):t>=n[u]&&(t<n[u+1]||u===l-1)&&(i=(e.indexOf(n[u])+(t-n[u])/(n[u+1]-n[u]))/(o-1),a=!0),u++;return Math.floor(i*s)/s},exports.PERMUT=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:FACT(e)/FACT(e-t)},exports.PERMUTATIONA=function(e,t){return(e=utils.parseNumber(e),t=utils.parseNumber(t),utils.anyIsError(e,t))?error.value:Math.pow(e,t)},exports.PHI=function(e){return(e=utils.parseNumber(e))instanceof Error?error.value:Math.exp(-.5*e*e)/SQRT2PI},exports.PROB=function(e,t,r,n){if(void 0===r)return 0;if(n=void 0===n?r:n,e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumberArray(utils.flatten(t)),r=utils.parseNumber(r),n=utils.parseNumber(n),utils.anyIsError(e,t,r,n))return error.value;if(r===n)return e.indexOf(r)>=0?t[e.indexOf(r)]:0;for(var o=e.sort(function(e,t){return e-t}),l=o.length,s=0,i=0;i<l;i++)o[i]>=r&&o[i]<=n&&(s+=t[e.indexOf(o[i])]);return s},exports.QUARTILE={},exports.QUARTILE.EXC=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;switch(t){case 1:return exports.PERCENTILE.EXC(e,.25);case 2:return exports.PERCENTILE.EXC(e,.5);case 3:return exports.PERCENTILE.EXC(e,.75);default:return error.num}},exports.QUARTILE.INC=function(e,t){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;switch(t){case 1:return exports.PERCENTILE.INC(e,.25);case 2:return exports.PERCENTILE.INC(e,.5);case 3:return exports.PERCENTILE.INC(e,.75);default:return error.num}},exports.RANK={},exports.RANK.AVG=function(e,t,r){if(e=utils.parseNumber(e),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))return error.value;t=utils.flatten(t);for(var n=(r=r||!1)?function(e,t){return e-t}:function(e,t){return t-e},o=(t=t.sort(n)).length,l=0,s=0;s<o;s++)t[s]===e&&l++;return l>1?(2*t.indexOf(e)+l+1)/2:t.indexOf(e)+1},exports.RANK.EQ=function(e,t,r){if(e=utils.parseNumber(e),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))return error.value;var n=(r=r||!1)?function(e,t){return e-t}:function(e,t){return t-e};return(t=t.sort(n)).indexOf(e)+1},exports.RSQ=function(e,t){return(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumberArray(utils.flatten(t)),utils.anyIsError(e,t))?error.value:Math.pow(exports.PEARSON(e,t),2)},exports.SMALL=function(e,t){return(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))?e:e.sort(function(e,t){return e-t})[t-1]},exports.STANDARDIZE=function(e,t,r){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:(e-t)/r},exports.STDEV={},exports.STDEV.P=function(){var e=exports.VAR.P.apply(this,arguments);return Math.sqrt(e)},exports.STDEV.S=function(){var e=exports.VAR.S.apply(this,arguments);return Math.sqrt(e)},exports.STDEVA=function(){var e=exports.VARA.apply(this,arguments);return Math.sqrt(e)},exports.STDEVPA=function(){var e=exports.VARPA.apply(this,arguments);return Math.sqrt(e)},exports.VAR={},exports.VAR.P=function(){for(var e=utils.numbers(utils.flatten(arguments)),t=e.length,r=0,n=exports.AVERAGE(e),o=0;o<t;o++)r+=Math.pow(e[o]-n,2);return r/t},exports.VAR.S=function(){for(var e=utils.numbers(utils.flatten(arguments)),t=e.length,r=0,n=exports.AVERAGE(e),o=0;o<t;o++)r+=Math.pow(e[o]-n,2);return r/(t-1)},exports.VARA=function(){for(var e=utils.flatten(arguments),t=e.length,r=0,n=0,o=exports.AVERAGEA(e),l=0;l<t;l++){var s=e[l];"number"==typeof s?r+=Math.pow(s-o,2):!0===s?r+=Math.pow(1-o,2):r+=Math.pow(0-o,2),null!==s&&n++}return r/(n-1)},exports.VARPA=function(){for(var e=utils.flatten(arguments),t=e.length,r=0,n=0,o=exports.AVERAGEA(e),l=0;l<t;l++){var s=e[l];"number"==typeof s?r+=Math.pow(s-o,2):!0===s?r+=Math.pow(1-o,2):r+=Math.pow(0-o,2),null!==s&&n++}return r/n},exports.WEIBULL={},exports.WEIBULL.DIST=function(e,t,r,n){return(e=utils.parseNumber(e),t=utils.parseNumber(t),r=utils.parseNumber(r),utils.anyIsError(e,t,r))?error.value:n?1-Math.exp(-Math.pow(e/r,t)):Math.pow(e,t-1)*Math.exp(-Math.pow(e/r,t))*t/Math.pow(r,t)},exports.Z={},exports.Z.TEST=function(e,t,r){if(e=utils.parseNumberArray(utils.flatten(e)),t=utils.parseNumber(t),utils.anyIsError(e,t))return error.value;r=r||exports.STDEV.S(e);var n=e.length;return 1-exports.NORM.S.DIST((exports.AVERAGE(e)-t)/(r/Math.sqrt(n)),!0)},exports),met.utils=((exports={}).PROGRESS=function(e,t){return'<div style="width:'+(e||"0")+"%;height:4px;background-color:"+(t||"red")+';margin-top:1px;"></div>'},exports.RATING=function(e){for(var t='<div class="jrating">',r=0;r<5;r++)r<e?t+='<div class="jrating-selected"></div>':t+="<div></div>";return t+"</div>"},exports);for(var i=0;i<Object.keys(met).length;i++)for(var methods=met[Object.keys(met)[i]],keys=Object.keys(methods),j=0;j<keys.length;j++)if(methods[keys[j]]){if("function"==typeof methods[keys[j]]||"object"==typeof methods[keys[j]]){if(window[keys[j]]=methods[keys[j]],window[keys[j]].toString=function(){return"#ERROR"},"object"==typeof methods[keys[j]])for(var tmp=Object.keys(methods[keys[j]]),z=0;z<tmp.length;z++)window[keys[j]][tmp[z]].toString=function(){return"#ERROR"}}else window[keys[j]]=function(){return keys[j]+"Not implemented"}}else window[keys[j]]=function(){return keys[j]+"Not implemented"};var x=null,y=null,instance=null;window.TABLE=function(){return instance},window.COLUMN=window.COL=function(){return parseInt(x)+1},window.ROW=function(){return parseInt(y)+1},window.CELL=function(){return F.getColumnNameFromCoords(x,y)},window.VALUE=function(e,t,r){return instance.getValueFromCoords(parseInt(e)-1,parseInt(t)-1,r)},window.THISROWCELL=function(e){return instance.getValueFromCoords(parseInt(e)-1,parseInt(y))};var secureFormula=function(e,t){for(var r="",n=0,o=["=","!",">","<"],l=0;l<e.length;l++)'"'==e[l]&&(n=0==n?1:0),1==n?r+=e[l]:(r+=e[l].toUpperCase(),!0==t&&l>0&&"="==e[l]&&-1==o.indexOf(e[l-1])&&-1==o.indexOf(e[l+1])&&(r+="="));return(r=(r=(r=r.replace(/\^/g,"**")).replace(/\<\>/g,"!=")).replace(/\&/g,"+")).replace(/\$/g,"")},tokensUpdate=function(e,t){for(var r=0;r<e.length;r++){var n=F.getTokensFromRange(e[r]);t=t.replace(e[r],"["+n.join(",")+"]")}return t},F=function(e,t,r,n,o){instance=o,x=r,y=n;var l="",s=Object.keys(t);if(s.length)for(var r=0;r<s.length;r++)-1==s[r].indexOf(".")&&-1==s[r].indexOf("!")?l+="var "+s[r]+" = "+t[s[r]]+";\n":l+=s[r]+" = "+t[s[r]]+";\n";var i=(e=secureFormula(e=(e=e.replace(/\$/g,"")).replace(/\!/g,"."),!0)).match(/([A-Z]+[0-9]*\.)?(\$?[A-Z]+\$?[0-9]+):(\$?[A-Z]+\$?[0-9]+)?/g);return i&&i.length&&(e=tokensUpdate(i,e)),Function(l+"; return "+e)()},getColumnName=function(e){var t="";return e>701?(t+=String.fromCharCode(64+parseInt(e/676)),t+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(t+=String.fromCharCode(64+parseInt(e/26))),t+=String.fromCharCode(65+e%26)};return F.getColumnNameFromCoords=function(e,t){return getColumnName(parseInt(e))+(parseInt(t)+1)},F.getCoordsFromColumnName=function(e){var t=/^[a-zA-Z]+/.exec(e);if(t){for(var r=0,n=0;n<t[0].length;n++)r+=parseInt(t[0].charCodeAt(n)-64)*Math.pow(26,t[0].length-1-n);--r<0&&(r=0);var o=parseInt(/[0-9]+$/.exec(e))||null;return o>0&&o--,[r,o]}},F.getRangeFromTokens=function(e){e=e.filter(function(e){return"#REF!"!=e});for(var t="",r="",n=0;n<e.length;n++)e[n].indexOf(".")>=0?t=".":e[n].indexOf("!")>=0&&(t="!"),t&&(r=e[n].split(t),e[n]=r[1],r=r[0]+t);return(e.sort(function(e,t){var r=Helpers.getCoordsFromColumnName(e),n=Helpers.getCoordsFromColumnName(t);return r[1]>n[1]?1:r[1]<n[1]?-1:r[0]>n[0]?1:r[0]<n[0]?-1:0}),e.length)?r+(e[0]+":")+e[e.length-1]:"#REF!"},F.getTokensFromRange=function(e){if(e.indexOf(".")>0){var t=e.split(".");e=t[1],t=t[0]+"."}else if(e.indexOf("!")>0){var t=e.split("!");e=t[1],t=t[0]+"!"}else var t="";var e=e.split(":"),r=F.getCoordsFromColumnName(e[0]),n=F.getCoordsFromColumnName(e[1]);if(r[0]<=n[0])var o=r[0],l=n[0];else var o=n[0],l=r[0];if(null===r[1]&&null==n[1])for(var s=null,i=null,a=Object.keys(vars),u=0;u<a.length;u++){var c=F.getCoordsFromColumnName(a[u]);c[0]===r[0]&&(null===s||c[1]<s)&&(s=c[1]),c[0]===n[0]&&(null===i||c[1]>i)&&(i=c[1])}else if(r[1]<=n[1])var s=r[1],i=n[1];else var s=n[1],i=r[1];for(var d=[],p=s;p<=i;p++){for(var f=[],u=o;u<=l;u++)f.push(t+F.getColumnNameFromCoords(u,p));d.push(f)}return d},F.setFormula=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)"function"==typeof e[t[r]]&&(window[t[r]]=e[t[r]])},F}();if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.jspreadsheet=e.jexcel=t()}(this,function(){"use strict";var $,info,component,Version=(info={title:"Jspreadsheet",version:"4.10.1",type:"CE",host:"https://bossanova.uk/jspreadsheet",license:"MIT",print:function(){return[this.title+" "+this.type+" "+this.version,this.host,this.license].join("\r\n")}},function(){return info}),isFormula=function(e){var t=(""+e)[0];return"="==t||"#"==t},getMask=function(e){if(e.format||e.mask||e.locale){var t={};return e.mask?t.mask=e.mask:e.format?t.mask=e.format:(t.locale=e.locale,t.options=e.options),e.decimal&&(t.options||(t.options={}),t.options={decimal:e.decimal}),t}return null},jexcel=function(el,options){var obj={};if(obj.options={},!(el instanceof Element||el instanceof HTMLDocument))return console.error("Jspreadsheet: el is not a valid DOM element"),!1;if("TABLE"==el.tagName){if(!(options=jexcel.createFromTable(el,options)))return console.error("Jspreadsheet: el is not a valid DOM element"),!1;var div=document.createElement("div");el.parentNode.insertBefore(div,el),el.remove(),el=div}var defaults={url:null,method:"GET",requestVariables:null,data:null,sorting:null,copyCompatibility:!1,root:null,rows:[],columns:[],colHeaders:[],colWidths:[],colAlignments:[],nestedHeaders:null,defaultColWidth:50,defaultColAlign:"center",defaultRowHeight:null,minSpareRows:0,minSpareCols:0,minDimensions:[0,0],allowExport:!0,includeHeadersOnDownload:!1,includeHeadersOnCopy:!1,columnSorting:!0,columnDrag:!1,columnResize:!0,rowResize:!1,rowDrag:!0,editable:!0,allowInsertRow:!0,allowManualInsertRow:!0,allowInsertColumn:!0,allowManualInsertColumn:!0,allowDeleteRow:!0,allowDeletingAllRows:!1,allowDeleteColumn:!0,allowRenameColumn:!0,allowComments:!1,wordWrap:!1,imageOptions:null,csv:null,csvFileName:"jspreadsheet",csvHeaders:!0,csvDelimiter:",",parseTableFirstRowAsHeader:!1,parseTableAutoCellType:!1,selectionCopy:!0,mergeCells:{},toolbar:null,search:!1,pagination:!1,paginationOptions:null,fullscreen:!1,lazyLoading:!1,loadingSpin:!1,tableOverflow:!1,tableHeight:"300px",tableWidth:null,textOverflow:!1,meta:null,style:null,classes:null,parseFormulas:!0,autoIncrement:!0,autoCasting:!0,secureFormulas:!0,stripHTML:!0,stripHTMLOnCopy:!1,filters:!1,footers:null,onundo:null,onredo:null,onload:null,onchange:null,oncomments:null,onbeforechange:null,onafterchanges:null,onbeforeinsertrow:null,oninsertrow:null,onbeforeinsertcolumn:null,oninsertcolumn:null,onbeforedeleterow:null,ondeleterow:null,onbeforedeletecolumn:null,ondeletecolumn:null,onmoverow:null,onmovecolumn:null,onresizerow:null,onresizecolumn:null,onsort:null,onselection:null,oncopy:null,onpaste:null,onbeforepaste:null,onmerge:null,onfocus:null,onblur:null,onchangeheader:null,oncreateeditor:null,oneditionstart:null,oneditionend:null,onchangestyle:null,onchangemeta:null,onchangepage:null,onbeforesave:null,onsave:null,onevent:null,persistance:!1,updateTable:null,detachForUpdates:!1,freezeColumns:null,text:{noRecordsFound:"No records found",showingPage:"Showing page {0} of {1} entries",show:"Show ",search:"Search",entries:" entries",columnName:"Column name",insertANewColumnBefore:"Insert a new column before",insertANewColumnAfter:"Insert a new column after",deleteSelectedColumns:"Delete selected columns",renameThisColumn:"Rename this column",orderAscending:"Order ascending",orderDescending:"Order descending",insertANewRowBefore:"Insert a new row before",insertANewRowAfter:"Insert a new row after",deleteSelectedRows:"Delete selected rows",editComments:"Edit comments",addComments:"Add comments",comments:"Comments",clearComments:"Clear comments",copy:"Copy...",paste:"Paste...",saveAs:"Save as...",about:"About",areYouSureToDeleteTheSelectedRows:"Are you sure to delete the selected rows?",areYouSureToDeleteTheSelectedColumns:"Are you sure to delete the selected columns?",thisActionWillDestroyAnyExistingMergedCellsAreYouSure:"This action will destroy any existing merged cells. Are you sure?",thisActionWillClearYourSearchResultsAreYouSure:"This action will clear your search results. Are you sure?",thereIsAConflictWithAnotherMergedCell:"There is a conflict with another merged cell",invalidMergeProperties:"Invalid merged properties",cellAlreadyMerged:"Cell already merged",noCellsSelected:"No cells selected"},about:!0};for(var property in defaults)if(options&&options.hasOwnProperty(property)){if("text"===property)for(var textKey in obj.options[property]=defaults[property],options[property])options[property].hasOwnProperty(textKey)&&(obj.options[property][textKey]=options[property][textKey]);else obj.options[property]=options[property]}else obj.options[property]=defaults[property];obj.el=el,obj.corner=null,obj.contextMenu=null,obj.textarea=null,obj.ads=null,obj.content=null,obj.table=null,obj.thead=null,obj.tbody=null,obj.rows=[],obj.results=null,obj.searchInput=null,obj.toolbar=null,obj.pagination=null,obj.pageNumber=null,obj.headerContainer=null,obj.colgroupContainer=null,obj.headers=[],obj.records=[],obj.history=[],obj.formula=[],obj.colgroup=[],obj.selection=[],obj.highlighted=[],obj.selectedCell=null,obj.selectedContainer=null,obj.style=[],obj.data=null,obj.filter=null,obj.filters=[],obj.cursor=null,obj.historyIndex=-1,obj.ignoreEvents=!1,obj.ignoreHistory=!1,obj.edition=null,obj.hashString=null,obj.resizing=null,obj.dragging=null,!0==obj.options.lazyLoading&&!1==obj.options.tableOverflow&&!1==obj.options.fullscreen&&(console.error("Jspreadsheet: The lazyloading only works when tableOverflow = yes or fullscreen = yes"),obj.options.lazyLoading=!1),obj.fullscreen=function(e){null==e&&(e=!obj.options.fullscreen),obj.options.fullscreen!=e&&(obj.options.fullscreen=e,!0==e?el.classList.add("fullscreen"):el.classList.remove("fullscreen"))},obj.dispatch=function(e){if(!obj.ignoreEvents){if("function"==typeof obj.options.onevent)var t=obj.options.onevent.apply(this,arguments);if("function"==typeof obj.options[e])var t=obj.options[e].apply(this,Array.prototype.slice.call(arguments,1))}if("onafterchanges"==e&&obj.options.persistance){var r=!0==obj.options.persistance?obj.options.url:obj.options.persistance,n=obj.prepareJson(arguments[2]);obj.save(r,n)}return t},obj.prepareTable=function(){var e=obj.options.columns.length;if(obj.options.data&&void 0!==obj.options.data[0]){var t=Object.keys(obj.options.data[0]);t.length>e&&(e=t.length)}obj.options.minDimensions[0]>e&&(e=obj.options.minDimensions[0]);for(var r=[],n=0;n<e;n++)obj.options.colHeaders[n]||(obj.options.colHeaders[n]=""),obj.options.colWidths[n]||(obj.options.colWidths[n]=obj.options.defaultColWidth),obj.options.colAlignments[n]||(obj.options.colAlignments[n]=obj.options.defaultColAlign),obj.options.columns[n]?obj.options.columns[n].type||(obj.options.columns[n].type="text"):obj.options.columns[n]={type:"text"},obj.options.columns[n].name||(obj.options.columns[n].name=t&&t[n]?t[n]:n),obj.options.columns[n].source||(obj.options.columns[n].source=[]),obj.options.columns[n].options||(obj.options.columns[n].options=[]),obj.options.columns[n].editor||(obj.options.columns[n].editor=null),obj.options.columns[n].allowEmpty||(obj.options.columns[n].allowEmpty=!1),obj.options.columns[n].title||(obj.options.columns[n].title=obj.options.colHeaders[n]?obj.options.colHeaders[n]:""),obj.options.columns[n].width||(obj.options.columns[n].width=obj.options.colWidths[n]?obj.options.colWidths[n]:obj.options.defaultColWidth),obj.options.columns[n].align||(obj.options.columns[n].align=obj.options.colAlignments[n]?obj.options.colAlignments[n]:"center"),"autocomplete"==obj.options.columns[n].type||"dropdown"==obj.options.columns[n].type?obj.options.columns[n].url&&r.push({url:obj.options.columns[n].url,index:n,method:"GET",dataType:"json",success:function(e){for(var t=0;t<e.length;t++)obj.options.columns[this.index].source.push(e[t])}}):"calendar"!=obj.options.columns[n].type||obj.options.columns[n].options.format||(obj.options.columns[n].options.format="DD/MM/YYYY");r.length?jSuites.ajax(r,function(){obj.createTable()}):obj.createTable()},obj.createTable=function(){obj.table=document.createElement("table"),obj.thead=document.createElement("thead"),obj.tbody=document.createElement("tbody"),obj.headers=[],obj.colgroup=[],obj.content=document.createElement("div"),obj.content.classList.add("jexcel_content"),obj.content.onscroll=function(e){obj.scrollControls(e)},obj.content.onwheel=function(e){obj.wheelControls(e)},obj.toolbar=document.createElement("div"),obj.toolbar.classList.add("jexcel_toolbar");var e=document.createElement("div"),t=document.createTextNode(obj.options.text.search+": ");obj.searchInput=document.createElement("input"),obj.searchInput.classList.add("jexcel_search"),e.appendChild(t),e.appendChild(obj.searchInput),obj.searchInput.onfocus=function(){obj.resetSelection()};var r=document.createElement("div");if(obj.options.pagination>0&&obj.options.paginationOptions&&obj.options.paginationOptions.length>0){obj.paginationDropdown=document.createElement("select"),obj.paginationDropdown.classList.add("jexcel_pagination_dropdown"),obj.paginationDropdown.onchange=function(){obj.options.pagination=parseInt(this.value),obj.page(0)};for(var n=0;n<obj.options.paginationOptions.length;n++){var o=document.createElement("option");o.value=obj.options.paginationOptions[n],o.innerHTML=obj.options.paginationOptions[n],obj.paginationDropdown.appendChild(o)}obj.paginationDropdown.value=obj.options.pagination,r.appendChild(document.createTextNode(obj.options.text.show)),r.appendChild(obj.paginationDropdown),r.appendChild(document.createTextNode(obj.options.text.entries))}var l=document.createElement("div");l.classList.add("jexcel_filter"),l.appendChild(r),l.appendChild(e),obj.colgroupContainer=document.createElement("colgroup");var s=document.createElement("col");if(s.setAttribute("width","50"),obj.colgroupContainer.appendChild(s),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var i=0;i<obj.options.nestedHeaders.length;i++)obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders[i]));else obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders))}obj.headerContainer=document.createElement("tr");var s=document.createElement("td");s.classList.add("jexcel_selectall"),obj.headerContainer.appendChild(s);for(var n=0;n<obj.options.columns.length;n++)obj.createCellHeader(n),obj.headerContainer.appendChild(obj.headers[n]),obj.colgroupContainer.appendChild(obj.colgroup[n]);if(obj.thead.appendChild(obj.headerContainer),!0==obj.options.filters){obj.filter=document.createElement("tr");var a=document.createElement("td");obj.filter.appendChild(a);for(var n=0;n<obj.options.columns.length;n++){var a=document.createElement("td");a.innerHTML="&nbsp;",a.setAttribute("data-x",n),a.className="jexcel_column_filter","hidden"==obj.options.columns[n].type&&(a.style.display="none"),obj.filter.appendChild(a)}obj.thead.appendChild(obj.filter)}obj.table=document.createElement("table"),obj.table.classList.add("jexcel"),obj.table.setAttribute("cellpadding","0"),obj.table.setAttribute("cellspacing","0"),obj.table.setAttribute("unselectable","yes"),obj.table.appendChild(obj.colgroupContainer),obj.table.appendChild(obj.thead),obj.table.appendChild(obj.tbody),obj.options.textOverflow||obj.table.classList.add("jexcel_overflow"),obj.corner=document.createElement("div"),obj.corner.className="jexcel_corner",obj.corner.setAttribute("unselectable","on"),obj.corner.setAttribute("onselectstart","return false"),!1==obj.options.selectionCopy&&(obj.corner.style.display="none"),obj.textarea=document.createElement("textarea"),obj.textarea.className="jexcel_textarea",obj.textarea.id="jexcel_textarea",obj.textarea.tabIndex="-1",obj.contextMenu=document.createElement("div"),obj.contextMenu.className="jexcel_contextmenu",jSuites.contextmenu(obj.contextMenu,{onclick:function(){obj.contextMenu.contextmenu.close(!1)}});var u=document.createElement("a");u.setAttribute("href","https://bossanova.uk/jspreadsheet/"),obj.ads=document.createElement("div"),obj.ads.className="jexcel_about";try{if("undefined"!=typeof sessionStorage&&!sessionStorage.getItem("jexcel")){sessionStorage.setItem("jexcel",!0);var c=document.createElement("img");c.src="//bossanova.uk/jspreadsheet/logo.png",u.appendChild(c)}}catch(d){}var p=document.createElement("span");p.innerHTML="Jspreadsheet CE",u.appendChild(p),obj.ads.appendChild(u),document.createElement("div").classList.add("jexcel_table"),obj.pagination=document.createElement("div"),obj.pagination.classList.add("jexcel_pagination");var f=document.createElement("div"),g=document.createElement("div");if(obj.pagination.appendChild(f),obj.pagination.appendChild(g),obj.options.pagination||(obj.pagination.style.display="none"),!0==obj.options.search&&el.appendChild(l),obj.content.appendChild(obj.table),obj.content.appendChild(obj.corner),obj.content.appendChild(obj.textarea),el.appendChild(obj.toolbar),el.appendChild(obj.content),el.appendChild(obj.pagination),el.appendChild(obj.contextMenu),el.appendChild(obj.ads),el.classList.add("jexcel_container"),obj.options.toolbar&&obj.options.toolbar.length&&obj.createToolbar(),!0==obj.options.fullscreen?el.classList.add("fullscreen"):!0==obj.options.tableOverflow&&(obj.options.tableHeight&&(obj.content.style["overflow-y"]="auto",obj.content.style["box-shadow"]="rgb(221 221 221) 2px 2px 5px 0.1px",obj.content.style.maxHeight=obj.options.tableHeight),obj.options.tableWidth&&(obj.content.style["overflow-x"]="auto",obj.content.style.width=obj.options.tableWidth)),!0!=obj.options.tableOverflow&&obj.options.toolbar&&el.classList.add("with-toolbar"),!0==obj.options.columnDrag&&obj.thead.classList.add("draggable"),!0==obj.options.columnResize&&obj.thead.classList.add("resizable"),!0==obj.options.rowDrag&&obj.tbody.classList.add("draggable"),!0==obj.options.rowResize&&obj.tbody.classList.add("resizable"),obj.setData(),obj.options.style&&obj.setStyle(obj.options.style,null,null,1,1),obj.options.classes)for(var h=Object.keys(obj.options.classes),n=0;n<h.length;n++){var m=jexcel.getIdFromColumnName(h[n],!0);obj.records[m[1]][m[0]].classList.add(obj.options.classes[h[n]])}},obj.refresh=function(){obj.options.url?(!0==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(e){obj.options.data=e.data?e.data:e,obj.setData(),!0==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.setData()},obj.setData=function(e){if(e&&("string"==typeof e&&(e=JSON.parse(e)),obj.options.data=e),obj.options.data||(obj.options.data=[]),obj.options.data&&obj.options.data[0]&&!Array.isArray(obj.options.data[0])){for(var e=[],t=0;t<obj.options.data.length;t++){for(var r=[],n=0;n<obj.options.columns.length;n++)r[n]=obj.options.data[t][obj.options.columns[n].name];e.push(r)}obj.options.data=e}var t=0,n=0,o=obj.options.columns.length,l=obj.options.data.length,s=obj.options.minDimensions[0],i=obj.options.minDimensions[1],a=s>o?s:o,u=i>l?i:l;for(t=0;t<u;t++)for(n=0;n<a;n++)void 0==obj.options.data[t]&&(obj.options.data[t]=[]),void 0==obj.options.data[t][n]&&(obj.options.data[t][n]="");if(obj.rows=[],obj.results=null,obj.records=[],obj.history=[],obj.historyIndex=-1,obj.tbody.innerHTML="",!0==obj.options.lazyLoading){var c=0,d=obj.options.data.length<100?obj.options.data.length:100;obj.options.pagination&&(obj.options.pagination=!1,console.error("Jspreadsheet: Pagination will be disable due the lazyLoading"))}else if(obj.options.pagination)obj.pageNumber||(obj.pageNumber=0),obj.options.pagination,c=obj.options.pagination*obj.pageNumber,d=obj.options.pagination*obj.pageNumber+obj.options.pagination,obj.options.data.length<d&&(d=obj.options.data.length);else var c=0,d=obj.options.data.length;for(t=0;t<obj.options.data.length;t++){var p=obj.createRow(t,obj.options.data[t]);t>=c&&t<d&&obj.tbody.appendChild(p)}if(!0==obj.options.lazyLoading||obj.options.pagination&&obj.updatePagination(),obj.options.mergeCells)for(var f=Object.keys(obj.options.mergeCells),n=0;n<f.length;n++){var g=obj.options.mergeCells[f[n]];obj.setMerge(f[n],g[0],g[1],1)}obj.updateTable(),obj.dispatch("onload",el,obj)},obj.getData=function(e,t){for(var r=[],n=0,o=0,l=!0==t||!1==obj.options.copyCompatibility,s=obj.options.columns.length,i=obj.options.data.length,a=0;a<i;a++){n=0;for(var u=0;u<s;u++)(!e||obj.records[a][u].classList.contains("highlight"))&&(r[o]||(r[o]=[]),l?r[o][n]=obj.options.data[a][u]:r[o][n]=obj.records[a][u].innerHTML,n++);n>0&&o++}return r},obj.getJsonRow=function(e){for(var t=obj.options.data[e],r=obj.options.columns.length,n={},o=0;o<r;o++)obj.options.columns[o].name||(obj.options.columns[o].name=o),n[obj.options.columns[o].name]=t[o];return n},obj.getJson=function(e){for(var t=[],r=obj.options.columns.length,n=obj.options.data.length,o=0;o<n;o++){for(var l=null,s=0;s<r;s++)(!e||obj.records[o][s].classList.contains("highlight"))&&(null==l&&(l={}),obj.options.columns[s].name||(obj.options.columns[s].name=s),l[obj.options.columns[s].name]=obj.options.data[o][s]);null!=l&&t.push(l)}return t},obj.prepareJson=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].x,o=e[r].y,l=obj.options.columns[n].name?obj.options.columns[n].name:n;t[o]||(t[o]={row:o,data:{}}),t[o].data[l]=e[r].newValue}return t.filter(function(e){return null!=e})},obj.save=function(e,t){var r=obj.dispatch("onbeforesave",el,obj,t);if(r)var t=r;else if(!1===r)return!1;jSuites.ajax({url:e,method:"POST",dataType:"json",data:{data:JSON.stringify(t)},success:function(e){obj.dispatch("onsave",el,obj,t)}})},obj.getRowData=function(e){return obj.options.data[e]},obj.setRowData=function(e,t){for(var r=0;r<obj.headers.length;r++){var n=jexcel.getColumnNameFromId([r,e]);null!=t[r]&&obj.setValue(n,t[r])}},obj.getColumnData=function(e){for(var t=[],r=0;r<obj.options.data.length;r++)t.push(obj.options.data[r][e]);return t},obj.setColumnData=function(e,t){for(var r=0;r<obj.rows.length;r++){var n=jexcel.getColumnNameFromId([e,r]);null!=t[r]&&obj.setValue(n,t[r])}},obj.createRow=function(e,t){if(obj.records[e]||(obj.records[e]=[]),!t)var t=obj.options.data[e];obj.rows[e]=document.createElement("tr"),obj.rows[e].setAttribute("data-y",e);var r=null;obj.options.defaultRowHeight&&(obj.rows[e].style.height=obj.options.defaultRowHeight+"px"),obj.options.rows[e]&&(obj.options.rows[e].height&&(obj.rows[e].style.height=obj.options.rows[e].height),obj.options.rows[e].title&&(r=obj.options.rows[e].title)),r||(r=parseInt(e+1));var n=document.createElement("td");n.innerHTML=r,n.setAttribute("data-y",e),n.className="jexcel_row",obj.rows[e].appendChild(n);for(var o=0;o<obj.options.columns.length;o++)obj.records[e][o]=obj.createCell(o,e,t[o]),obj.rows[e].appendChild(obj.records[e][o]);return obj.rows[e]},obj.parseValue=function(e,t,r,n){"="==(""+r).substr(0,1)&&!0==obj.options.parseFormulas&&(r=obj.executeFormula(r,e,t));var o=obj.options.columns[e];if(o&&!isFormula(r)){var l=null;if(l=getMask(o)){r&&r==Number(r)&&(r=Number(r));var s=jSuites.mask.render(r,l,!0);if(n&&l.mask){var i=l.mask.split(";");i[1]&&(i[1].match(RegExp("\\[Red\\]","gi"))&&(r<0?n.classList.add("red"):n.classList.remove("red")),i[1].match(RegExp("\\(","gi"))&&r<0&&(s="("+s+")"))}s&&(r=s)}}return r};var validDate=function(e){return"-"==(e=""+e).substr(4,1)&&"-"==e.substr(7,1)||4==(e=e.split("-"))[0].length&&e[0]==Number(e[0])&&2==e[1].length&&e[1]==Number(e[1])};obj.createCell=function(e,t,r){var n=document.createElement("td");if(n.setAttribute("data-x",e),n.setAttribute("data-y",t),"="==(""+r).substr(0,1)&&!0==obj.options.secureFormulas){var o=secureFormula(r);o!=r&&(r=o)}if(obj.options.columns[e].editor)!1===obj.options.stripHTML||!1===obj.options.columns[e].stripHTML?n.innerHTML=r:n.innerText=r,"function"==typeof obj.options.columns[e].editor.createCell&&(n=obj.options.columns[e].editor.createCell(n));else if("hidden"==obj.options.columns[e].type)n.style.display="none",n.innerText=r;else if("checkbox"==obj.options.columns[e].type||"radio"==obj.options.columns[e].type){var l=document.createElement("input");l.type=obj.options.columns[e].type,l.name="c"+e,l.checked=1==r||!0==r||"true"==r,l.onclick=function(){obj.setValue(n,this.checked)},(!0==obj.options.columns[e].readOnly||!1==obj.options.editable)&&l.setAttribute("disabled","disabled"),n.appendChild(l),obj.options.data[t][e]=l.checked}else if("calendar"==obj.options.columns[e].type){var s=null;if(!validDate(r)){var i=jSuites.calendar.extractDateFromString(r,obj.options.columns[e].options.format);i&&(s=i)}n.innerText=jSuites.calendar.getDateString(s||r,obj.options.columns[e].options.format)}else if("dropdown"==obj.options.columns[e].type||"autocomplete"==obj.options.columns[e].type)n.classList.add("jexcel_dropdown"),n.innerText=obj.getDropDownValue(e,r);else if("color"==obj.options.columns[e].type){if("square"==obj.options.columns[e].render){var a=document.createElement("div");a.className="color",a.style.backgroundColor=r,n.appendChild(a)}else n.style.color=r,n.innerText=r}else if("image"==obj.options.columns[e].type){if(r&&"data:image"==r.substr(0,10)){var u=document.createElement("img");u.src=r,n.appendChild(u)}}else"html"==obj.options.columns[e].type?n.innerHTML=stripScript(obj.parseValue(e,t,r,n)):!1===obj.options.stripHTML||!1===obj.options.columns[e].stripHTML?n.innerHTML=stripScript(obj.parseValue(e,t,r,n)):n.innerText=obj.parseValue(e,t,r,n);!0==obj.options.columns[e].readOnly&&(n.className="readonly");var c=obj.options.columns[e].align?obj.options.columns[e].align:"center";return n.style.textAlign=c,!1!=obj.options.columns[e].wordWrap&&(!0==obj.options.wordWrap||!0==obj.options.columns[e].wordWrap||n.innerHTML.length>200)&&(n.style.whiteSpace="pre-wrap"),e>0&&!0==this.options.textOverflow&&(r||n.innerHTML?obj.records[t][e-1].style.overflow="hidden":e==obj.options.columns.length-1&&(n.style.overflow="hidden")),n},obj.createCellHeader=function(e){var t=obj.options.columns[e].width?obj.options.columns[e].width:obj.options.defaultColWidth,r=obj.options.columns[e].align?obj.options.columns[e].align:obj.options.defaultColAlign;obj.headers[e]=document.createElement("td"),obj.options.stripHTML?obj.headers[e].innerText=obj.options.columns[e].title?obj.options.columns[e].title:jexcel.getColumnName(e):obj.headers[e].innerHTML=obj.options.columns[e].title?obj.options.columns[e].title:jexcel.getColumnName(e),obj.headers[e].setAttribute("data-x",e),obj.headers[e].style.textAlign=r,obj.options.columns[e].title&&obj.headers[e].setAttribute("title",obj.options.columns[e].title),obj.options.columns[e].id&&obj.headers[e].setAttribute("id",obj.options.columns[e].id),obj.colgroup[e]=document.createElement("col"),obj.colgroup[e].setAttribute("width",t),"hidden"==obj.options.columns[e].type&&(obj.headers[e].style.display="none",obj.colgroup[e].style.display="none")},obj.updateNestedHeader=function(e,t,r){obj.options.nestedHeaders[t][e].title&&(obj.options.nestedHeaders[t][e].title=r,obj.options.nestedHeaders[t].element.children[e+1].innerText=r)},obj.createNestedHeader=function(e){var t=document.createElement("tr");t.classList.add("jexcel_nested");var r=document.createElement("td");t.appendChild(r),e.element=t;for(var n=0,o=0;o<e.length;o++){e[o].colspan||(e[o].colspan=1),e[o].align||(e[o].align="center"),e[o].title||(e[o].title="");for(var l=e[o].colspan,s=[],i=0;i<l;i++)obj.options.columns[n]&&"hidden"==obj.options.columns[n].type&&l++,s.push(n),n++;var r=document.createElement("td");r.setAttribute("data-column",s.join(",")),r.setAttribute("colspan",e[o].colspan),r.setAttribute("align",e[o].align),r.innerText=e[o].title,t.appendChild(r)}return t},obj.createToolbar=function(e){if(e)obj.options.toolbar=e;else var e=obj.options.toolbar;for(var t=0;t<e.length;t++)if("i"==e[t].type){var r=document.createElement("i");r.classList.add("jexcel_toolbar_item"),r.classList.add("material-icons"),r.setAttribute("data-k",e[t].k),r.setAttribute("data-v",e[t].v),r.setAttribute("id",e[t].id),e[t].tooltip&&r.setAttribute("title",e[t].tooltip),e[t].onclick&&(e[t].onclick,1)?r.onclick=function(t){var r=t;return function(){e[r].onclick(el,obj,this)}}(t):r.onclick=function(){var e=this.getAttribute("data-k"),t=this.getAttribute("data-v");obj.setStyle(obj.highlighted,e,t)},r.innerText=e[t].content,obj.toolbar.appendChild(r)}else if("select"==e[t].type){var r=document.createElement("select");r.classList.add("jexcel_toolbar_item"),r.setAttribute("data-k",e[t].k),e[t].tooltip&&r.setAttribute("title",e[t].tooltip),e[t].onchange&&(e[t].onchange,1)?r.onchange=e[t].onchange:r.onchange=function(){var e=this.getAttribute("data-k");obj.setStyle(obj.highlighted,e,this.value)};for(var n=0;n<e[t].v.length;n++){var o=document.createElement("option");o.value=e[t].v[n],o.innerText=e[t].v[n],r.appendChild(o)}obj.toolbar.appendChild(r)}else if("color"==e[t].type){var r=document.createElement("i");r.classList.add("jexcel_toolbar_item"),r.classList.add("material-icons"),r.setAttribute("data-k",e[t].k),r.setAttribute("data-v",""),e[t].tooltip&&r.setAttribute("title",e[t].tooltip),obj.toolbar.appendChild(r),r.innerText=e[t].content,jSuites.color(r,{onchange:function(e,t){var r=e.getAttribute("data-k");obj.setStyle(obj.highlighted,r,t)}})}},obj.setMerge=function(e,t,r,n){var o=!1;if(!e){if(!obj.highlighted.length)return alert(obj.options.text.noCellsSelected),null;var l=parseInt(obj.highlighted[0].getAttribute("data-x")),s=parseInt(obj.highlighted[0].getAttribute("data-y")),i=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-x")),a=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-y")),e=jexcel.getColumnNameFromId([l,s]),t=i-l+1,r=a-s+1}var u=jexcel.getIdFromColumnName(e,!0);if(obj.options.mergeCells[e])obj.records[u[1]][u[0]].getAttribute("data-merged")&&(o=obj.options.text.cellAlreadyMerged);else if((!t||t<2)&&(!r||r<2))o=obj.options.text.invalidMergeProperties;else for(var c=u[1];c<u[1]+r;c++)for(var d=u[0];d<u[0]+t;d++)jexcel.getColumnNameFromId([d,c]),obj.records[c][d].getAttribute("data-merged")&&(o=obj.options.text.thereIsAConflictWithAnotherMergedCell);if(o)alert(o);else{t>1?obj.records[u[1]][u[0]].setAttribute("colspan",t):t=1,r>1?obj.records[u[1]][u[0]].setAttribute("rowspan",r):r=1,obj.options.mergeCells[e]=[t,r,[]],obj.records[u[1]][u[0]].setAttribute("data-merged","true"),obj.records[u[1]][u[0]].style.overflow="hidden";for(var p=[],f=u[1];f<u[1]+r;f++)for(var g=u[0];g<u[0]+t;g++)u[0]==g&&u[1]==f||(p.push(obj.options.data[f][g]),obj.updateCell(g,f,"",!0),obj.options.mergeCells[e][2].push(obj.records[f][g]),obj.records[f][g].style.display="none",obj.records[f][g]=obj.records[u[1]][u[0]]);obj.updateSelection(obj.records[u[1]][u[0]]),n||(obj.setHistory({action:"setMerge",column:e,colspan:t,rowspan:r,data:p}),obj.dispatch("onmerge",el,e,t,r))}},obj.getMerge=function(e){var t={};if(e)t=obj.options.mergeCells[e]?[obj.options.mergeCells[e][0],obj.options.mergeCells[e][1]]:null;else if(obj.options.mergeCells){obj.options.mergeCells;for(var r=Object.keys(obj.options.mergeCells),n=0;n<r.length;n++)t[r[n]]=[obj.options.mergeCells[r[n]][0],obj.options.mergeCells[r[n]][1]]}return t},obj.removeMerge=function(e,t,r){if(obj.options.mergeCells[e]){var n=jexcel.getIdFromColumnName(e,!0);obj.records[n[1]][n[0]].removeAttribute("colspan"),obj.records[n[1]][n[0]].removeAttribute("rowspan"),obj.records[n[1]][n[0]].removeAttribute("data-merged");for(var o=obj.options.mergeCells[e],l=0,s=0;s<o[1];s++)for(var i=0;i<o[0];i++)(s>0||i>0)&&(obj.records[n[1]+s][n[0]+i]=o[2][l],obj.records[n[1]+s][n[0]+i].style.display="",t&&t[l]&&obj.updateCell(n[0]+i,n[1]+s,t[l]),l++);obj.updateSelection(obj.records[n[1]][n[0]],obj.records[n[1]+s-1][n[0]+i-1]),r||delete obj.options.mergeCells[e]}},obj.destroyMerged=function(e){if(obj.options.mergeCells){obj.options.mergeCells;for(var t=Object.keys(obj.options.mergeCells),r=0;r<t.length;r++)obj.removeMerge(t[r],null,e)}},obj.isColMerged=function(e,t){var r=[];if(obj.options.mergeCells)for(var n=Object.keys(obj.options.mergeCells),o=0;o<n.length;o++){var l=jexcel.getIdFromColumnName(n[o],!0),s=obj.options.mergeCells[n[o]][0],i=l[0],a=l[0]+(s>1?s-1:0);null==t?i<=e&&a>=e&&r.push(n[o]):t?i<e&&a>=e&&r.push(n[o]):i<=e&&a>e&&r.push(n[o])}return r},obj.isRowMerged=function(e,t){var r=[];if(obj.options.mergeCells)for(var n=Object.keys(obj.options.mergeCells),o=0;o<n.length;o++){var l=jexcel.getIdFromColumnName(n[o],!0),s=obj.options.mergeCells[n[o]][1],i=l[1],a=l[1]+(s>1?s-1:0);null==t?i<=e&&a>=e&&r.push(n[o]):t?i<e&&a>=e&&r.push(n[o]):i<=e&&a>e&&r.push(n[o])}return r},obj.openFilter=function(e){if(obj.options.filters){e=parseInt(e),obj.resetSelection();var t=[];if("checkbox"==obj.options.columns[e].type)t.push({id:"true",name:"True"}),t.push({id:"false",name:"False"});else{for(var r=[],n=!1,o=0;o<obj.options.data.length;o++){var l=obj.options.data[o][e],s=obj.records[o][e].innerHTML;if(l&&s)r[l]=s;else var n=!0}for(var i=Object.keys(r),t=[],o=0;o<i.length;o++)t.push({id:i[o],name:r[i[o]]});n&&t.push({value:"",id:"",name:"(Blanks)"})}var a=document.createElement("div");obj.filter.children[e+1].innerHTML="",obj.filter.children[e+1].appendChild(a),obj.filter.children[e+1].style.paddingLeft="0px",obj.filter.children[e+1].style.paddingRight="0px",obj.filter.children[e+1].style.overflow="initial";var u={data:t,multiple:!0,autocomplete:!0,opened:!0,value:void 0!==obj.filters[e]?obj.filters[e]:null,width:"100%",position:!0==obj.options.tableOverflow||!0==obj.options.fullscreen,onclose:function(t){obj.resetFilters(),obj.filters[e]=t.dropdown.getValue(!0),obj.filter.children[e+1].innerHTML=t.dropdown.getText(),obj.filter.children[e+1].style.paddingLeft="",obj.filter.children[e+1].style.paddingRight="",obj.filter.children[e+1].style.overflow="",obj.closeFilter(e),obj.refreshSelection()}};jSuites.dropdown(a,u)}else console.log("Jspreadsheet: filters not enabled.")},obj.resetFilters=function(){if(obj.options.filters)for(var e=0;e<obj.filter.children.length;e++)obj.filter.children[e].innerHTML="&nbsp;",obj.filters[e]=null;obj.results=null,obj.updateResult()},obj.closeFilter=function(e){if(!e)for(var t=0;t<obj.filter.children.length;t++)obj.filters[t]&&(e=t);var r=function(e,t,r){for(var n=0;n<e.length;n++){var o=""+obj.options.data[r][t],l=""+obj.records[r][t].innerHTML;if(e[n]==o||e[n]==l)return!0}return!1},n=obj.filters[e];obj.results=[];for(var o=0;o<obj.options.data.length;o++)r(n,e,o)&&obj.results.push(o);obj.results.length||(obj.results=null),obj.updateResult()},obj.openEditor=function(e,t,r){var n=e.getAttribute("data-y"),o=e.getAttribute("data-x");obj.dispatch("oneditionstart",el,e,o,n),o>0&&(obj.records[n][o-1].style.overflow="hidden");var l=function(t){var r=e.getBoundingClientRect(),l=document.createElement(t);return l.style.width=r.width+"px",l.style.height=r.height-2+"px",l.style.minHeight=r.height-2+"px",e.classList.add("editor"),e.innerHTML="",e.appendChild(l),obj.dispatch("oncreateeditor",el,e,o,n,l),l};if(!0==e.classList.contains("readonly"));else if(obj.edition=[obj.records[n][o],obj.records[n][o].innerHTML,o,n],obj.options.columns[o].editor)obj.options.columns[o].editor.openEditor(e,el,t,r);else if("hidden"==obj.options.columns[o].type);else if("checkbox"==obj.options.columns[o].type||"radio"==obj.options.columns[o].type){var s=!e.children[0].checked;obj.setValue(e,s),obj.edition=null}else if("dropdown"==obj.options.columns[o].type||"autocomplete"==obj.options.columns[o].type){var s=obj.options.data[n][o];if(obj.options.columns[o].multiple&&!Array.isArray(s)&&(s=s.split(";")),"function"==typeof obj.options.columns[o].filter)var i=obj.options.columns[o].filter(el,e,o,n,obj.options.columns[o].source);else var i=obj.options.columns[o].source;for(var a=[],u=0;u<i.length;u++)a.push(i[u]);var c=l("div"),d={data:a,multiple:!!obj.options.columns[o].multiple,autocomplete:!!obj.options.columns[o].autocomplete||"autocomplete"==obj.options.columns[o].type,opened:!0,value:s,width:"100%",height:c.style.minHeight,position:!0==obj.options.tableOverflow||!0==obj.options.fullscreen,onclose:function(){obj.closeEditor(e,!0)}};obj.options.columns[o].options&&obj.options.columns[o].options.type&&(d.type=obj.options.columns[o].options.type),jSuites.dropdown(c,d)}else if("calendar"==obj.options.columns[o].type||"color"==obj.options.columns[o].type){var s=obj.options.data[n][o],c=l("input");c.value=s,(!0==obj.options.tableOverflow||!0==obj.options.fullscreen)&&(obj.options.columns[o].options.position=!0),obj.options.columns[o].options.value=obj.options.data[n][o],obj.options.columns[o].options.opened=!0,obj.options.columns[o].options.onclose=function(t,r){obj.closeEditor(e,!0)},"color"==obj.options.columns[o].type?jSuites.color(c,obj.options.columns[o].options):jSuites.calendar(c,obj.options.columns[o].options),c.focus()}else if("html"==obj.options.columns[o].type){var s=obj.options.data[n][o],c=l("div");c.style.position="relative";var p=document.createElement("div");p.classList.add("jexcel_richtext"),c.appendChild(p),jSuites.editor(p,{focus:!0,value:s});var f=e.getBoundingClientRect(),g=p.getBoundingClientRect();window.innerHeight<f.bottom+g.height?p.style.top=f.top-(g.height+2)+"px":p.style.top=f.top+"px"}else if("image"==obj.options.columns[o].type){var h=e.children[0],c=l("div");c.style.position="relative";var p=document.createElement("div");p.classList.add("jclose"),h&&h.src&&p.appendChild(h),c.appendChild(p),jSuites.image(p,obj.options.imageOptions);var f=e.getBoundingClientRect(),g=p.getBoundingClientRect();window.innerHeight<f.bottom+g.height?p.style.top=f.top-(g.height+2)+"px":p.style.top=f.top+"px"}else{var s=!0==t?"":obj.options.data[n][o];if(!1!=obj.options.columns[o].wordWrap&&(!0==obj.options.wordWrap||!0==obj.options.columns[o].wordWrap))var c=l("textarea");else var c=l("input");c.focus(),c.value=s;var d=obj.options.columns[o],m=null;if(!isFormula(s)&&(m=getMask(d))){if(!d.disabledMaskOnEdition){if(d.mask){var _=d.mask.split(";");c.setAttribute("data-mask",_[0])}else d.locale&&c.setAttribute("data-locale",d.locale)}m.input=c,c.mask=m,jSuites.mask.render(s,m,!1)}c.onblur=function(){obj.closeEditor(e,!0)},c.scrollLeft=c.scrollWidth}},obj.closeEditor=function(e,t){var r=parseInt(e.getAttribute("data-x")),n=parseInt(e.getAttribute("data-y"));if(!0==t){if(obj.options.columns[r].editor)var o=obj.options.columns[r].editor.closeEditor(e,t);else if("checkbox"==obj.options.columns[r].type||"radio"==obj.options.columns[r].type||"hidden"==obj.options.columns[r].type);else if("dropdown"==obj.options.columns[r].type||"autocomplete"==obj.options.columns[r].type)var o=e.children[0].dropdown.close(!0);else if("calendar"==obj.options.columns[r].type)var o=e.children[0].calendar.close(!0);else if("color"==obj.options.columns[r].type)var o=e.children[0].color.close(!0);else if("html"==obj.options.columns[r].type)var o=e.children[0].children[0].editor.getData();else if("image"==obj.options.columns[r].type)var l=e.children[0].children[0].children[0],o=l&&"IMG"==l.tagName?l.src:"";else if("numeric"==obj.options.columns[r].type){var o=e.children[0].value;"="!=(""+o).substr(0,1)&&""==o&&(o=obj.options.columns[r].allowEmpty?"":0),e.children[0].onblur=null}else{var o=e.children[0].value;e.children[0].onblur=null;var s=obj.options.columns[r],i=null;if((i=getMask(s))&&""!==o&&!isFormula(o)&&"number"!=typeof o){var a=jSuites.mask.extract(o,i,!0);a&&""!==a.value&&(o=a.value)}}obj.options.data[n][r]==o?e.innerHTML=obj.edition[1]:obj.setValue(e,o)}else obj.options.columns[r].editor?obj.options.columns[r].editor.closeEditor(e,t):"dropdown"==obj.options.columns[r].type||"autocomplete"==obj.options.columns[r].type?e.children[0].dropdown.close(!0):"calendar"==obj.options.columns[r].type?e.children[0].calendar.close(!0):"color"==obj.options.columns[r].type?e.children[0].color.close(!0):e.children[0].onblur=null,e.innerHTML=obj.edition&&obj.edition[1]?obj.edition[1]:"";obj.dispatch("oneditionend",el,e,r,n,o,t),e.classList.remove("editor"),obj.edition=null},obj.getCell=function(e){var t=(e=jexcel.getIdFromColumnName(e,!0))[0],r=e[1];return obj.records[r][t]},obj.getColumnOptions=function(e,t){var r=obj.options.columns[e];return r||(r={type:"text"}),r},obj.getCellFromCoords=function(e,t){return obj.records[t][e]},obj.getLabel=function(e){var t=(e=jexcel.getIdFromColumnName(e,!0))[0],r=e[1];return obj.records[r][t].innerHTML},obj.getLabelFromCoords=function(e,t){return obj.records[t][e].innerHTML},obj.getValue=function(e,t){if("object"==typeof e)var r=e.getAttribute("data-x"),n=e.getAttribute("data-y");else var r=(e=jexcel.getIdFromColumnName(e,!0))[0],n=e[1];var o=null;return null!=r&&null!=n&&(obj.records[n]&&obj.records[n][r]&&(t||!0==obj.options.copyCompatibility)?o=obj.records[n][r].innerHTML:obj.options.data[n]&&"undefined"!=obj.options.data[n][r]&&(o=obj.options.data[n][r])),o},obj.getValueFromCoords=function(e,t,r){var n=null;return null!=e&&null!=t&&(obj.records[t]&&obj.records[t][e]&&r||!0==obj.options.copyCompatibility?n=obj.records[t][e].innerHTML:obj.options.data[t]&&"undefined"!=obj.options.data[t][e]&&(n=obj.options.data[t][e])),n},obj.setValue=function(e,t,r){var n=[];if("string"==typeof e){var o=jexcel.getIdFromColumnName(e,!0),l=o[0],s=o[1];n.push(obj.updateCell(l,s,t,r)),obj.updateFormulaChain(l,s,n)}else{var l=null,s=null;if(e&&e.getAttribute)var l=e.getAttribute("data-x"),s=e.getAttribute("data-y");if(null!=l&&null!=s)n.push(obj.updateCell(l,s,t,r)),obj.updateFormulaChain(l,s,n);else{var i=Object.keys(e);if(i.length>0)for(var a=0;a<i.length;a++){if("string"==typeof e[a])var o=jexcel.getIdFromColumnName(e[a],!0),l=o[0],s=o[1];else if(null!=e[a].x&&null!=e[a].y){var l=e[a].x,s=e[a].y;null!=e[a].newValue?t=e[a].newValue:null!=e[a].value&&(t=e[a].value)}else var l=e[a].getAttribute("data-x"),s=e[a].getAttribute("data-y");null!=l&&null!=s&&(n.push(obj.updateCell(l,s,t,r)),obj.updateFormulaChain(l,s,n))}}}obj.setHistory({action:"setValue",records:n,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,n)},obj.setValueFromCoords=function(e,t,r,n){var o=[];o.push(obj.updateCell(e,t,r,n)),obj.updateFormulaChain(e,t,o),obj.setHistory({action:"setValue",records:o,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,o)},obj.setCheckRadioValue=function(){for(var e=[],t=Object.keys(obj.highlighted),r=0;r<t.length;r++){var n=obj.highlighted[r].getAttribute("data-x"),o=obj.highlighted[r].getAttribute("data-y");("checkbox"==obj.options.columns[n].type||"radio"==obj.options.columns[n].type)&&e.push(obj.updateCell(n,o,!obj.options.data[o][n]))}e.length&&(obj.setHistory({action:"setValue",records:e,selection:obj.selectedCell}),obj.onafterchanges(el,e))};var stripScript=function(e){var t=new Option;t.innerHTML=e;var r=null;for(e=t.getElementsByTagName("script");r=e[0];)r.parentNode.removeChild(r);return t.innerHTML};obj.updateCell=function(e,t,r,n){if(!0!=obj.records[t][e].classList.contains("readonly")||n){if("="==(""+r).substr(0,1)&&!0==obj.options.secureFormulas){var o=secureFormula(r);o!=r&&(r=o)}var o=obj.dispatch("onbeforechange",el,obj.records[t][e],e,t,r);void 0!=o&&(r=o),obj.options.columns[e].editor&&"function"==typeof obj.options.columns[e].editor.updateCell&&(r=obj.options.columns[e].editor.updateCell(obj.records[t][e],r,n));var l={x:e,y:t,col:e,row:t,newValue:r,oldValue:obj.options.data[t][e]};if(obj.options.columns[e].editor)obj.options.data[t][e]=r;else if("checkbox"==obj.options.columns[e].type||"radio"==obj.options.columns[e].type){if("radio"==obj.options.columns[e].type)for(var s=0;s<obj.options.data.length;s++)obj.options.data[s][e]=!1;obj.records[t][e].children[0].checked=1==r||!0==r||"true"==r||"TRUE"==r,obj.options.data[t][e]=obj.records[t][e].children[0].checked}else if("dropdown"==obj.options.columns[e].type||"autocomplete"==obj.options.columns[e].type)obj.options.data[t][e]=r,obj.records[t][e].innerText=obj.getDropDownValue(e,r);else if("calendar"==obj.options.columns[e].type){var i=null;if(!validDate(r)){var a=jSuites.calendar.extractDateFromString(r,obj.options.columns[e].options.format);a&&(i=a)}obj.options.data[t][e]=r,obj.records[t][e].innerText=jSuites.calendar.getDateString(i||r,obj.options.columns[e].options.format)}else if("color"==obj.options.columns[e].type){if(obj.options.data[t][e]=r,"square"==obj.options.columns[e].render){var u=document.createElement("div");u.className="color",u.style.backgroundColor=r,obj.records[t][e].innerText="",obj.records[t][e].appendChild(u)}else obj.records[t][e].style.color=r,obj.records[t][e].innerText=r}else if("image"==obj.options.columns[e].type){if(r=""+r,obj.options.data[t][e]=r,obj.records[t][e].innerHTML="",r&&"data:image"==r.substr(0,10)){var c=document.createElement("img");c.src=r,obj.records[t][e].appendChild(c)}}else obj.options.data[t][e]=r,"html"==obj.options.columns[e].type?obj.records[t][e].innerHTML=stripScript(obj.parseValue(e,t,r)):!1===obj.options.stripHTML||!1===obj.options.columns[e].stripHTML?obj.records[t][e].innerHTML=stripScript(obj.parseValue(e,t,r,obj.records[t][e])):obj.records[t][e].innerText=obj.parseValue(e,t,r,obj.records[t][e]),!1!=obj.options.columns[e].wordWrap&&(!0==obj.options.wordWrap||!0==obj.options.columns[e].wordWrap||obj.records[t][e].innerHTML.length>200)?obj.records[t][e].style.whiteSpace="pre-wrap":obj.records[t][e].style.whiteSpace="";e>0&&(r?obj.records[t][e-1].style.overflow="hidden":obj.records[t][e-1].style.overflow=""),obj.dispatch("onchange",el,obj.records[t]&&obj.records[t][e]?obj.records[t][e]:null,e,t,r,l.oldValue)}else var l={x:e,y:t,col:e,row:t};return l},obj.copyData=function(e,t){var r=obj.getData(!0,!0),n=obj.selectedContainer,o=parseInt(e.getAttribute("data-x")),l=parseInt(e.getAttribute("data-y")),s=parseInt(t.getAttribute("data-x")),i=parseInt(t.getAttribute("data-y")),a=[],u=!1;if(n[0]==o){if(l<n[1])var c=l-n[1];else var c=1;var d=0}else{if(o<n[0])var d=o-n[0];else var d=1;var c=0}for(var p=0,f=0,g=l;g<=i;g++)if(!obj.rows[g]||"none"!=obj.rows[g].style.display){if(void 0==r[f]&&(f=0),p=0,n[0]!=o){if(o<n[0])var d=o-n[0];else var d=1}for(var h=o;h<=s;h++){if(obj.records[g][h]&&!obj.records[g][h].classList.contains("readonly")&&"none"!=obj.records[g][h].style.display&&!1==u){if(!obj.selection.length&&""!=obj.options.data[g][h]){u=!0;continue}void 0==r[f]?p=0:void 0==r[f][p]&&(p=0);var m=r[f][p];if(m&&!r[1]&&!0==obj.options.autoIncrement){if("text"==obj.options.columns[h].type||"number"==obj.options.columns[h].type){if("="==(""+m).substr(0,1)){var _=m.match(/([A-Z]+[0-9]+)/g);if(_){for(var v=[],C=0;C<_.length;C++){var y=jexcel.getIdFromColumnName(_[C],1);y[0]+=d,y[1]+=c,y[1]<0&&(y[1]=0);var b=jexcel.getColumnNameFromId([y[0],y[1]]);b!=_[C]&&(v[_[C]]=b)}v&&(m=obj.updateFormula(m,v))}}else m==Number(m)&&(m=Number(m)+c)}else if("calendar"==obj.options.columns[h].type){var A=new Date(m);A.setDate(A.getDate()+c),m=A.getFullYear()+"-"+jexcel.doubleDigitFormat(parseInt(A.getMonth()+1))+"-"+jexcel.doubleDigitFormat(A.getDate())+" 00:00:00"}}a.push(obj.updateCell(h,g,m)),obj.updateFormulaChain(h,g,a)}p++,n[0]!=o&&d++}f++,c++}obj.setHistory({action:"setValue",records:a,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,a)},obj.refreshSelection=function(){obj.selectedCell&&obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.conditionalSelectionUpdate=function(e,t,r){if(1==e){if(obj.selectedCell&&(t>=obj.selectedCell[1]&&t<=obj.selectedCell[3]||r>=obj.selectedCell[1]&&r<=obj.selectedCell[3])){obj.resetSelection();return}}else if(obj.selectedCell&&(t>=obj.selectedCell[0]&&t<=obj.selectedCell[2]||r>=obj.selectedCell[0]&&r<=obj.selectedCell[2])){obj.resetSelection();return}},obj.resetSelection=function(e){if(obj.highlighted.length)for(var t=1,r=0;r<obj.highlighted.length;r++){obj.highlighted[r].classList.remove("highlight"),obj.highlighted[r].classList.remove("highlight-left"),obj.highlighted[r].classList.remove("highlight-right"),obj.highlighted[r].classList.remove("highlight-top"),obj.highlighted[r].classList.remove("highlight-bottom"),obj.highlighted[r].classList.remove("highlight-selected");var n=parseInt(obj.highlighted[r].getAttribute("data-x")),o=parseInt(obj.highlighted[r].getAttribute("data-y"));if(obj.highlighted[r].getAttribute("data-merged"))var l=parseInt(obj.highlighted[r].getAttribute("colspan")),s=parseInt(obj.highlighted[r].getAttribute("rowspan")),i=l>0?n+(l-1):n,a=s>0?o+(s-1):o;else var i=n,a=o;for(var u=n;u<=i;u++)obj.headers[u]&&obj.headers[u].classList.remove("selected");for(var u=o;u<=a;u++)obj.rows[u]&&obj.rows[u].classList.remove("selected")}else var t=0;return obj.highlighted=[],obj.selectedCell=null,obj.corner.style.top="-2000px",obj.corner.style.left="-2000px",!0==e&&1==t&&obj.dispatch("onblur",el),t},obj.updateSelection=function(e,t,r){var n=e.getAttribute("data-x"),o=e.getAttribute("data-y");if(t)var l=t.getAttribute("data-x"),s=t.getAttribute("data-y");else var l=n,s=o;obj.updateSelectionFromCoords(n,o,l,s,r)},obj.updateSelectionFromCoords=function(e,t,r,n,o){var l=obj.resetSelection();if(null==t&&(t=0,n=obj.rows.length-1),null==r&&(r=e),null==n&&(n=t),e>=obj.headers.length&&(e=obj.headers.length-1),t>=obj.rows.length&&(t=obj.rows.length-1),r>=obj.headers.length&&(r=obj.headers.length-1),n>=obj.rows.length&&(n=obj.rows.length-1),obj.selectedCell=[e,t,r,n],null!=e){if(obj.records[t][e]&&obj.records[t][e].classList.add("highlight-selected"),parseInt(e)<parseInt(r))var s=parseInt(e),i=parseInt(r);else var s=parseInt(r),i=parseInt(e);if(parseInt(t)<parseInt(n))var a=parseInt(t),u=parseInt(n);else var a=parseInt(n),u=parseInt(t);for(var c=s;c<=i;c++)for(var d=a;d<=u;d++)if(obj.records[d][c]&&obj.records[d][c].getAttribute("data-merged")){var p=parseInt(obj.records[d][c].getAttribute("data-x")),f=parseInt(obj.records[d][c].getAttribute("data-y")),g=parseInt(obj.records[d][c].getAttribute("colspan")),h=parseInt(obj.records[d][c].getAttribute("rowspan"));g>1&&(p<s&&(s=p),p+g>i&&(i=p+g-1)),h&&(f<a&&(a=f),f+h>u&&(u=f+h-1))}for(var m=null,_=null,v=null,C=null,d=a;d<=u;d++)"none"!=obj.rows[d].style.display&&(null==v&&(v=d),C=d);for(var c=s;c<=i;c++){for(var d=a;d<=u;d++)"none"!=obj.rows[d].style.display&&"none"!=obj.records[d][c].style.display&&(obj.records[d][c].classList.add("highlight"),obj.highlighted.push(obj.records[d][c]));"hidden"!=obj.options.columns[c].type&&(null==m&&(m=c),_=c)}m||(m=0),_||(_=0);for(var c=m;c<=_;c++)"hidden"!=obj.options.columns[c].type&&(obj.records[v]&&obj.records[v][c]&&obj.records[v][c].classList.add("highlight-top"),obj.records[C]&&obj.records[C][c]&&obj.records[C][c].classList.add("highlight-bottom"),obj.headers[c].classList.add("selected"));for(var d=v;d<=C;d++)obj.rows[d]&&"none"!=obj.rows[d].style.display&&(obj.records[d][m].classList.add("highlight-left"),obj.records[d][_].classList.add("highlight-right"),obj.rows[d].classList.add("selected"));obj.selectedContainer=[m,v,_,C]}0==l&&(obj.dispatch("onfocus",el),obj.removeCopyingSelection()),obj.dispatch("onselection",el,m,v,_,C,o),obj.updateCornerPosition()},obj.removeCopySelection=function(){for(var e=0;e<obj.selection.length;e++)obj.selection[e].classList.remove("selection"),obj.selection[e].classList.remove("selection-left"),obj.selection[e].classList.remove("selection-right"),obj.selection[e].classList.remove("selection-top"),obj.selection[e].classList.remove("selection-bottom");obj.selection=[]},obj.updateCopySelection=function(e,t){obj.removeCopySelection();var r=obj.selectedContainer[0],n=obj.selectedContainer[1],o=obj.selectedContainer[2],l=obj.selectedContainer[3];if(null!=e&&null!=t){if(e-o>0)var s=parseInt(o)+1,i=parseInt(e);else var s=parseInt(e),i=parseInt(r)-1;if(t-l>0)var a=parseInt(l)+1,u=parseInt(t);else var a=parseInt(t),u=parseInt(n)-1;if(i-s<=u-a)var s=parseInt(r),i=parseInt(o);else var a=parseInt(n),u=parseInt(l);for(var c=a;c<=u;c++)for(var d=s;d<=i;d++)obj.records[c][d]&&"none"!=obj.rows[c].style.display&&"none"!=obj.records[c][d].style.display&&(obj.records[c][d].classList.add("selection"),obj.records[a][d].classList.add("selection-top"),obj.records[u][d].classList.add("selection-bottom"),obj.records[c][s].classList.add("selection-left"),obj.records[c][i].classList.add("selection-right"),obj.selection.push(obj.records[c][d]))}},obj.updateCornerPosition=function(){if(obj.highlighted.length){var e=obj.highlighted[obj.highlighted.length-1],t=e.getAttribute("data-x"),r=obj.content.getBoundingClientRect(),n=r.left,o=r.top,l=e.getBoundingClientRect(),s=l.left,i=l.top,a=l.width,u=l.height,c=s-n+obj.content.scrollLeft+a-4,d=i-o+obj.content.scrollTop+u-4;if(obj.corner.style.top=d+"px",obj.corner.style.left=c+"px",obj.options.freezeColumns){var p=obj.getFreezeWidth();t>obj.options.freezeColumns-1&&s-n+a<p?obj.corner.style.display="none":!0==obj.options.selectionCopy&&(obj.corner.style.display="")}else!0==obj.options.selectionCopy&&(obj.corner.style.display="")}else obj.corner.style.top="-2000px",obj.corner.style.left="-2000px"},obj.updateScroll=function(e){var t=obj.content.getBoundingClientRect(),r=t.left,n=t.top,o=t.width,l=t.height,s=obj.records[obj.selectedCell[3]][obj.selectedCell[2]].getBoundingClientRect(),i=s.left,a=s.top,u=s.width,c=s.height;if(0==e||1==e)var d=i-r+obj.content.scrollLeft,p=a-n+obj.content.scrollTop-2;else var d=i-r+obj.content.scrollLeft+u,p=a-n+obj.content.scrollTop+c;p>obj.content.scrollTop+30&&p<obj.content.scrollTop+l||(p<obj.content.scrollTop+30?obj.content.scrollTop=p-c:obj.content.scrollTop=p-(l-2));var f=obj.getFreezeWidth();d>obj.content.scrollLeft+f&&d<obj.content.scrollLeft+o||(d<obj.content.scrollLeft+30?(obj.content.scrollLeft=d,obj.content.scrollLeft<50&&(obj.content.scrollLeft=0)):d<obj.content.scrollLeft+f?obj.content.scrollLeft=d-f-1:obj.content.scrollLeft=d-(o-20))},obj.getWidth=function(e){if(e)"object"==typeof e&&(e=$(e).getAttribute("data-x")),t=obj.colgroup[e].getAttribute("width");else for(var t=[],r=0;r<obj.headers.length;r++)t.push(obj.options.columns[r].width);return t},obj.setWidth=function(e,t,r){if(t){if(Array.isArray(e)){if(!r)var r=[];for(var n=0;n<e.length;n++){r[n]||(r[n]=obj.colgroup[e[n]].getAttribute("width"));var o=Array.isArray(t)&&t[n]?t[n]:t;obj.colgroup[e[n]].setAttribute("width",o),obj.options.columns[e[n]].width=o}}else r||(r=obj.colgroup[e].getAttribute("width")),obj.colgroup[e].setAttribute("width",t),obj.options.columns[e].width=t;obj.setHistory({action:"setWidth",column:e,oldValue:r,newValue:t}),obj.dispatch("onresizecolumn",el,e,t,r),obj.updateCornerPosition()}},obj.setHeight=function(e,t,r){t>0&&("object"==typeof e&&(e=e.getAttribute("data-y")),!r&&!(r=obj.rows[e].getAttribute("height"))&&(r=obj.rows[e].getBoundingClientRect().height),t=parseInt(t),obj.rows[e].style.height=t+"px",obj.options.rows[e]||(obj.options.rows[e]={}),obj.options.rows[e].height=t,obj.setHistory({action:"setHeight",row:e,oldValue:r,newValue:t}),obj.dispatch("onresizerow",el,e,t,r),obj.updateCornerPosition())},obj.getHeight=function(e){if(e){"object"==typeof e&&(e=$(e).getAttribute("data-y"));var t=obj.rows[e].style.height}else for(var t=[],r=0;r<obj.rows.length;r++){var n=obj.rows[r].style.height;n&&(t[r]=n)}return t},obj.setFooter=function(e){if(e&&(obj.options.footers=e),obj.options.footers){obj.tfoot||(obj.tfoot=document.createElement("tfoot"),obj.table.appendChild(obj.tfoot));for(var t=0;t<obj.options.footers.length;t++){if(obj.tfoot.children[t])var r=obj.tfoot.children[t];else{var r=document.createElement("tr"),n=document.createElement("td");r.appendChild(n),obj.tfoot.appendChild(r)}for(var o=0;o<obj.headers.length;o++){if(obj.options.footers[t][o]||(obj.options.footers[t][o]=""),obj.tfoot.children[t].children[o+1])var n=obj.tfoot.children[t].children[o+1];else{var n=document.createElement("td");r.appendChild(n);var l=obj.options.columns[o].align?obj.options.columns[o].align:"center";n.style.textAlign=l}n.innerText=obj.parseValue(+obj.records.length+o,t,obj.options.footers[t][o])}}}},obj.getHeader=function(e){return obj.headers[e].innerText},obj.setHeader=function(e,t){if(obj.headers[e]){var r=obj.headers[e].innerText;t||(t=prompt(obj.options.text.columnName,r)),t&&(obj.headers[e].innerText=t,obj.headers[e].setAttribute("title",t),obj.options.columns[e].title=t),obj.setHistory({action:"setHeader",column:e,oldValue:r,newValue:t}),obj.dispatch("onchangeheader",el,e,r,t)}},obj.getHeaders=function(e){for(var t=[],r=0;r<obj.headers.length;r++)t.push(obj.getHeader(r));return e?t:t.join(obj.options.csvDelimiter)},obj.getMeta=function(e,t){return e?t?obj.options.meta[e]&&obj.options.meta[e][t]?obj.options.meta[e][t]:null:obj.options.meta[e]?obj.options.meta[e]:null:obj.options.meta},obj.setMeta=function(e,t,r){if(obj.options.meta||(obj.options.meta={}),t&&r)obj.options.meta[e]||(obj.options.meta[e]={}),obj.options.meta[e][t]=r;else for(var n=Object.keys(e),o=0;o<n.length;o++){obj.options.meta[n[o]]||(obj.options.meta[n[o]]={});for(var l=Object.keys(e[n[o]]),s=0;s<l.length;s++)obj.options.meta[n[o]][l[s]]=e[n[o]][l[s]]}obj.dispatch("onchangemeta",el,e,t,r)},obj.updateMeta=function(e){if(obj.options.meta){for(var t={},r=Object.keys(obj.options.meta),n=0;n<r.length;n++)e[r[n]]?t[e[r[n]]]=obj.options.meta[r[n]]:t[r[n]]=obj.options.meta[r[n]];obj.options.meta=t}},obj.getStyle=function(e,t){if(e)return e=jexcel.getIdFromColumnName(e,!0),t?obj.records[e[1]][e[0]].style[t]:obj.records[e[1]][e[0]].getAttribute("style");for(var r={},n=obj.options.data[0].length,o=obj.options.data.length,l=0;l<o;l++)for(var s=0;s<n;s++){var i=t?obj.records[l][s].style[t]:obj.records[l][s].getAttribute("style");i&&(r[jexcel.getColumnNameFromId([s,l])]=i)}return r},obj.resetStyle=function(e,t){for(var r=Object.keys(e),n=0;n<r.length;n++){var o=jexcel.getIdFromColumnName(r[n],!0);obj.records[o[1]]&&obj.records[o[1]][o[0]]&&obj.records[o[1]][o[0]].setAttribute("style","")}obj.setStyle(e,null,null,null,t)},obj.setStyle=function(e,t,r,n,o){var l={},s={},i=function(e,t,r){var o=jexcel.getIdFromColumnName(e,!0);if(obj.records[o[1]]&&obj.records[o[1]][o[0]]&&(!1==obj.records[o[1]][o[0]].classList.contains("readonly")||n)){var i=obj.records[o[1]][o[0]].style[t];i!=r||n?obj.records[o[1]][o[0]].style[t]=r:(r="",obj.records[o[1]][o[0]].style[t]=""),s[e]||(s[e]=[]),l[e]||(l[e]=[]),s[e].push([t+":"+i]),l[e].push([t+":"+r])}};if(t&&r){if("string"==typeof e)i(e,t,r);else for(var a=[],u=0;u<e.length;u++){var c=e[u].getAttribute("data-x"),d=e[u].getAttribute("data-y"),p=jexcel.getColumnNameFromId([c,d]);a[p]||(i(p,t,r),a[p]=!0)}}else for(var f=Object.keys(e),u=0;u<f.length;u++){var g=e[f[u]];"string"==typeof g&&(g=g.split(";"));for(var h=0;h<g.length;h++)"string"==typeof g[h]&&(g[h]=g[h].split(":")),g[h][0].trim()&&i(f[u],g[h][0].trim(),g[h][1])}for(var f=Object.keys(s),u=0;u<f.length;u++)s[f[u]]=s[f[u]].join(";");for(var f=Object.keys(l),u=0;u<f.length;u++)l[f[u]]=l[f[u]].join(";");o||obj.setHistory({action:"setStyle",oldValue:s,newValue:l}),obj.dispatch("onchangestyle",el,e,t,r)},obj.getComments=function(e,t){if(e){if("string"==typeof e)var e=jexcel.getIdFromColumnName(e,!0);return t?[obj.records[e[1]][e[0]].getAttribute("title"),obj.records[e[1]][e[0]].getAttribute("author")]:obj.records[e[1]][e[0]].getAttribute("title")||""}for(var r={},n=0;n<obj.options.data.length;n++)for(var o=0;o<obj.options.columns.length;o++){var l=obj.records[n][o].getAttribute("title");if(l){var e=jexcel.getColumnNameFromId([o,n]);r[e]=l}}return r},obj.setComments=function(e,t,r){if("string"==typeof e)var n=jexcel.getIdFromColumnName(e,!0);else var n=e;var o=obj.records[n[1]][n[0]].getAttribute("title"),r=obj.records[n[1]][n[0]].getAttribute("data-author"),l=[o,r];obj.records[n[1]][n[0]].setAttribute("title",t||""),obj.records[n[1]][n[0]].setAttribute("data-author",r||""),t?obj.records[n[1]][n[0]].classList.add("jexcel_comments"):obj.records[n[1]][n[0]].classList.remove("jexcel_comments"),obj.setHistory({action:"setComments",column:e,newValue:[t,r],oldValue:l}),obj.dispatch("oncomments",el,t,o,n,n[0],n[1])},obj.getConfig=function(){var e=obj.options;return e.style=obj.getStyle(),e.mergeCells=obj.getMerge(),e.comments=obj.getComments(),e},obj.orderBy=function(e,t){if(e>=0){if(Object.keys(obj.options.mergeCells).length>0){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}t=null==t?obj.headers[e].classList.contains("arrow-down")?1:0:t?1:0;var r=[];if("number"==obj.options.columns[e].type||"percentage"==obj.options.columns[e].type||"autonumber"==obj.options.columns[e].type||"color"==obj.options.columns[e].type)for(var n=0;n<obj.options.data.length;n++)r[n]=[n,Number(obj.options.data[n][e])];else if("calendar"==obj.options.columns[e].type||"checkbox"==obj.options.columns[e].type||"radio"==obj.options.columns[e].type)for(var n=0;n<obj.options.data.length;n++)r[n]=[n,obj.options.data[n][e]];else for(var n=0;n<obj.options.data.length;n++)r[n]=[n,obj.records[n][e].innerText.toLowerCase()];"function"!=typeof obj.options.sorting&&(obj.options.sorting=function(e){return function(t,r){var n=t[1],o=r[1];return e?""===n&&""!==o?1:""!==n&&""===o?-1:n>o?-1:n<o?1:0:""===n&&""!==o?1:""!==n&&""===o?-1:n>o?1:n<o?-1:0}}),r=r.sort(obj.options.sorting(t));for(var o=[],n=0;n<r.length;n++)o[n]=r[n][0];return obj.setHistory({action:"orderBy",rows:o,column:e,order:t}),obj.updateOrderArrow(e,t),obj.updateOrder(o),obj.dispatch("onsort",el,e,t),!0}},obj.updateOrderArrow=function(e,t){for(var r=0;r<obj.headers.length;r++)obj.headers[r].classList.remove("arrow-up"),obj.headers[r].classList.remove("arrow-down");t?obj.headers[e].classList.add("arrow-up"):obj.headers[e].classList.add("arrow-down")},obj.updateOrder=function(e){for(var t=[],r=0;r<e.length;r++)t[r]=obj.options.data[e[r]];obj.options.data=t;for(var t=[],r=0;r<e.length;r++)t[r]=obj.records[e[r]];obj.records=t;for(var t=[],r=0;r<e.length;r++)t[r]=obj.rows[e[r]];if(obj.rows=t,obj.updateTableReferences(),obj.results&&obj.results.length)obj.searchInput.value?obj.search(obj.searchInput.value):obj.closeFilter();else if(obj.results=null,obj.pageNumber=0,obj.options.pagination>0)obj.page(0);else if(!0==obj.options.lazyLoading)obj.loadPage(0);else for(var r=0;r<obj.rows.length;r++)obj.tbody.appendChild(obj.rows[r])},obj.moveRow=function(e,t,r){if(Object.keys(obj.options.mergeCells).length>0){if(e>t)var n=1;else var n=0;if(obj.isRowMerged(e).length||obj.isRowMerged(t,n).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}}if(!0==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}r||(Array.prototype.indexOf.call(obj.tbody.children,obj.rows[t])>=0?e>t?obj.tbody.insertBefore(obj.rows[e],obj.rows[t]):obj.tbody.insertBefore(obj.rows[e],obj.rows[t].nextSibling):obj.tbody.removeChild(obj.rows[e])),obj.rows.splice(t,0,obj.rows.splice(e,1)[0]),obj.records.splice(t,0,obj.records.splice(e,1)[0]),obj.options.data.splice(t,0,obj.options.data.splice(e,1)[0]),obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.setHistory({action:"moveRow",oldValue:e,newValue:t}),obj.updateTableReferences(),obj.dispatch("onmoverow",el,e,t)},obj.insertRow=function(e,t,r){if(!0==obj.options.allowInsertRow){var n=[];if(e>0)var o=e;else{var o=1;e&&(n=e)}var r=!!r,l=obj.options.data.length-1;if((void 0==t||t>=parseInt(l)||t<0)&&(t=l),!1===obj.dispatch("onbeforeinsertrow",el,t,o,r))return!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isRowMerged(t,r).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if(!0==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}for(var s=r?t:t+1,i=obj.records.splice(s),a=obj.options.data.splice(s),u=obj.rows.splice(s),c=[],d=[],p=[],f=s;f<o+s;f++){obj.options.data[f]=[];for(var g=0;g<obj.options.columns.length;g++)obj.options.data[f][g]=n[g]?n[g]:"";var h=obj.createRow(f,obj.options.data[f]);u[0]?Array.prototype.indexOf.call(obj.tbody.children,u[0])>=0&&obj.tbody.insertBefore(h,u[0]):Array.prototype.indexOf.call(obj.tbody.children,obj.rows[t])>=0&&obj.tbody.appendChild(h),c.push(obj.records[f]),d.push(obj.options.data[f]),p.push(h)}Array.prototype.push.apply(obj.records,i),Array.prototype.push.apply(obj.options.data,a),Array.prototype.push.apply(obj.rows,u),obj.options.pagination>0&&obj.page(obj.pageNumber),obj.setHistory({action:"insertRow",rowNumber:t,numOfRows:o,insertBefore:r,rowRecords:c,rowData:d,rowNode:p}),obj.updateTableReferences(),obj.dispatch("oninsertrow",el,t,o,c,r)}},obj.deleteRow=function(e,t){if(!0==obj.options.allowDeleteRow){if(!0==obj.options.allowDeletingAllRows||obj.options.data.length>1){if(void 0==e){var r=obj.getSelectedRows();r[0]?(e=parseInt(r[0].getAttribute("data-y")),t=r.length):(e=obj.options.data.length-1,t=1)}var n=obj.options.data.length-1;if((void 0==e||e>n||e<0)&&(e=n),t||(t=1),e+t>=obj.options.data.length&&(t=obj.options.data.length-e),!1===obj.dispatch("onbeforedeleterow",el,e,t))return!1;if(parseInt(e)>-1){var o=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var l=e;l<e+t;l++)obj.isRowMerged(l,!1).length&&(o=!0);if(o){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if(!0==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}!1==obj.options.allowDeletingAllRows&&n+1===t&&(t--,console.error("Jspreadsheet: It is not possible to delete the last row"));for(var l=e;l<e+t;l++)Array.prototype.indexOf.call(obj.tbody.children,obj.rows[l])>=0&&(obj.rows[l].className="",obj.rows[l].parentNode.removeChild(obj.rows[l]));var s=obj.records.splice(e,t),i=obj.options.data.splice(e,t),a=obj.rows.splice(e,t);obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.conditionalSelectionUpdate(1,e,e+t-1),obj.setHistory({action:"deleteRow",rowNumber:e,numOfRows:t,insertBefore:1,rowRecords:s,rowData:i,rowNode:a}),obj.updateTableReferences(),obj.dispatch("ondeleterow",el,e,t,s)}}else console.error("Jspreadsheet: It is not possible to delete the last row")}},obj.moveColumn=function(e,t){if(Object.keys(obj.options.mergeCells).length>0){if(e>t)var r=1;else var r=0;if(obj.isColMerged(e).length||obj.isColMerged(t,r).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}}var e=parseInt(e),t=parseInt(t);if(e>t){obj.headerContainer.insertBefore(obj.headers[e],obj.headers[t]),obj.colgroupContainer.insertBefore(obj.colgroup[e],obj.colgroup[t]);for(var n=0;n<obj.rows.length;n++)obj.rows[n].insertBefore(obj.records[n][e],obj.records[n][t])}else{obj.headerContainer.insertBefore(obj.headers[e],obj.headers[t].nextSibling),obj.colgroupContainer.insertBefore(obj.colgroup[e],obj.colgroup[t].nextSibling);for(var n=0;n<obj.rows.length;n++)obj.rows[n].insertBefore(obj.records[n][e],obj.records[n][t].nextSibling)}obj.options.columns.splice(t,0,obj.options.columns.splice(e,1)[0]),obj.headers.splice(t,0,obj.headers.splice(e,1)[0]),obj.colgroup.splice(t,0,obj.colgroup.splice(e,1)[0]);for(var n=0;n<obj.rows.length;n++)obj.options.data[n].splice(t,0,obj.options.data[n].splice(e,1)[0]),obj.records[n].splice(t,0,obj.records[n].splice(e,1)[0]);if(obj.options.footers)for(var n=0;n<obj.options.footers.length;n++)obj.options.footers[n].splice(t,0,obj.options.footers[n].splice(e,1)[0]);obj.setHistory({action:"moveColumn",oldValue:e,newValue:t}),obj.updateTableReferences(),obj.dispatch("onmovecolumn",el,e,t)},obj.insertColumn=function(e,t,r,n){if(!0==obj.options.allowInsertColumn){var o=[];if(e>0)var l=e;else{var l=1;e&&(o=e)}var r=!!r,s=obj.options.columns.length-1;if((void 0==t||t>=parseInt(s)||t<0)&&(t=s),!1===obj.dispatch("onbeforeinsertcolumn",el,t,l,r))return!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isColMerged(t,r).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}n||(n=[]);for(var i=0;i<l;i++)n[i]||(n[i]={type:"text",source:[],options:[],width:obj.options.defaultColWidth,align:obj.options.defaultColAlign});var a=r?t:t+1;obj.options.columns=jexcel.injectArray(obj.options.columns,a,n);for(var u=obj.headers.splice(a),c=obj.colgroup.splice(a),d=[],p=[],f=[],g=[],h=[],m=a;m<l+a;m++)obj.createCellHeader(m),obj.headerContainer.insertBefore(obj.headers[m],obj.headerContainer.children[m+1]),obj.colgroupContainer.insertBefore(obj.colgroup[m],obj.colgroupContainer.children[m+1]),d.push(obj.headers[m]),p.push(obj.colgroup[m]);if(obj.options.footers)for(var _=0;_<obj.options.footers.length;_++){h[_]=[];for(var i=0;i<l;i++)h[_].push("");obj.options.footers[_].splice(a,0,h[_])}for(var v=0;v<obj.options.data.length;v++){var C=obj.options.data[v].splice(a),y=obj.records[v].splice(a);g[v]=[],f[v]=[];for(var m=a;m<l+a;m++){var b=o[v]?o[v]:"";obj.options.data[v][m]=b;var A=obj.createCell(m,v,obj.options.data[v][m]);obj.records[v][m]=A,obj.rows[v]&&obj.rows[v].insertBefore(A,obj.rows[v].children[m+1]),g[v].push(b),f[v].push(A)}Array.prototype.push.apply(obj.options.data[v],C),Array.prototype.push.apply(obj.records[v],y)}if(Array.prototype.push.apply(obj.headers,u),Array.prototype.push.apply(obj.colgroup,c),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var _=0;_<obj.options.nestedHeaders.length;_++){var E=parseInt(obj.options.nestedHeaders[_][obj.options.nestedHeaders[_].length-1].colspan)+l;obj.options.nestedHeaders[_][obj.options.nestedHeaders[_].length-1].colspan=E,obj.thead.children[_].children[obj.thead.children[_].children.length-1].setAttribute("colspan",E);var N=obj.thead.children[_].children[obj.thead.children[_].children.length-1].getAttribute("data-column");N=N.split(",");for(var m=a;m<l+a;m++)N.push(m);obj.thead.children[_].children[obj.thead.children[_].children.length-1].setAttribute("data-column",N)}else{var E=parseInt(obj.options.nestedHeaders[0].colspan)+l;obj.options.nestedHeaders[0].colspan=E,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",E)}}obj.setHistory({action:"insertColumn",columnNumber:t,numOfColumns:l,insertBefore:r,columns:n,headers:d,colgroup:p,records:f,footers:h,data:g}),obj.updateTableReferences(),obj.dispatch("oninsertcolumn",el,t,l,f,r)}},obj.deleteColumn=function(e,t){if(!0==obj.options.allowDeleteColumn){if(obj.headers.length>1){if(void 0==e){var r=obj.getSelectedColumns(!0);r.length?(e=parseInt(r[0]),t=parseInt(r.length)):(e=obj.headers.length-1,t=1)}var n=obj.options.data[0].length-1;if((void 0==e||e>n||e<0)&&(e=n),t||(t=1),t>obj.options.data[0].length-e&&(t=obj.options.data[0].length-e),!1===obj.dispatch("onbeforedeletecolumn",el,e,t))return!1;if(parseInt(e)>-1){var o=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var l=e;l<e+t;l++)obj.isColMerged(l,!1).length&&(o=!0);if(o){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}for(var s=obj.options.columns.splice(e,t),l=e;l<e+t;l++)obj.colgroup[l].className="",obj.headers[l].className="",obj.colgroup[l].parentNode.removeChild(obj.colgroup[l]),obj.headers[l].parentNode.removeChild(obj.headers[l]);for(var i=obj.headers.splice(e,t),a=obj.colgroup.splice(e,t),u=[],c=[],d=[],p=0;p<obj.options.data.length;p++)for(var l=e;l<e+t;l++)obj.records[p][l].className="",obj.records[p][l].parentNode.removeChild(obj.records[p][l]);for(var p=0;p<obj.options.data.length;p++)c[p]=obj.options.data[p].splice(e,t),u[p]=obj.records[p].splice(e,t);if(obj.options.footers)for(var p=0;p<obj.options.footers.length;p++)d[p]=obj.options.footers[p].splice(e,t);if(obj.conditionalSelectionUpdate(0,e,e+t-1),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var f=0;f<obj.options.nestedHeaders.length;f++){var g=parseInt(obj.options.nestedHeaders[f][obj.options.nestedHeaders[f].length-1].colspan)-t;obj.options.nestedHeaders[f][obj.options.nestedHeaders[f].length-1].colspan=g,obj.thead.children[f].children[obj.thead.children[f].children.length-1].setAttribute("colspan",g)}else{var g=parseInt(obj.options.nestedHeaders[0].colspan)-t;obj.options.nestedHeaders[0].colspan=g,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",g)}}obj.setHistory({action:"deleteColumn",columnNumber:e,numOfColumns:t,insertBefore:1,columns:s,headers:i,colgroup:a,records:u,footers:d,data:c}),obj.updateTableReferences(),obj.dispatch("ondeletecolumn",el,e,t,u)}}else console.error("Jspreadsheet: It is not possible to delete the last column")}},obj.getSelectedRows=function(e){for(var t=[],r=0;r<obj.rows.length;r++)obj.rows[r].classList.contains("selected")&&(e?t.push(r):t.push(obj.rows[r]));return t},obj.getSelectedColumns=function(){for(var e=[],t=0;t<obj.headers.length;t++)obj.headers[t].classList.contains("selected")&&e.push(t);return e},obj.getHighlighted=function(){return obj.highlighted},obj.updateTableReferences=function(){for(var e=0;e<obj.headers.length;e++){var t=obj.headers[e].getAttribute("data-x");t==e||(obj.headers[e].setAttribute("data-x",e),obj.headers[e].getAttribute("title")||(obj.headers[e].innerHTML=jexcel.getColumnName(e)))}for(var r=0;r<obj.rows.length;r++)if(obj.rows[r]){var n=obj.rows[r].getAttribute("data-y");n!=r&&(obj.rows[r].setAttribute("data-y",r),obj.rows[r].children[0].setAttribute("data-y",r),obj.rows[r].children[0].innerHTML=r+1)}for(var o=[],l=[],s=function(e,t,r,n){if(e!=r&&obj.records[n][r].setAttribute("data-x",r),t!=n&&obj.records[n][r].setAttribute("data-y",n),e!=r||t!=n){var l=jexcel.getColumnNameFromId([e,t]),s=jexcel.getColumnNameFromId([r,n]);o[l]=s}},r=0;r<obj.records.length;r++)for(var e=0;e<obj.records[0].length;e++)if(obj.records[r][e]){var t=obj.records[r][e].getAttribute("data-x"),n=obj.records[r][e].getAttribute("data-y");if(obj.records[r][e].getAttribute("data-merged")){var i=jexcel.getColumnNameFromId([t,n]),a=jexcel.getColumnNameFromId([e,r]);if(null==l[i]){if(i==a)l[i]=!1;else{var u=parseInt(e-t),c=parseInt(r-n);l[i]=[a,u,c]}}}else s(t,n,e,r)}var d=Object.keys(l);if(d.length){for(var e=0;e<d.length;e++)if(l[d[e]]){var p=jexcel.getIdFromColumnName(d[e],!0),t=p[0],n=p[1];s(t,n,t+l[d[e]][1],n+l[d[e]][2]);for(var i=d[e],a=l[d[e]][0],r=0;r<obj.options.mergeCells[i][2].length;r++){var t=parseInt(obj.options.mergeCells[i][2][r].getAttribute("data-x")),n=parseInt(obj.options.mergeCells[i][2][r].getAttribute("data-y"));obj.options.mergeCells[i][2][r].setAttribute("data-x",t+l[d[e]][1]),obj.options.mergeCells[i][2][r].setAttribute("data-y",n+l[d[e]][2])}obj.options.mergeCells[a]=obj.options.mergeCells[i],delete obj.options.mergeCells[i]}}obj.updateFormulas(o),obj.updateMeta(o),obj.refreshSelection(),obj.updateTable()},obj.updateTable=function(){if(obj.options.minSpareRows>0){for(var e=0,t=obj.rows.length-1;t>=0;t--){for(var r=!1,n=0;n<obj.headers.length;n++)obj.options.data[t][n]&&(r=!0);if(r)break;e++}obj.options.minSpareRows-e>0&&obj.insertRow(obj.options.minSpareRows-e)}if(obj.options.minSpareCols>0){for(var o=0,n=obj.headers.length-1;n>=0;n--){for(var r=!1,t=0;t<obj.rows.length;t++)obj.options.data[t][n]&&(r=!0);if(r)break;o++}obj.options.minSpareCols-o>0&&obj.insertColumn(obj.options.minSpareCols-o)}if("function"==typeof obj.options.updateTable){obj.options.detachForUpdates&&el.removeChild(obj.content);for(var t=0;t<obj.rows.length;t++)for(var n=0;n<obj.headers.length;n++)obj.options.updateTable(el,obj.records[t][n],n,t,obj.options.data[t][n],obj.records[t][n].innerText,jexcel.getColumnNameFromId([n,t]));obj.options.detachForUpdates&&el.insertBefore(obj.content,obj.pagination)}obj.options.footers&&obj.setFooter(),setTimeout(function(){obj.updateCornerPosition()},0)},obj.isReadOnly=function(e){if(e=obj.getCell(e))return!!e.classList.contains("readonly")},obj.setReadOnly=function(e,t){(e=obj.getCell(e))&&(t?e.classList.add("readonly"):e.classList.remove("readonly"))},obj.showRow=function(e){obj.rows[e].style.display=""},obj.hideRow=function(e){obj.rows[e].style.display="none"},obj.showColumn=function(e){obj.headers[e].style.display="",obj.colgroup[e].style.display="",obj.filter&&obj.filter.children.length>e+1&&(obj.filter.children[e+1].style.display="");for(var t=0;t<obj.options.data.length;t++)obj.records[t][e].style.display="";obj.resetSelection()},obj.hideColumn=function(e){obj.headers[e].style.display="none",obj.colgroup[e].style.display="none",obj.filter&&obj.filter.children.length>e+1&&(obj.filter.children[e+1].style.display="none");for(var t=0;t<obj.options.data.length;t++)obj.records[t][e].style.display="none";obj.resetSelection()},obj.showIndex=function(){obj.table.classList.remove("jexcel_hidden_index")},obj.hideIndex=function(){obj.table.classList.add("jexcel_hidden_index")};var chainLoopProtection=[];obj.updateFormulaChain=function(e,t,r){var n=jexcel.getColumnNameFromId([e,t]);if(obj.formula[n]&&obj.formula[n].length>0){if(chainLoopProtection[n])obj.records[t][e].innerHTML="#ERROR",obj.formula[n]="";else{chainLoopProtection[n]=!0;for(var o=0;o<obj.formula[n].length;o++){var l=jexcel.getIdFromColumnName(obj.formula[n][o],!0),s=""+obj.options.data[l[1]][l[0]];"="==s.substr(0,1)?r.push(obj.updateCell(l[0],l[1],s,!0)):Object.keys(obj.formula)[o]=null,obj.updateFormulaChain(l[0],l[1],r)}}}chainLoopProtection=[]},obj.updateFormulas=function(e){for(var t=0;t<obj.options.data.length;t++)for(var r=0;r<obj.options.data[0].length;r++){var n=""+obj.options.data[t][r];if("="==n.substr(0,1)){var o=obj.updateFormula(n,e);o!=n&&(obj.options.data[t][r]=o)}}for(var l=[],s=Object.keys(obj.formula),t=0;t<s.length;t++){var i=s[t],n=obj.formula[i];e[i]&&(i=e[i]),l[i]=[];for(var r=0;r<n.length;r++){var a=n[r];e[a]&&(a=e[a]),l[i].push(a)}}obj.formula=l},obj.updateFormula=function(e,t){for(var r=/[A-Z]/,n=/[0-9]/,o="",l=null,s=null,i="",a=0;a<e.length;a++)r.exec(e[a])?(l=1,s=0,i+=e[a]):n.exec(e[a])?(s=l?1:0,i+=e[a]):(l&&s&&(i=t[i]?t[i]:i),o+=i,o+=e[a],l=0,s=0,i="");return i&&(l&&s&&(i=t[i]?t[i]:i),o+=i),o};var secureFormula=function(e){for(var t="",r=0,n=0;n<e.length;n++)'"'==e[n]&&(r=0==r?1:0),1==r?t+=e[n]:t+=e[n].toUpperCase();return t};obj.executeFormula=function(expression,x,y){var formulaResults=[],formulaLoopProtection=[],execute=function(expression,x,y){var parentId=jexcel.getColumnNameFromId([x,y]);if(formulaLoopProtection[parentId])return console.error("Reference loop detected"),"#ERROR";formulaLoopProtection[parentId]=!0;var tokensUpdate=function(e){for(var t=0;t<e.length;t++){var r=[],n=e[t].split(":"),o=jexcel.getIdFromColumnName(n[0],!0),l=jexcel.getIdFromColumnName(n[1],!0);if(o[0]<=l[0])var s=o[0],i=l[0];else var s=l[0],i=o[0];if(o[1]<=l[1])var a=o[1],u=l[1];else var a=l[1],u=o[1];for(var c=a;c<=u;c++)for(var d=s;d<=i;d++)r.push(jexcel.getColumnNameFromId([d,c]));expression=expression.replace(e[t],r.join(","))}},tokens=(expression=expression.replace(/\$?([A-Z]+)\$?([0-9]+)/g,"$1$2")).match(/([A-Z]+[0-9]+)\:([A-Z]+[0-9]+)/g);tokens&&tokens.length&&tokensUpdate(tokens);var tokens=expression.match(/([A-Z]+[0-9]+)/g);if(tokens&&tokens.indexOf(parentId)>-1)return console.error("Self Reference detected"),"#ERROR";var formulaExpressions={};if(tokens){for(var i=0;i<tokens.length;i++)if(obj.formula[tokens[i]]||(obj.formula[tokens[i]]=[]),0>obj.formula[tokens[i]].indexOf(parentId)&&obj.formula[tokens[i]].push(parentId),eval("typeof("+tokens[i]+') == "undefined"')){var position=jexcel.getIdFromColumnName(tokens[i],1);if(void 0!==obj.options.data[position[1]]&&void 0!==obj.options.data[position[1]][position[0]])var value=obj.options.data[position[1]][position[0]];else var value="";if("="==(""+value).substr(0,1)&&(formulaResults[tokens[i]]?value=formulaResults[tokens[i]]:(value=execute(value,position[0],position[1]),formulaResults[tokens[i]]=value)),""==(""+value).trim())formulaExpressions[tokens[i]]=null;else if(value==Number(value)&&!0==obj.options.autoCasting)formulaExpressions[tokens[i]]=Number(value);else{var number=obj.parseNumber(value,position[0]);!0==obj.options.autoCasting&&number?formulaExpressions[tokens[i]]=number:formulaExpressions[tokens[i]]='"'+value+'"'}}}try{var res=jexcel.formula(expression.substr(1),formulaExpressions,x,y,obj)}catch(e){var res="#ERROR";console.log(e)}return res};return execute(expression,x,y)},obj.parseNumber=function(e,t){var r=t&&obj.options.columns[t].decimal?obj.options.columns[t].decimal:".",n=""+e;if((n=n.split(r))[0]=n[0].match(/[+-]?[0-9]/g),n[0]&&(n[0]=n[0].join("")),n[1]&&(n[1]=n[1].match(/[0-9]*/g).join("")),n[0]&&Number(n[0])>=0){if(n[1])var e=Number(n[0]+"."+n[1]);else var e=Number(n[0]+".00")}else var e=null;return e},obj.row=function(e){},obj.col=function(e){},obj.up=function(e,t){if(e?obj.selectedCell[3]>0&&obj.up.visible(1,t?0:1):(obj.selectedCell[1]>0&&obj.up.visible(0,t?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),!0==obj.options.lazyLoading){if(0==obj.selectedCell[1]||0==obj.selectedCell[3])obj.loadPage(0),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else if(obj.loadValidation())obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else{var r=parseInt(obj.tbody.firstChild.getAttribute("data-y"));obj.selectedCell[1]-r<30&&(obj.loadUp(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]))}}else if(obj.options.pagination>0){var n=obj.whichPage(obj.selectedCell[3]);n!=obj.pageNumber&&obj.page(n)}obj.updateScroll(1)},obj.up.visible=function(e,t){if(0==e)var r=parseInt(obj.selectedCell[0]),n=parseInt(obj.selectedCell[1]);else var r=parseInt(obj.selectedCell[2]),n=parseInt(obj.selectedCell[3]);if(0==t){for(var o=0;o<n;o++)if("none"!=obj.records[o][r].style.display&&"none"!=obj.rows[o].style.display){n=o;break}}else n=obj.up.get(r,n);0==e?(obj.selectedCell[0]=r,obj.selectedCell[1]=n):(obj.selectedCell[2]=r,obj.selectedCell[3]=n)},obj.up.get=function(e,t){for(var e=parseInt(e),t=parseInt(t),r=t-1;r>=0;r--)if("none"!=obj.records[r][e].style.display&&"none"!=obj.rows[r].style.display){if(obj.records[r][e].getAttribute("data-merged")&&obj.records[r][e]==obj.records[t][e])continue;t=r;break}return t},obj.down=function(e,t){if(e?obj.selectedCell[3]<obj.records.length-1&&obj.down.visible(1,t?0:1):(obj.selectedCell[1]<obj.records.length-1&&obj.down.visible(0,t?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),!0==obj.options.lazyLoading)obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1?(obj.loadPage(-1),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])):obj.loadValidation()?obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]):parseInt(obj.tbody.lastChild.getAttribute("data-y"))-obj.selectedCell[3]<30&&(obj.loadDown(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]));else if(obj.options.pagination>0){var r=obj.whichPage(obj.selectedCell[3]);r!=obj.pageNumber&&obj.page(r)}obj.updateScroll(3)},obj.down.visible=function(e,t){if(0==e)var r=parseInt(obj.selectedCell[0]),n=parseInt(obj.selectedCell[1]);else var r=parseInt(obj.selectedCell[2]),n=parseInt(obj.selectedCell[3]);if(0==t){for(var o=obj.rows.length-1;o>n;o--)if("none"!=obj.records[o][r].style.display&&"none"!=obj.rows[o].style.display){n=o;break}}else n=obj.down.get(r,n);0==e?(obj.selectedCell[0]=r,obj.selectedCell[1]=n):(obj.selectedCell[2]=r,obj.selectedCell[3]=n)},obj.down.get=function(e,t){for(var e=parseInt(e),t=parseInt(t),r=t+1;r<obj.rows.length;r++)if("none"!=obj.records[r][e].style.display&&"none"!=obj.rows[r].style.display){if(obj.records[r][e].getAttribute("data-merged")&&obj.records[r][e]==obj.records[t][e])continue;t=r;break}return t},obj.right=function(e,t){e?obj.selectedCell[2]<obj.headers.length-1&&obj.right.visible(1,t?0:1):(obj.selectedCell[0]<obj.headers.length-1&&obj.right.visible(0,t?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(2)},obj.right.visible=function(e,t){if(0==e)var r=parseInt(obj.selectedCell[0]),n=parseInt(obj.selectedCell[1]);else var r=parseInt(obj.selectedCell[2]),n=parseInt(obj.selectedCell[3]);if(0==t){for(var o=obj.headers.length-1;o>r;o--)if("none"!=obj.records[n][o].style.display){r=o;break}}else r=obj.right.get(r,n);0==e?(obj.selectedCell[0]=r,obj.selectedCell[1]=n):(obj.selectedCell[2]=r,obj.selectedCell[3]=n)},obj.right.get=function(e,t){for(var e=parseInt(e),t=parseInt(t),r=e+1;r<obj.headers.length;r++)if("none"!=obj.records[t][r].style.display){if(obj.records[t][r].getAttribute("data-merged")&&obj.records[t][r]==obj.records[t][e])continue;e=r;break}return e},obj.left=function(e,t){e?obj.selectedCell[2]>0&&obj.left.visible(1,t?0:1):(obj.selectedCell[0]>0&&obj.left.visible(0,t?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(0)},obj.left.visible=function(e,t){if(0==e)var r=parseInt(obj.selectedCell[0]),n=parseInt(obj.selectedCell[1]);else var r=parseInt(obj.selectedCell[2]),n=parseInt(obj.selectedCell[3]);if(0==t){for(var o=0;o<r;o++)if("none"!=obj.records[n][o].style.display){r=o;break}}else r=obj.left.get(r,n);0==e?(obj.selectedCell[0]=r,obj.selectedCell[1]=n):(obj.selectedCell[2]=r,obj.selectedCell[3]=n)},obj.left.get=function(e,t){for(var e=parseInt(e),t=parseInt(t),r=e-1;r>=0;r--)if("none"!=obj.records[t][r].style.display){if(obj.records[t][r].getAttribute("data-merged")&&obj.records[t][r]==obj.records[t][e])continue;e=r;break}return e},obj.first=function(e,t){if(e?t?obj.selectedCell[3]=0:obj.left.visible(1,0):(t?obj.selectedCell[1]=0:obj.left.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),!0==obj.options.lazyLoading&&(0==obj.selectedCell[1]||0==obj.selectedCell[3]))obj.loadPage(0);else if(obj.options.pagination>0){var r=obj.whichPage(obj.selectedCell[3]);r!=obj.pageNumber&&obj.page(r)}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(1)},obj.last=function(e,t){if(e?t?obj.selectedCell[3]=obj.records.length-1:obj.right.visible(1,0):(t?obj.selectedCell[1]=obj.records.length-1:obj.right.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),!0==obj.options.lazyLoading&&(obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1))obj.loadPage(-1);else if(obj.options.pagination>0){var r=obj.whichPage(obj.selectedCell[3]);r!=obj.pageNumber&&obj.page(r)}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(3)},obj.selectAll=function(){obj.selectedCell||(obj.selectedCell=[]),obj.selectedCell[0]=0,obj.selectedCell[1]=0,obj.selectedCell[2]=obj.headers.length-1,obj.selectedCell[3]=obj.records.length-1,obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.loadPage=function(e){if(!0==obj.options.search&&obj.results)var t=obj.results;else var t=obj.rows;var r=100;(null==e||-1==e)&&(e=Math.ceil(t.length/r)-1);var n=e*r,o=e*r+r;o>t.length&&(o=t.length),(n=o-100)<0&&(n=0);for(var l=n;l<o;l++)!0==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[t[l]]):obj.tbody.appendChild(obj.rows[l]),obj.tbody.children.length>r&&obj.tbody.removeChild(obj.tbody.firstChild)},obj.loadUp=function(){if(!0==obj.options.search&&obj.results)var e=obj.results;else var e=obj.rows;var t=0;if(e.length>100){var r=parseInt(obj.tbody.firstChild.getAttribute("data-y"));if(!0==obj.options.search&&obj.results&&(r=e.indexOf(r)),r>0)for(var n=0;n<30;n++)(r-=1)>-1&&(!0==obj.options.search&&obj.results?obj.tbody.insertBefore(obj.rows[e[r]],obj.tbody.firstChild):obj.tbody.insertBefore(obj.rows[r],obj.tbody.firstChild),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.lastChild),t=1))}return t},obj.loadDown=function(){if(!0==obj.options.search&&obj.results)var e=obj.results;else var e=obj.rows;var t=0;if(e.length>100){var r=parseInt(obj.tbody.lastChild.getAttribute("data-y"));if(!0==obj.options.search&&obj.results&&(r=e.indexOf(r)),r<obj.rows.length-1)for(var n=0;n<=30;n++)r<e.length&&(!0==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[e[r]]):obj.tbody.appendChild(obj.rows[r]),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.firstChild),t=1)),r+=1}return t},obj.loadValidation=function(){if(obj.selectedCell){var e=parseInt(obj.tbody.firstChild.getAttribute("data-y"))/100,t=parseInt(obj.selectedCell[3]/100),r=parseInt(obj.rows.length/100);if(e!=t&&t<=r&&!Array.prototype.indexOf.call(obj.tbody.children,obj.rows[obj.selectedCell[3]]))return obj.loadPage(t),!0}return!1},obj.resetSearch=function(){obj.searchInput.value="",obj.search(""),obj.results=null},obj.search=function(e){if(e)var e=e.toLowerCase();if(obj.options.filters&&obj.resetFilters(),obj.resetSelection(),obj.pageNumber=0,obj.results=[],e){var t=function(e,t,r){for(var n=0;n<e.length;n++)if((""+e[n]).toLowerCase().search(t)>=0||(""+obj.records[r][n].innerHTML).toLowerCase().search(t)>=0)return!0;return!1},r=function(e){-1==obj.results.indexOf(e)&&obj.results.push(e)};obj.options.data.filter(function(n,o){if(!t(n,e,o))return!1;var l=obj.isRowMerged(o);if(l.length)for(var s=0;s<l.length;s++)for(var i=jexcel.getIdFromColumnName(l[s],!0),a=0;a<obj.options.mergeCells[l[s]][1];a++)r(i[1]+a);else r(o);return!0})}else obj.results=null;return obj.updateResult()},obj.updateResult=function(){var e=0,t=0;for(e=!0==obj.options.lazyLoading?100:obj.options.pagination>0?obj.options.pagination:obj.results?obj.results.length:obj.rows.length;obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var r=0;r<obj.rows.length;r++)!obj.results||obj.results.indexOf(r)>-1?(t<e&&(obj.tbody.appendChild(obj.rows[r]),t++),obj.rows[r].style.display=""):obj.rows[r].style.display="none";return obj.options.pagination>0&&obj.updatePagination(),obj.updateCornerPosition(),e},obj.whichPage=function(e){return!0==obj.options.search&&obj.results&&(e=obj.results.indexOf(e)),Math.ceil((parseInt(e)+1)/parseInt(obj.options.pagination))-1},obj.page=function(e){var t=obj.pageNumber;if(!0==obj.options.search&&obj.results)var r=obj.results;else var r=obj.rows;var n=parseInt(obj.options.pagination);(null==e||-1==e)&&(e=Math.ceil(r.length/n)-1),obj.pageNumber=e;var o=e*n,l=e*n+n;for(l>r.length&&(l=r.length),o<0&&(o=0);obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var s=o;s<l;s++)!0==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[r[s]]):obj.tbody.appendChild(obj.rows[s]);obj.options.pagination>0&&obj.updatePagination(),obj.updateCornerPosition(),obj.dispatch("onchangepage",el,e,t)},obj.updatePagination=function(){if(obj.pagination.children[0].innerHTML="",obj.pagination.children[1].innerHTML="",obj.options.pagination){if(!0==obj.options.search&&obj.results)var e=obj.results.length;else var e=obj.rows.length;if(e){var t=Math.ceil(e/obj.options.pagination);if(obj.pageNumber<6)var r=1,n=t<10?t:10;else if(t-obj.pageNumber<5){var r=t-9,n=t;r<1&&(r=1)}else var r=obj.pageNumber-4,n=obj.pageNumber+5;if(r>1){var o=document.createElement("div");o.className="jexcel_page",o.innerHTML="<",o.title=1,obj.pagination.children[1].appendChild(o)}for(var l=r;l<=n;l++){var o=document.createElement("div");o.className="jexcel_page",o.innerHTML=l,obj.pagination.children[1].appendChild(o),obj.pageNumber==l-1&&o.classList.add("jexcel_page_selected")}if(n<t){var o=document.createElement("div");o.className="jexcel_page",o.innerHTML=">",o.title=t,obj.pagination.children[1].appendChild(o)}var s=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,r){return void 0!==t[r]?t[r]:e})};obj.pagination.children[0].innerHTML=s(obj.options.text.showingPage,obj.pageNumber+1,t)}else obj.pagination.children[0].innerHTML=obj.options.text.noRecordsFound}},obj.download=function(e){if(!1==obj.options.allowExport)console.error("Export not allowed");else{var t="";t+=obj.copy(!1,obj.options.csvDelimiter,!0,e,!0);var r=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,obj.options.csvFileName+".csv");else{var n=document.createElement("a"),o=URL.createObjectURL(r);n.href=o,n.setAttribute("download",obj.options.csvFileName+".csv"),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)}}},obj.setHistory=function(e){if(!0!=obj.ignoreHistory){var t=++obj.historyIndex;obj.history=obj.history=obj.history.slice(0,t+1),obj.history[t]=e}},obj.copy=function(e,t,r,n,o){t||(t="	");for(var l=RegExp(t,"ig"),s=[],i=[],a=[],u=[],c=[],d=obj.options.data[0].length,p=obj.options.data.length,f="",g=!1,h="",m="",_=0,v=0,C=0,y=0,b=!0,A=0;A<p;A++)for(var E=0;E<d;E++)(!e||obj.records[A][E].classList.contains("highlight"))&&(C<=E&&(C=E),y<=A&&(y=A));if(d===C+1&&p===y+1&&(b=!1),o&&!0==obj.options.includeHeadersOnDownload||!o&&!0==obj.options.includeHeadersOnCopy&&!b||n){if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){f=obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0]?obj.options.nestedHeaders:[obj.options.nestedHeaders];for(var A=0;A<f.length;A++){for(var N=[],E=0;E<f[A].length;E++){var w=parseInt(f[A][E].colspan);N.push(f[A][E].title);for(var I=0;I<w-1;I++)N.push("")}m+=N.join(t)+"\r\n"}}g=!0}obj.style=[];for(var A=0;A<p;A++){i=[],a=[];for(var E=0;E<d;E++)if(!e||obj.records[A][E].classList.contains("highlight")){!0==g&&s.push(obj.headers[E].innerText);var L=obj.options.data[A][E];if(L.match&&(L.match(l)||L.match(/,/g)||L.match(/\n/)||L.match(/\"/))&&(L='"'+(L=L.replace(RegExp('"',"g"),'""'))+'"'),i.push(L),"checkbox"==obj.options.columns[E].type||"radio"==obj.options.columns[E].type)var x=L;else{if(!0==obj.options.stripHTMLOnCopy)var x=obj.records[A][E].innerText;else var x=obj.records[A][E].innerHTML;x.match&&(x.match(l)||x.match(/,/g)||x.match(/\n/)||x.match(/\"/))&&(x='"'+(x=x.replace(RegExp('"',"g"),'""'))+'"')}a.push(x),f=(f=obj.records[A][E].getAttribute("style")).replace("display: none;",""),obj.style.push(f||"")}i.length&&(g&&(_=i.length,u.push(s.join(t))),u.push(i.join(t))),a.length&&(v++,g&&(c.push(s.join(t)),g=!1),c.push(a.join(t)))}d==_&&p==v&&(h=m);var D=h+u.join("\r\n"),S=h+c.join("\r\n");if(r||(!0==obj.options.copyCompatibility?obj.textarea.value=S:obj.textarea.value=D,obj.textarea.select(),document.execCommand("copy")),!0==obj.options.copyCompatibility?obj.data=S:obj.data=D,obj.hashString=obj.hash(obj.data),!r){if(obj.removeCopyingSelection(),obj.highlighted)for(var E=0;E<obj.highlighted.length;E++)obj.highlighted[E].classList.add("copying"),obj.highlighted[E].classList.contains("highlight-left")&&obj.highlighted[E].classList.add("copying-left"),obj.highlighted[E].classList.contains("highlight-right")&&obj.highlighted[E].classList.add("copying-right"),obj.highlighted[E].classList.contains("highlight-top")&&obj.highlighted[E].classList.add("copying-top"),obj.highlighted[E].classList.contains("highlight-bottom")&&obj.highlighted[E].classList.add("copying-bottom");obj.dispatch("oncopy",el,!0==obj.options.copyCompatibility?c:u,obj.hashString)}return obj.data},obj.paste=function(e,t,r){var n=obj.dispatch("onbeforepaste",el,r,e,t);if(!1===n)return!1;if(n)var r=n;var o=obj.hash(r),l=o==obj.hashString?obj.style:null;if(!0==obj.options.copyCompatibility&&o==obj.hashString)var r=obj.data;var r=obj.parseCSV(r,"	");if(null!=e&&null!=t&&r){for(var s=0,i=0,a=[],u={},c={},d=0,p=parseInt(e),f=parseInt(t),g=null;g=r[i];){for(s=0,p=parseInt(e);null!=g[s];){var h=obj.updateCell(p,f,g[s]);if(a.push(h),obj.updateFormulaChain(p,f,a),l&&l[d]){var m=jexcel.getColumnNameFromId([p,f]);u[m]=l[d],c[m]=obj.getStyle(m),obj.records[f][p].setAttribute("style",l[d]),d++}if(null!=g[++s]){if(p>=obj.headers.length-1){if(!0==obj.options.allowInsertColumn)obj.insertColumn();else break}p=obj.right.get(p,f)}}if(r[++i]){if(f>=obj.rows.length-1){if(!0==obj.options.allowInsertRow)obj.insertRow();else break}f=obj.down.get(e,f)}}obj.updateSelectionFromCoords(e,t,p,f),obj.setHistory({action:"setValue",records:a,selection:obj.selectedCell,newStyle:u,oldStyle:c}),obj.updateTable(),obj.dispatch("onpaste",el,r),obj.onafterchanges(el,a)}obj.removeCopyingSelection()},obj.removeCopyingSelection=function(){for(var e=document.querySelectorAll(".jexcel .copying"),t=0;t<e.length;t++)e[t].classList.remove("copying"),e[t].classList.remove("copying-left"),e[t].classList.remove("copying-right"),e[t].classList.remove("copying-top"),e[t].classList.remove("copying-bottom")},obj.historyProcessRow=function(e,t){var r=t.insertBefore?+t.rowNumber:t.rowNumber+1;if(!0==obj.options.search&&obj.results&&obj.results.length!=obj.rows.length&&obj.resetSearch(),1==e){for(var n=t.numOfRows,o=r;o<n+r;o++)obj.rows[o].parentNode.removeChild(obj.rows[o]);obj.records.splice(r,n),obj.options.data.splice(r,n),obj.rows.splice(r,n),obj.conditionalSelectionUpdate(1,r,n+r-1)}else{obj.records=jexcel.injectArray(obj.records,r,t.rowRecords),obj.options.data=jexcel.injectArray(obj.options.data,r,t.rowData),obj.rows=jexcel.injectArray(obj.rows,r,t.rowNode);for(var l=0,o=r;o<t.numOfRows+r;o++)obj.tbody.insertBefore(t.rowNode[l],obj.tbody.children[o]),l++}obj.options.pagination>0&&obj.page(obj.pageNumber),obj.updateTableReferences()},obj.historyProcessColumn=function(e,t){var r=t.insertBefore?t.columnNumber:t.columnNumber+1;if(1==e){var n=t.numOfColumns;obj.options.columns.splice(r,n);for(var o=r;o<n+r;o++)obj.headers[o].parentNode.removeChild(obj.headers[o]),obj.colgroup[o].parentNode.removeChild(obj.colgroup[o]);obj.headers.splice(r,n),obj.colgroup.splice(r,n);for(var l=0;l<t.data.length;l++){for(var o=r;o<n+r;o++)obj.records[l][o].parentNode.removeChild(obj.records[l][o]);obj.records[l].splice(r,n),obj.options.data[l].splice(r,n)}if(obj.options.footers)for(var l=0;l<obj.options.footers.length;l++)obj.options.footers[l].splice(r,n)}else{obj.options.columns=jexcel.injectArray(obj.options.columns,r,t.columns),obj.headers=jexcel.injectArray(obj.headers,r,t.headers),obj.colgroup=jexcel.injectArray(obj.colgroup,r,t.colgroup);for(var s=0,o=r;o<t.numOfColumns+r;o++)obj.headerContainer.insertBefore(t.headers[s],obj.headerContainer.children[o+1]),obj.colgroupContainer.insertBefore(t.colgroup[s],obj.colgroupContainer.children[o+1]),s++;for(var l=0;l<t.data.length;l++){obj.options.data[l]=jexcel.injectArray(obj.options.data[l],r,t.data[l]),obj.records[l]=jexcel.injectArray(obj.records[l],r,t.records[l]);for(var s=0,o=r;o<t.numOfColumns+r;o++)obj.rows[l].insertBefore(t.records[l][s],obj.rows[l].children[o+1]),s++}if(obj.options.footers)for(var l=0;l<obj.options.footers.length;l++)obj.options.footers[l]=jexcel.injectArray(obj.options.footers[l],r,t.footers[l])}if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var l=0;l<obj.options.nestedHeaders.length;l++){if(1==e)var i=parseInt(obj.options.nestedHeaders[l][obj.options.nestedHeaders[l].length-1].colspan)-t.numOfColumns;else var i=parseInt(obj.options.nestedHeaders[l][obj.options.nestedHeaders[l].length-1].colspan)+t.numOfColumns;obj.options.nestedHeaders[l][obj.options.nestedHeaders[l].length-1].colspan=i,obj.thead.children[l].children[obj.thead.children[l].children.length-1].setAttribute("colspan",i)}else{if(1==e)var i=parseInt(obj.options.nestedHeaders[0].colspan)-t.numOfColumns;else var i=parseInt(obj.options.nestedHeaders[0].colspan)+t.numOfColumns;obj.options.nestedHeaders[0].colspan=i,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",i)}}obj.updateTableReferences()},obj.undo=function(){var e=!!obj.ignoreEvents,t=!!obj.ignoreHistory;obj.ignoreEvents=!0,obj.ignoreHistory=!0;var r=[];if(obj.historyIndex>=0){var n=obj.history[obj.historyIndex--];if("insertRow"==n.action)obj.historyProcessRow(1,n);else if("deleteRow"==n.action)obj.historyProcessRow(0,n);else if("insertColumn"==n.action)obj.historyProcessColumn(1,n);else if("deleteColumn"==n.action)obj.historyProcessColumn(0,n);else if("moveRow"==n.action)obj.moveRow(n.newValue,n.oldValue);else if("moveColumn"==n.action)obj.moveColumn(n.newValue,n.oldValue);else if("setMerge"==n.action)obj.removeMerge(n.column,n.data);else if("setStyle"==n.action)obj.setStyle(n.oldValue,null,null,1);else if("setWidth"==n.action)obj.setWidth(n.column,n.oldValue);else if("setHeight"==n.action)obj.setHeight(n.row,n.oldValue);else if("setHeader"==n.action)obj.setHeader(n.column,n.oldValue);else if("setComments"==n.action)obj.setComments(n.column,n.oldValue[0],n.oldValue[1]);else if("orderBy"==n.action){for(var o=[],l=0;l<n.rows.length;l++)o[n.rows[l]]=l;obj.updateOrderArrow(n.column,n.order?0:1),obj.updateOrder(o)}else if("setValue"==n.action){for(var s=0;s<n.records.length;s++)r.push({x:n.records[s].x,y:n.records[s].y,newValue:n.records[s].oldValue}),n.oldStyle&&obj.resetStyle(n.oldStyle);obj.setValue(r),n.selection&&obj.updateSelectionFromCoords(n.selection[0],n.selection[1],n.selection[2],n.selection[3])}}obj.ignoreEvents=e,obj.ignoreHistory=t,obj.dispatch("onundo",el,n)},obj.redo=function(){var e=!!obj.ignoreEvents,t=!!obj.ignoreHistory;if(obj.ignoreEvents=!0,obj.ignoreHistory=!0,obj.historyIndex<obj.history.length-1){var r=obj.history[++obj.historyIndex];if("insertRow"==r.action)obj.historyProcessRow(0,r);else if("deleteRow"==r.action)obj.historyProcessRow(1,r);else if("insertColumn"==r.action)obj.historyProcessColumn(0,r);else if("deleteColumn"==r.action)obj.historyProcessColumn(1,r);else if("moveRow"==r.action)obj.moveRow(r.oldValue,r.newValue);else if("moveColumn"==r.action)obj.moveColumn(r.oldValue,r.newValue);else if("setMerge"==r.action)obj.setMerge(r.column,r.colspan,r.rowspan,1);else if("setStyle"==r.action)obj.setStyle(r.newValue,null,null,1);else if("setWidth"==r.action)obj.setWidth(r.column,r.newValue);else if("setHeight"==r.action)obj.setHeight(r.row,r.newValue);else if("setHeader"==r.action)obj.setHeader(r.column,r.newValue);else if("setComments"==r.action)obj.setComments(r.column,r.newValue[0],r.newValue[1]);else if("orderBy"==r.action)obj.updateOrderArrow(r.column,r.order),obj.updateOrder(r.rows);else if("setValue"==r.action){obj.setValue(r.records);for(var n=0;n<r.records.length;n++)r.oldStyle&&obj.resetStyle(r.newStyle);r.selection&&obj.updateSelectionFromCoords(r.selection[0],r.selection[1],r.selection[2],r.selection[3])}}obj.ignoreEvents=e,obj.ignoreHistory=t,obj.dispatch("onredo",el,r)},obj.getDropDownValue=function(e,t){var r=[];if(obj.options.columns[e]&&obj.options.columns[e].source){for(var n=[],o=obj.options.columns[e].source,l=0;l<o.length;l++)"object"==typeof o[l]?n[o[l].id]=o[l].name:n[o[l]]=o[l];for(var s=Array.isArray(t)?t:(""+t).split(";"),l=0;l<s.length;l++)"object"==typeof s[l]?r.push(n[s[l].id]):n[s[l]]&&r.push(n[s[l]])}else console.error("Invalid column");return r.length>0?r.join("; "):""},obj.parseCSV=function(e,t){9==(e=e.replace(/\r?\n$|\r$|\n$/g,"")).charCodeAt(e.length-1)&&(e+="\0"),t=t||",";for(var r=[],n=!1,o=0,l=0,s=0;s<e.length;s++){var i=e[s],a=e[s+1];if(r[o]=r[o]||[],r[o][l]=r[o][l]||"",'"'==i&&n&&'"'==a){r[o][l]+=i,++s;continue}if('"'==i){n=!n;continue}if(i==t&&!n){++l;continue}if("\r"==i&&"\n"==a&&!n){++o,l=0,++s;continue}if("\n"==i&&!n||"\r"==i&&!n){++o,l=0;continue}r[o][l]+=i}return r},obj.hash=function(e){var t,r,n=0;if(0===e.length);else for(t=0;t<e.length;t++)n=(n<<5)-n+(r=e.charCodeAt(t)),n|=0;return n},obj.onafterchanges=function(e,t){obj.dispatch("onafterchanges",e,t)},obj.destroy=function(){jexcel.destroy(el)},obj.init=function(){jexcel.current=obj,"function"==typeof jexcel.build&&(obj.options.root?jexcel.build(obj.options.root):(jexcel.build(document),jexcel.build=null)),el.setAttribute("tabindex",1),el.addEventListener("focus",function(e){jexcel.current&&!obj.selectedCell&&(obj.updateSelectionFromCoords(0,0,0,0),obj.left())}),obj.options.csv?(!0==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.csv,method:obj.options.method,data:obj.options.requestVariables,dataType:"text",success:function(e){var t=obj.parseCSV(e,obj.options.csvDelimiter);if(!0==obj.options.csvHeaders&&t.length>0)for(var r=t.shift(),n=0;n<r.length;n++)obj.options.columns[n]||(obj.options.columns[n]={type:"text",align:obj.options.defaultColAlign,width:obj.options.defaultColWidth}),void 0===obj.options.columns[n].title&&(obj.options.columns[n].title=r[n]);obj.options.data=t,obj.prepareTable(),!0==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.options.url?(!0==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(e){obj.options.data=e.data?e.data:e,obj.prepareTable(),!0==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.prepareTable()},options&&null!=options.contextMenu?obj.options.contextMenu=options.contextMenu:obj.options.contextMenu=function(e,t,r,n){var o=[];if(null==r)!0==obj.options.allowInsertColumn&&o.push({title:obj.options.text.insertANewColumnBefore,onclick:function(){obj.insertColumn(1,parseInt(t),1)}}),!0==obj.options.allowInsertColumn&&o.push({title:obj.options.text.insertANewColumnAfter,onclick:function(){obj.insertColumn(1,parseInt(t),0)}}),!0==obj.options.allowDeleteColumn&&o.push({title:obj.options.text.deleteSelectedColumns,onclick:function(){obj.deleteColumn(obj.getSelectedColumns().length?void 0:parseInt(t))}}),!0==obj.options.allowRenameColumn&&o.push({title:obj.options.text.renameThisColumn,onclick:function(){obj.setHeader(t)}}),!0==obj.options.columnSorting&&(o.push({type:"line"}),o.push({title:obj.options.text.orderAscending,onclick:function(){obj.orderBy(t,0)}}),o.push({title:obj.options.text.orderDescending,onclick:function(){obj.orderBy(t,1)}}));else if(!0==obj.options.allowInsertRow&&(o.push({title:obj.options.text.insertANewRowBefore,onclick:function(){obj.insertRow(1,parseInt(r),1)}}),o.push({title:obj.options.text.insertANewRowAfter,onclick:function(){obj.insertRow(1,parseInt(r))}})),!0==obj.options.allowDeleteRow&&o.push({title:obj.options.text.deleteSelectedRows,onclick:function(){obj.deleteRow(obj.getSelectedRows().length?void 0:parseInt(r))}}),t&&!0==obj.options.allowComments){o.push({type:"line"});var l=obj.records[r][t].getAttribute("title")||"";o.push({title:l?obj.options.text.editComments:obj.options.text.addComments,onclick:function(){var e=prompt(obj.options.text.comments,l);e&&obj.setComments([t,r],e)}}),l&&o.push({title:obj.options.text.clearComments,onclick:function(){obj.setComments([t,r],"")}})}return o.push({type:"line"}),o.push({title:obj.options.text.copy,shortcut:"Ctrl + C",onclick:function(){obj.copy(!0)}}),navigator&&navigator.clipboard&&o.push({title:obj.options.text.paste,shortcut:"Ctrl + V",onclick:function(){obj.selectedCell&&navigator.clipboard.readText().then(function(e){e&&jexcel.current.paste(obj.selectedCell[0],obj.selectedCell[1],e)})}}),obj.options.allowExport&&o.push({title:obj.options.text.saveAs,shortcut:"Ctrl + S",onclick:function(){obj.download()}}),obj.options.about&&o.push({title:obj.options.text.about,onclick:function(){!0===obj.options.about?alert(Version().print()):alert(obj.options.about)}}),o},obj.scrollControls=function(e){obj.wheelControls(),obj.options.freezeColumns>0&&obj.content.scrollLeft!=scrollLeft&&obj.updateFreezePosition(),(!0==obj.options.lazyLoading||!0==obj.options.tableOverflow)&&obj.edition&&"jdropdown"!=e.target.className.substr(0,9)&&obj.closeEditor(obj.edition[0],!0)},obj.wheelControls=function(e){!0==obj.options.lazyLoading&&null==jexcel.timeControlLoading&&(jexcel.timeControlLoading=setTimeout(function(){obj.content.scrollTop+obj.content.clientHeight>=obj.content.scrollHeight-10?obj.loadDown()&&(obj.content.scrollTop+obj.content.clientHeight>obj.content.scrollHeight-10&&(obj.content.scrollTop=obj.content.scrollTop-obj.content.clientHeight),obj.updateCornerPosition()):obj.content.scrollTop<=obj.content.clientHeight&&obj.loadUp()&&(obj.content.scrollTop<10&&(obj.content.scrollTop=obj.content.scrollTop+obj.content.clientHeight),obj.updateCornerPosition()),jexcel.timeControlLoading=null},100))},obj.getFreezeWidth=function(){var e=0;if(obj.options.freezeColumns>0)for(var t=0;t<obj.options.freezeColumns;t++)e+=parseInt(obj.options.columns[t].width);return e};var scrollLeft=0;return obj.updateFreezePosition=function(){scrollLeft=obj.content.scrollLeft;var e=0;if(scrollLeft>50)for(var t=0;t<obj.options.freezeColumns;t++){t>0&&"hidden"!==obj.options.columns[t-1].type&&(e+=parseInt(obj.options.columns[t-1].width)),obj.headers[t].classList.add("jexcel_freezed"),obj.headers[t].style.left=e+"px";for(var r=0;r<obj.rows.length;r++)if(obj.rows[r]&&obj.records[r][t]){var n=scrollLeft+(t>0?obj.records[r][t-1].style.width:0)-51+"px";obj.records[r][t].classList.add("jexcel_freezed"),obj.records[r][t].style.left=n}}else for(var t=0;t<obj.options.freezeColumns;t++){obj.headers[t].classList.remove("jexcel_freezed"),obj.headers[t].style.left="";for(var r=0;r<obj.rows.length;r++)obj.records[r][t]&&(obj.records[r][t].classList.remove("jexcel_freezed"),obj.records[r][t].style.left="")}obj.updateCornerPosition()},el.addEventListener("DOMMouseScroll",obj.wheelControls),el.addEventListener("mousewheel",obj.wheelControls),el.jexcel=obj,el.jspreadsheet=obj,obj.init(),obj};return jexcel.setDictionary=function(e){jSuites.setDictionary(e)},jexcel.setExtensions=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)"function"==typeof e[t[r]]&&(jexcel[t[r]]=e[t[r]],jexcel.license&&"function"==typeof e[t[r]].license&&e[t[r]].license(jexcel.license))},void 0!==formula&&(jexcel.formula=formula),jexcel.version=Version,jexcel.current=null,jexcel.timeControl=null,jexcel.timeControlLoading=null,jexcel.destroy=function(e,t){if(e.jexcel){var r=e.jexcel.options.root?e.jexcel.options.root:document;e.removeEventListener("DOMMouseScroll",e.jexcel.scrollControls),e.removeEventListener("mousewheel",e.jexcel.scrollControls),e.jexcel=null,e.innerHTML="",t&&(r.removeEventListener("mouseup",jexcel.mouseUpControls),r.removeEventListener("mousedown",jexcel.mouseDownControls),r.removeEventListener("mousemove",jexcel.mouseMoveControls),r.removeEventListener("mouseover",jexcel.mouseOverControls),r.removeEventListener("dblclick",jexcel.doubleClickControls),r.removeEventListener("paste",jexcel.pasteControls),r.removeEventListener("contextmenu",jexcel.contextMenuControls),r.removeEventListener("touchstart",jexcel.touchStartControls),r.removeEventListener("touchend",jexcel.touchEndControls),r.removeEventListener("touchcancel",jexcel.touchEndControls),document.removeEventListener("keydown",jexcel.keyDownControls),jexcel=null)}},jexcel.build=function(e){e.addEventListener("mouseup",jexcel.mouseUpControls),e.addEventListener("mousedown",jexcel.mouseDownControls),e.addEventListener("mousemove",jexcel.mouseMoveControls),e.addEventListener("mouseover",jexcel.mouseOverControls),e.addEventListener("dblclick",jexcel.doubleClickControls),e.addEventListener("paste",jexcel.pasteControls),e.addEventListener("contextmenu",jexcel.contextMenuControls),e.addEventListener("touchstart",jexcel.touchStartControls),e.addEventListener("touchend",jexcel.touchEndControls),e.addEventListener("touchcancel",jexcel.touchEndControls),e.addEventListener("touchmove",jexcel.touchEndControls),document.addEventListener("keydown",jexcel.keyDownControls)},jexcel.keyDownControls=function(e){if(jexcel.current){if(jexcel.current.edition){if(27==e.which)jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!1),e.preventDefault();else if(13==e.which){if("calendar"==jexcel.current.options.columns[jexcel.current.edition[2]].type)jexcel.current.closeEditor(jexcel.current.edition[0],!0);else if("dropdown"==jexcel.current.options.columns[jexcel.current.edition[2]].type||"autocomplete"==jexcel.current.options.columns[jexcel.current.edition[2]].type);else if((!0==jexcel.current.options.wordWrap||!0==jexcel.current.options.columns[jexcel.current.edition[2]].wordWrap||jexcel.current.options.data[jexcel.current.edition[3]][jexcel.current.edition[2]].length>200)&&e.altKey){var t=jexcel.current.edition[0].children[0],r=jexcel.current.edition[0].children[0].value,n=t.selectionStart;r=r.slice(0,n)+"\n"+r.slice(n),t.value=r,t.focus(),t.selectionStart=n+1,t.selectionEnd=n+1}else jexcel.current.edition[0].children[0].blur()}else 9==e.which&&("calendar"==jexcel.current.options.columns[jexcel.current.edition[2]].type?jexcel.current.closeEditor(jexcel.current.edition[0],!0):jexcel.current.edition[0].children[0].blur())}if(!jexcel.current.edition&&jexcel.current.selectedCell){if(37==e.which)jexcel.current.left(e.shiftKey,e.ctrlKey),e.preventDefault();else if(39==e.which)jexcel.current.right(e.shiftKey,e.ctrlKey),e.preventDefault();else if(38==e.which)jexcel.current.up(e.shiftKey,e.ctrlKey),e.preventDefault();else if(40==e.which)jexcel.current.down(e.shiftKey,e.ctrlKey),e.preventDefault();else if(36==e.which)jexcel.current.first(e.shiftKey,e.ctrlKey),e.preventDefault();else if(35==e.which)jexcel.current.last(e.shiftKey,e.ctrlKey),e.preventDefault();else if(32==e.which)!0==jexcel.current.options.editable&&jexcel.current.setCheckRadioValue(),e.preventDefault();else if(46==e.which)!0==jexcel.current.options.editable&&(jexcel.current.selectedRow?!0==jexcel.current.options.allowDeleteRow&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedRows)&&jexcel.current.deleteRow():jexcel.current.selectedHeader?!0==jexcel.current.options.allowDeleteColumn&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedColumns)&&jexcel.current.deleteColumn():jexcel.current.setValue(jexcel.current.highlighted,""));else if(13==e.which)e.shiftKey?jexcel.current.up():(!0==jexcel.current.options.allowInsertRow&&!0==jexcel.current.options.allowManualInsertRow&&jexcel.current.selectedCell[1]==jexcel.current.options.data.length-1&&jexcel.current.insertRow(),jexcel.current.down()),e.preventDefault();else if(9==e.which)e.shiftKey?jexcel.current.left():(!0==jexcel.current.options.allowInsertColumn&&!0==jexcel.current.options.allowManualInsertColumn&&jexcel.current.selectedCell[0]==jexcel.current.options.data[0].length-1&&jexcel.current.insertColumn(),jexcel.current.right()),e.preventDefault();else if((e.ctrlKey||e.metaKey)&&!e.shiftKey)65==e.which?(jexcel.current.selectAll(),e.preventDefault()):83==e.which?(jexcel.current.download(),e.preventDefault()):89==e.which?(jexcel.current.redo(),e.preventDefault()):90==e.which?(jexcel.current.undo(),e.preventDefault()):67==e.which?(jexcel.current.copy(!0),e.preventDefault()):88==e.which?(!0==jexcel.current.options.editable?jexcel.cutControls():jexcel.copyControls(),e.preventDefault()):86==e.which&&jexcel.pasteControls();else if(jexcel.current.selectedCell&&!0==jexcel.current.options.editable){var o=jexcel.current.selectedCell[1],l=jexcel.current.selectedCell[0];"readonly"!=jexcel.current.options.columns[l].type&&(32==e.keyCode?"checkbox"==jexcel.current.options.columns[l].type||"radio"==jexcel.current.options.columns[l].type?e.preventDefault():jexcel.current.openEditor(jexcel.current.records[o][l],!0):113==e.keyCode?jexcel.current.openEditor(jexcel.current.records[o][l],!1):(8==e.keyCode||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=111||e.keyCode>=187&&e.keyCode<=190||(String.fromCharCode(e.keyCode)==e.key||String.fromCharCode(e.keyCode).toLowerCase()==e.key.toLowerCase())&&jexcel.validLetter(String.fromCharCode(e.keyCode)))&&(jexcel.current.openEditor(jexcel.current.records[o][l],!0),"calendar"==jexcel.current.options.columns[l].type&&e.preventDefault()))}}else e.target.classList.contains("jexcel_search")&&(jexcel.timeControl&&clearTimeout(jexcel.timeControl),jexcel.timeControl=setTimeout(function(){jexcel.current.search(e.target.value)},200))}},jexcel.isMouseAction=!1,jexcel.mouseDownControls=function(e){if((e=e||window.event).buttons)var t=e.buttons;else if(e.button)var t=e.button;else var t=e.which;var r=jexcel.getElement(e.target);if(r[0]?jexcel.current!=r[0].jexcel&&(jexcel.current&&(jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.resetSelection()),jexcel.current=r[0].jexcel):jexcel.current&&(jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.resetSelection(!0),jexcel.current=null),jexcel.current&&1==t){if(e.target.classList.contains("jexcel_selectall"))jexcel.current&&jexcel.current.selectAll();else if(e.target.classList.contains("jexcel_corner"))!0==jexcel.current.options.editable&&(jexcel.current.selectedCorner=!0);else{if(1==r[1]){var n=e.target.getAttribute("data-x");if(n){var o=e.target.getBoundingClientRect();if(!0==jexcel.current.options.columnResize&&o.width-e.offsetX<6){jexcel.current.resizing={mousePosition:e.pageX,column:n,width:o.width},jexcel.current.headers[n].classList.add("resizing");for(var l=0;l<jexcel.current.records.length;l++)jexcel.current.records[l][n]&&jexcel.current.records[l][n].classList.add("resizing")}else if(!0==jexcel.current.options.columnDrag&&o.height-e.offsetY<6){if(jexcel.current.isColMerged(n).length)console.error("Jspreadsheet: This column is part of a merged cell.");else{jexcel.current.resetSelection(),jexcel.current.dragging={element:e.target,column:n,destination:n},jexcel.current.headers[n].classList.add("dragging");for(var l=0;l<jexcel.current.records.length;l++)jexcel.current.records[l][n]&&jexcel.current.records[l][n].classList.add("dragging")}}else{if(jexcel.current.selectedHeader&&(e.shiftKey||e.ctrlKey))var s=jexcel.current.selectedHeader,i=n;else{jexcel.current.selectedHeader==n&&!0==jexcel.current.options.allowRenameColumn&&(jexcel.timeControl=setTimeout(function(){jexcel.current.setHeader(n)},800)),jexcel.current.selectedHeader=n;var s=n,i=n}jexcel.current.updateSelectionFromCoords(s,0,i,jexcel.current.options.data.length-1)}}else if(e.target.parentNode.classList.contains("jexcel_nested")){if(e.target.getAttribute("data-column"))var a=e.target.getAttribute("data-column").split(","),u=parseInt(a[0]),c=parseInt(a[a.length-1]);else var u=0,c=jexcel.current.options.columns.length-1;jexcel.current.updateSelectionFromCoords(u,0,c,jexcel.current.options.data.length-1)}}else jexcel.current.selectedHeader=!1;if(2==r[1]){var d=e.target.getAttribute("data-y");if(e.target.classList.contains("jexcel_row")){var o=e.target.getBoundingClientRect();if(!0==jexcel.current.options.rowResize&&o.height-e.offsetY<6)jexcel.current.resizing={element:e.target.parentNode,mousePosition:e.pageY,row:d,height:o.height},e.target.parentNode.classList.add("resizing");else if(!0==jexcel.current.options.rowDrag&&o.width-e.offsetX<6)jexcel.current.isRowMerged(d).length?console.error("Jspreadsheet: This row is part of a merged cell"):!0==jexcel.current.options.search&&jexcel.current.results?console.error("Jspreadsheet: Please clear your search before perform this action"):(jexcel.current.resetSelection(),jexcel.current.dragging={element:e.target.parentNode,row:d,destination:d},e.target.parentNode.classList.add("dragging"));else{if(jexcel.current.selectedRow&&(e.shiftKey||e.ctrlKey))var s=jexcel.current.selectedRow,i=d;else{jexcel.current.selectedRow=d;var s=d,i=d}jexcel.current.updateSelectionFromCoords(0,s,jexcel.current.options.data[0].length-1,i)}}else if(e.target.classList.contains("jclose")&&e.target.clientWidth-e.offsetX<50&&e.offsetY<50)jexcel.current.closeEditor(jexcel.current.edition[0],!0);else{var p=function(e){var t=e.getAttribute("data-x"),r=e.getAttribute("data-y");return t&&r?[t,r]:e.parentNode?p(e.parentNode):void 0},f=p(e.target);if(f){var n=f[0],d=f[1];jexcel.current.edition&&(jexcel.current.edition[2]!=n||jexcel.current.edition[3]!=d)&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.edition||(e.shiftKey?jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],n,d):jexcel.current.updateSelectionFromCoords(n,d)),jexcel.current.selectedHeader=null,jexcel.current.selectedRow=null}}}else jexcel.current.selectedRow=!1;e.target.classList.contains("jexcel_page")&&("<"==e.target.innerText?jexcel.current.page(0):">"==e.target.innerText?jexcel.current.page(e.target.getAttribute("title")-1):jexcel.current.page(e.target.innerText-1))}jexcel.current.edition?jexcel.isMouseAction=!1:jexcel.isMouseAction=!0}else jexcel.isMouseAction=!1},jexcel.mouseUpControls=function(e){if(jexcel.current){if(jexcel.current.resizing){if(jexcel.current.resizing.column){var t=jexcel.current.colgroup[jexcel.current.resizing.column].getAttribute("width"),r=jexcel.current.getSelectedColumns();if(r.length>1){for(var n=[],o=0;o<r.length;o++)n.push(parseInt(jexcel.current.colgroup[r[o]].getAttribute("width")));n[r.indexOf(parseInt(jexcel.current.resizing.column))]=jexcel.current.resizing.width,jexcel.current.setWidth(r,t,n)}else jexcel.current.setWidth(jexcel.current.resizing.column,t,jexcel.current.resizing.width);jexcel.current.headers[jexcel.current.resizing.column].classList.remove("resizing");for(var l=0;l<jexcel.current.records.length;l++)jexcel.current.records[l][jexcel.current.resizing.column]&&jexcel.current.records[l][jexcel.current.resizing.column].classList.remove("resizing")}else{jexcel.current.rows[jexcel.current.resizing.row].children[0].classList.remove("resizing");var s=jexcel.current.rows[jexcel.current.resizing.row].getAttribute("height");jexcel.current.setHeight(jexcel.current.resizing.row,s,jexcel.current.resizing.height),jexcel.current.resizing.element.classList.remove("resizing")}jexcel.current.resizing=null}else if(jexcel.current.dragging){if(jexcel.current.dragging){if(jexcel.current.dragging.column){var i=e.target.getAttribute("data-x");jexcel.current.headers[jexcel.current.dragging.column].classList.remove("dragging");for(var l=0;l<jexcel.current.rows.length;l++)jexcel.current.records[l][jexcel.current.dragging.column]&&jexcel.current.records[l][jexcel.current.dragging.column].classList.remove("dragging");for(var o=0;o<jexcel.current.headers.length;o++)jexcel.current.headers[o].classList.remove("dragging-left"),jexcel.current.headers[o].classList.remove("dragging-right");i&&jexcel.current.dragging.column!=jexcel.current.dragging.destination&&jexcel.current.moveColumn(jexcel.current.dragging.column,jexcel.current.dragging.destination)}else{if(jexcel.current.dragging.element.nextSibling){var a=parseInt(jexcel.current.dragging.element.nextSibling.getAttribute("data-y"));jexcel.current.dragging.row<a&&(a-=1)}else var a=parseInt(jexcel.current.dragging.element.previousSibling.getAttribute("data-y"));jexcel.current.dragging.row!=jexcel.current.dragging.destination&&jexcel.current.moveRow(jexcel.current.dragging.row,a,!0),jexcel.current.dragging.element.classList.remove("dragging")}jexcel.current.dragging=null}}else jexcel.current.selectedCorner&&(jexcel.current.selectedCorner=!1,jexcel.current.selection.length>0&&(jexcel.current.copyData(jexcel.current.selection[0],jexcel.current.selection[jexcel.current.selection.length-1]),jexcel.current.removeCopySelection()))}jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null),jexcel.isMouseAction=!1},jexcel.mouseMoveControls=function(e){if((e=e||window.event).buttons)var t=e.buttons;else if(e.button)var t=e.button;else var t=e.which;if(t||(jexcel.isMouseAction=!1),jexcel.current){if(!0==jexcel.isMouseAction){if(jexcel.current.resizing){if(jexcel.current.resizing.column){var r=e.pageX-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.width+r>0){var n=jexcel.current.resizing.width+r;jexcel.current.colgroup[jexcel.current.resizing.column].setAttribute("width",n),jexcel.current.updateCornerPosition()}}else{var o=e.pageY-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.height+o>0){var l=jexcel.current.resizing.height+o;jexcel.current.rows[jexcel.current.resizing.row].setAttribute("height",l),jexcel.current.updateCornerPosition()}}}else if(jexcel.current.dragging){if(jexcel.current.dragging.column){var s=e.target.getAttribute("data-x");if(s){if(jexcel.current.isColMerged(s).length)console.error("Jspreadsheet: This column is part of a merged cell.");else{for(var i=0;i<jexcel.current.headers.length;i++)jexcel.current.headers[i].classList.remove("dragging-left"),jexcel.current.headers[i].classList.remove("dragging-right");jexcel.current.dragging.column==s?jexcel.current.dragging.destination=parseInt(s):e.target.clientWidth/2>e.offsetX?(jexcel.current.dragging.column<s?jexcel.current.dragging.destination=parseInt(s)-1:jexcel.current.dragging.destination=parseInt(s),jexcel.current.headers[s].classList.add("dragging-left")):(jexcel.current.dragging.column<s?jexcel.current.dragging.destination=parseInt(s):jexcel.current.dragging.destination=parseInt(s)+1,jexcel.current.headers[s].classList.add("dragging-right"))}}}else{var a=e.target.getAttribute("data-y");if(a){if(jexcel.current.isRowMerged(a).length)console.error("Jspreadsheet: This row is part of a merged cell.");else{var u=e.target.clientHeight/2>e.offsetY?e.target.parentNode.nextSibling:e.target.parentNode;jexcel.current.dragging.element!=u&&(e.target.parentNode.parentNode.insertBefore(jexcel.current.dragging.element,u),jexcel.current.dragging.destination=Array.prototype.indexOf.call(jexcel.current.dragging.element.parentNode.children,jexcel.current.dragging.element))}}}}}else{var c=e.target.getAttribute("data-x"),d=e.target.getAttribute("data-y"),p=e.target.getBoundingClientRect();jexcel.current.cursor&&(jexcel.current.cursor.style.cursor="",jexcel.current.cursor=null),e.target.parentNode.parentNode&&e.target.parentNode.parentNode.className&&(e.target.parentNode.parentNode.classList.contains("resizable")&&(e.target&&c&&!d&&p.width-(e.clientX-p.left)<6?(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="col-resize"):e.target&&!c&&d&&p.height-(e.clientY-p.top)<6&&(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="row-resize")),e.target.parentNode.parentNode.classList.contains("draggable")&&(e.target&&!c&&d&&p.width-(e.clientX-p.left)<6?(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="move"):e.target&&c&&!d&&p.height-(e.clientY-p.top)<6&&(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="move")))}}},jexcel.mouseOverControls=function(e){if((e=e||window.event).buttons)var t=e.buttons;else if(e.button)var t=e.button;else var t=e.which;if(t||(jexcel.isMouseAction=!1),jexcel.current&&!0==jexcel.isMouseAction){var r=jexcel.getElement(e.target);if(r[0]){if(jexcel.current!=r[0].jexcel&&jexcel.current)return!1;var n=e.target.getAttribute("data-x"),o=e.target.getAttribute("data-y");if(jexcel.current.resizing||jexcel.current.dragging);else{if(1==r[1]&&jexcel.current.selectedHeader){var n=e.target.getAttribute("data-x"),l=jexcel.current.selectedHeader,s=n;jexcel.current.updateSelectionFromCoords(l,0,s,jexcel.current.options.data.length-1)}if(2==r[1]){if(e.target.classList.contains("jexcel_row")){if(jexcel.current.selectedRow){var l=jexcel.current.selectedRow,s=o;jexcel.current.updateSelectionFromCoords(0,l,jexcel.current.options.data[0].length-1,s)}}else!jexcel.current.edition&&n&&o&&(jexcel.current.selectedCorner?jexcel.current.updateCopySelection(n,o):jexcel.current.selectedCell&&jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],n,o))}}}}jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null)},jexcel.doubleClickControls=function(e){if(jexcel.current){if(e.target.classList.contains("jexcel_corner")){if(jexcel.current.highlighted.length>0){var t=jexcel.current.highlighted[0].getAttribute("data-x"),r=parseInt(jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-y"))+1,n=jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-x"),o=jexcel.current.records.length-1;jexcel.current.copyData(jexcel.current.records[r][t],jexcel.current.records[o][n])}}else if(e.target.classList.contains("jexcel_column_filter")){var l=e.target.getAttribute("data-x");jexcel.current.openFilter(l)}else{var s=jexcel.getElement(e.target);if(1==s[1]&&!0==jexcel.current.options.columnSorting){var l=e.target.getAttribute("data-x");l&&jexcel.current.orderBy(l)}if(2==s[1]&&!0==jexcel.current.options.editable&&!jexcel.current.edition){var i=function(e){if(e.parentNode){var t=e.getAttribute("data-x"),r=e.getAttribute("data-y");return t&&r?e:i(e.parentNode)}},a=i(e.target);a&&a.classList.contains("highlight")&&jexcel.current.openEditor(a)}}}},jexcel.copyControls=function(e){jexcel.current&&jexcel.copyControls.enabled&&!jexcel.current.edition&&jexcel.current.copy(!0)},jexcel.cutControls=function(e){jexcel.current&&!jexcel.current.edition&&(jexcel.current.copy(!0),!0==jexcel.current.options.editable&&jexcel.current.setValue(jexcel.current.highlighted,""))},jexcel.pasteControls=function(e){jexcel.current&&jexcel.current.selectedCell&&!jexcel.current.edition&&!0==jexcel.current.options.editable&&(e&&e.clipboardData?(jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],e.clipboardData.getData("text")),e.preventDefault()):window.clipboardData&&jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],window.clipboardData.getData("text")))},jexcel.contextMenuControls=function(e){if("buttons"in(e=e||window.event)?e.buttons:e.which||e.button,jexcel.current){if(jexcel.current.edition)e.preventDefault();else if(jexcel.current.options.contextMenu&&(jexcel.current.contextMenu.contextmenu.close(),jexcel.current)){var t=e.target.getAttribute("data-x"),r=e.target.getAttribute("data-y");if(t||r){(t<parseInt(jexcel.current.selectedCell[0])||t>parseInt(jexcel.current.selectedCell[2])||r<parseInt(jexcel.current.selectedCell[1])||r>parseInt(jexcel.current.selectedCell[3]))&&jexcel.current.updateSelectionFromCoords(t,r,t,r);var n=jexcel.current.options.contextMenu(jexcel.current,t,r,e);jexcel.current.contextMenu.contextmenu.open(e,n),e.preventDefault()}}}},jexcel.touchStartControls=function(e){var t=jexcel.getElement(e.target);if(t[0]?jexcel.current!=t[0].jexcel&&(jexcel.current&&jexcel.current.resetSelection(),jexcel.current=t[0].jexcel):jexcel.current&&(jexcel.current.resetSelection(),jexcel.current=null),jexcel.current&&!jexcel.current.edition){var r=e.target.getAttribute("data-x"),n=e.target.getAttribute("data-y");r&&n&&(jexcel.current.updateSelectionFromCoords(r,n),jexcel.timeControl=setTimeout(function(){"color"==jexcel.current.options.columns[r].type?jexcel.tmpElement=null:jexcel.tmpElement=e.target,jexcel.current.openEditor(e.target,!1,e)},500))}},jexcel.touchEndControls=function(e){jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null,jexcel.tmpElement&&"INPUT"==jexcel.tmpElement.children[0].tagName&&jexcel.tmpElement.children[0].focus(),jexcel.tmpElement=null)},jexcel.tabs=function(e,t){var r=[];if(e.classList.contains("jexcel_tabs"))var n=e.children[0],o=e.children[1];else{e.innerHTML="",e.classList.add("jexcel_tabs"),e.jexcel=[];var l=document.createElement("div"),n=e.appendChild(l),l=document.createElement("div"),o=e.appendChild(l)}for(var s=[],i=[],a=0;a<t.length;a++){s[a]=document.createElement("div"),s[a].classList.add("jexcel_tab");var u=jexcel(s[a],t[a]);o.appendChild(s[a]),r[a]=e.jexcel.push(u),i[a]=document.createElement("div"),i[a].classList.add("jexcel_tab_link"),i[a].setAttribute("data-spreadsheet",e.jexcel.length-1),i[a].innerHTML=t[a].sheetName,i[a].onclick=function(){for(var e=0;e<n.children.length;e++)n.children[e].classList.remove("selected"),o.children[e].style.display="none";var t=this.getAttribute("data-spreadsheet");o.children[t].style.display="block",n.children[t].classList.add("selected")},n.appendChild(i[a])}for(var c=0;c<n.children.length;c++)n.children[c].classList.remove("selected"),o.children[c].style.display="none";return n.children[n.children.length-1].classList.add("selected"),o.children[n.children.length-1].style.display="block",r},jexcel.createTabs=jexcel.tabs,jexcel.fromSpreadsheet=function(e,t){var r,n=function(e){var t=[];return e.SheetNames.forEach(function(r){var n={};n.rows=[],n.columns=[],n.data=[],n.style={},n.sheetName=r;var o=e.Sheets[r]["!cols"];if(o&&o.length)for(var l=0;l<o.length;l++)n.columns[l]={},o[l]&&o[l].wpx&&(n.columns[l].width=o[l].wpx+"px");var o=e.Sheets[r]["!rows"];if(o&&o.length)for(var l=0;l<o.length;l++)o[l]&&o[l].hpx&&(n.rows[l]={},n.rows[l].height=o[l].hpx+"px");var o=e.Sheets[r]["!merges"];if(o&&o.length>0){n.mergeCells=[];for(var l=0;l<o.length;l++){var s=o[l].s.c,i=o[l].s.r,a=o[l].e.c,u=o[l].e.r,c=jexcel.getColumnNameFromId([s,i]);n.mergeCells[c]=[a-s+1,u-i+1]}}for(var d=0,p=0,o=Object.keys(e.Sheets[r]),l=0;l<o.length;l++)if("!"!=o[l].substr(0,1)){var f=e.Sheets[r][o[l]],g=jexcel.getIdFromColumnName(o[l],!0);n.data[g[1]]||(n.data[g[1]]=[]),n.data[g[1]][g[0]]=f.f?"="+f.f:f.w,d<g[0]&&(d=g[0]),p<g[1]&&(p=g[1]),f.style&&Object.keys(f.style).length>0&&(n.style[o[l]]=f.style),f.s&&f.s.fgColor&&(n.style[o[l]]&&(n.style[o[l]]+=";"),n.style[o[l]]+="background-color:#"+f.s.fgColor.rgb)}for(var h=n.columns,m=0;m<=p;m++)for(var l=0;l<=d;l++)n.data[m]||(n.data[m]=[]),!n.data[m][l]&&h<l&&(n.data[m][l]="");t.push(n)}),t};(r=new XMLHttpRequest).open("GET",e,!0),"undefined"!=typeof Uint8Array?(r.responseType="arraybuffer",r.onload=function(e){var o=r.response,l=new Uint8Array(o);t(n(XLSX.read(l,{type:"array",cellFormula:!0,cellStyles:!0})))}):(r.setRequestHeader("Accept-Charset","x-user-defined"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=convertResponseBodyToText(r.responseBody);t(n(XLSX.read(e,{type:"binary",cellFormula:!0,cellStyles:!0})))}}),r.send()},jexcel.validLetter=function(e){var t=/([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC-\u0400-\u04FF']+)/g;return e.match(t)?1:0},jexcel.injectArray=function(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))},jexcel.getColumnName=function(e){var t="";return e>701?(t+=String.fromCharCode(64+parseInt(e/676)),t+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(t+=String.fromCharCode(64+parseInt(e/26))),t+=String.fromCharCode(65+e%26)},jexcel.getIdFromColumnName=function(e,t){var r=/^[a-zA-Z]+/.exec(e);if(r){for(var n=0,o=0;o<r[0].length;o++)n+=parseInt(r[0].charCodeAt(o)-64)*Math.pow(26,r[0].length-1-o);--n<0&&(n=0);var l=parseInt(/[0-9]+$/.exec(e));l>0&&l--,e=!0==t?[n,l]:n+"-"+l}return e},jexcel.getColumnNameFromId=function(e){return Array.isArray(e)||(e=e.split("-")),jexcel.getColumnName(parseInt(e[0]))+(parseInt(e[1])+1)},jexcel.getElement=function(e){var t=0,r=0;function n(e){e.className&&e.classList.contains("jexcel_container")&&(r=e),"THEAD"==e.tagName?t=1:"TBODY"==e.tagName&&(t=2),e.parentNode&&!r&&n(e.parentNode)}return n(e),[r,t]},jexcel.doubleDigitFormat=function(e){return 1==(e=""+e).length&&(e="0"+e),e},jexcel.createFromTable=function(e,t){if("TABLE"!=e.tagName)console.log("Element is not a table");else{t||(t={}),t.columns=[],t.data=[];var r=e.querySelectorAll("colgroup > col");if(r.length)for(var n=0;n<r.length;n++){var o=r[n].style.width;if(!o)var o=r[n].getAttribute("width");o&&(t.columns[n]||(t.columns[n]={}),t.columns[n].width=o)}var l=function(e){var r=e.getBoundingClientRect(),o=r.width>50?r.width:50;t.columns[n]||(t.columns[n]={}),e.getAttribute("data-celltype")?t.columns[n].type=e.getAttribute("data-celltype"):t.columns[n].type="text",t.columns[n].width=o+"px",t.columns[n].title=e.innerHTML,t.columns[n].align=e.style.textAlign||"center",(r=e.getAttribute("name"))&&(t.columns[n].name=r),(r=e.getAttribute("id"))&&(t.columns[n].id=r)},s=[],i=e.querySelectorAll(":scope > thead > tr");if(i.length){for(var a=0;a<i.length-1;a++){for(var u=[],n=0;n<i[a].children.length;n++){var c={title:i[a].children[n].innerText,colspan:i[a].children[n].getAttribute("colspan")||1};u.push(c)}s.push(u)}i=i[i.length-1].children;for(var n=0;n<i.length;n++)l(i[n])}for(var d=0,p={},f={},g={},h={},m=e.querySelectorAll(":scope > tr, :scope > tbody > tr"),a=0;a<m.length;a++)if(t.data[d]=[],!0!=t.parseTableFirstRowAsHeader||i.length||0!=a){for(var n=0;n<m[a].children.length;n++){var _=m[a].children[n].getAttribute("data-formula");if(_)"="!=_.substr(0,1)&&(_="="+_);else var _=m[a].children[n].innerHTML;t.data[d].push(_);var v=jexcel.getColumnNameFromId([n,a]),C=m[a].children[n].getAttribute("class");C&&(h[v]=C);var y=parseInt(m[a].children[n].getAttribute("colspan"))||0,b=parseInt(m[a].children[n].getAttribute("rowspan"))||0;(y||b)&&(p[v]=[y||1,b||1]),(A=m[a].children[n].style&&"none"==m[a].children[n].style.display)&&(m[a].children[n].style.display="");var A=m[a].children[n].getAttribute("style");A&&(g[v]=A),m[a].children[n].classList.contains("styleBold")&&(g[v]?g[v]+="; font-weight:bold;":g[v]="font-weight:bold;")}m[a].style&&m[a].style.height&&(f[a]={height:m[a].style.height}),d++}else for(var n=0;n<m[a].children.length;n++)l(m[a].children[n]);Object.keys(s).length>0&&(t.nestedHeaders=s),Object.keys(g).length>0&&(t.style=g),Object.keys(p).length>0&&(t.mergeCells=p),Object.keys(f).length>0&&(t.rows=f),Object.keys(h).length>0&&(t.classes=h);var m=e.querySelectorAll("tfoot tr");if(m.length){for(var E=[],a=0;a<m.length;a++){for(var N=[],n=0;n<m[a].children.length;n++)N.push(m[a].children[n].innerText);E.push(N)}Object.keys(E).length>0&&(t.footers=E)}if(!0==t.parseTableAutoCellType)for(var w=[],n=0;n<t.columns.length;n++){var I=!0,L=!0;w[n]=[];for(var a=0;a<t.data.length;a++){var _=t.data[a][n];w[n][_]||(w[n][_]=0),w[n][_]++,_.length>25&&(I=!1),10==_.length&&"-"==_.substr(4,1)&&"-"==_.substr(7,1)||(L=!1)}var x=Object.keys(w[n]).length;L?t.columns[n].type="calendar":!0==I&&x>1&&x<=parseInt(.1*t.data.length)&&(t.columns[n].type="dropdown",t.columns[n].source=Object.keys(w[n]))}return t}},jexcel.helpers=((component={}).getCaretIndex=function(e){if(this.config.root)var t=this.config.root;else var t=window;var r=0,n=t.getSelection();if(n&&0!==n.rangeCount){var o=n.getRangeAt(0),l=o.cloneRange();l.selectNodeContents(e),l.setEnd(o.endContainer,o.endOffset),r=l.toString().length}return r},component.invert=function(e){for(var t=[],r=Object.keys(e),n=0;n<r.length;n++)t[e[r[n]]]=r[n];return t},component.getColumnName=function(e){var t="";return e>701?(t+=String.fromCharCode(64+parseInt(e/676)),t+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(t+=String.fromCharCode(64+parseInt(e/26))),t+=String.fromCharCode(65+e%26)},component.getColumnNameFromCoords=function(e,t){return component.getColumnName(parseInt(e))+(parseInt(t)+1)},component.getCoordsFromColumnName=function(e){var t=/^[a-zA-Z]+/.exec(e);if(t){for(var r=0,n=0;n<t[0].length;n++)r+=parseInt(t[0].charCodeAt(n)-64)*Math.pow(26,t[0].length-1-n);--r<0&&(r=0);var o=parseInt(/[0-9]+$/.exec(e))||null;return o>0&&o--,[r,o]}},component.createFromTable=function(){},component.injectArray=function(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))},component.parseCSV=function(e,t){t=t||",";for(var r=0,n=0,o=[[]],l=0,s=null,i=!1,a=!1,u=0;u<e.length;u++)if(o[n]||(o[n]=[]),o[n][r]||(o[n][r]=""),"\r"!=e[u]){if("\n"!=e[u]&&e[u]!=t||!1!=i&&!0!=a&&s){if('"'==e[u]&&(i=!i),null===s){if(!0==(s=i))continue}else if(!0===s&&!a&&'"'==e[u]){'"'==e[u+1]?(i=!0,o[n][r]+=e[u],u++):a=!0;continue}o[n][r]+=e[u]}else{if(s=null,i=!1,a=!1,'"'==o[n][r][0]){var c=o[n][r].trim();'"'==c[c.length-1]&&(o[n][r]=c.substr(1,c.length-2))}"\n"==e[u]?(r=0,n++):++r>l&&(l=r)}}for(var d=0;d<o.length;d++)for(var u=0;u<=l;u++)void 0===o[d][u]&&(o[d][u]="");return o},component),"undefined"!=typeof jQuery&&(($=jQuery).fn.jspreadsheet=$.fn.jexcel=function(e){var t=$(this).get(0);return t.jexcel?Array.isArray(t.jexcel)?t.jexcel[e][arguments[1]].apply(this,Array.prototype.slice.call(arguments,2)):t.jexcel[e].apply(this,Array.prototype.slice.call(arguments,1)):jexcel($(this).get(0),arguments[0])}),jexcel});